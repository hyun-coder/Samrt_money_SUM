
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ìŠ¤ë§ˆíŠ¸ ì›”ê¸‰ ê³„ì‚° Ver.1.3.9 [GDì‹œíì–´]</title>
    <style>
        /* === 1. ë‹¤í¬ ëª¨ë“œ ë° ê¸°ë³¸ ìŠ¤íƒ€ì¼ === */
        :root {
            --color-bg-dark: #121212;
            --color-surface-dark: #1E1E1E;
            --color-text-light: #E0E0E0;
            --color-primary: #00BFFF; /* ë°ì€ ì²­ë¡ìƒ‰ (í¬ì¸íŠ¸) */
            --color-secondary: #FF6F00; /* ì£¼í™©ìƒ‰ (ê²½ê³ /ê°•ì¡°) */
            --color-error: #CF6679;
            --color-highlight: rgba(0, 191, 255, 0.15);
            --color-disabled: #383838;
            --shadow-elevation: 0 4px 8px rgba(0, 0, 0, 0.5);
            --mobile-padding: 16px;
        }

        body {
            background-color: var(--color-bg-dark);
            color: var(--color-text-light);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* === 2. ë ˆì´ì•„ì›ƒ ë° íƒ­ === */
        .app-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .header {
            background-color: var(--color-surface-dark);
            padding: 12px var(--mobile-padding);
            box-shadow: var(--shadow-elevation);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            font-size: 1.4em;
            margin: 0;
            text-align: center;
        }

        .tab-bar {
            display: flex;
            justify-content: space-around;
            background-color: var(--color-surface-dark);
            border-bottom: 1px solid var(--color-disabled);
        }

        .tab-button {
            flex: 1;
            padding: 12px 0;
            text-align: center;
            font-size: 1em;
            cursor: pointer;
            border: none;
            background: none;
            color: var(--color-text-light);
            opacity: 0.6;
            transition: opacity 0.3s, color 0.3s, border-bottom 0.3s;
        }

        .tab-button.active {
            color: var(--color-primary);
            opacity: 1;
            border-bottom: 3px solid var(--color-primary);
        }

        .content-area {
            flex-grow: 1;
            overflow-y: auto;
            position: relative; /* ìì‹ ìš”ì†Œì˜ ì ˆëŒ€ ìœ„ì¹˜ ê¸°ì¤€ */
        }

        /* === 3. ê¸‰ì—¬ ë° ì„¤ì • ì„¹ì…˜ (ìƒë‹¨ ê³ ì •) */
        #salary-input-section {
            background-color: var(--color-surface-dark);
            padding: 10px var(--mobile-padding);
            margin-bottom: 10px;
            border-radius: 8px;
            margin: 10px var(--mobile-padding);
            position: relative; /* í† ê¸€ ë²„íŠ¼ ê¸°ì¤€ */
        }

        .salary-summary h2 {
            font-size: 1.6em;
            color: var(--color-primary);
            margin: 0 0 5px 0;
        }
        
        .salary-summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .input-group, .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .input-group label {
            flex: 2;
            font-size: 0.9em;
        }

        .input-group input, .input-group select {
            flex: 3;
            padding: 8px;
            border: 1px solid var(--color-disabled);
            border-radius: 4px;
            background-color: var(--color-bg-dark);
            color: var(--color-text-light);
            font-size: 1em;
        }
        
        .checkbox-group label {
            flex: 3;
            font-size: 0.9em;
        }
        
        #additional-items-list div {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
        }
        
        #additional-items-list input {
            flex: 1;
        }
        
        /* í† ê¸€ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        #toggle-salary-details {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: var(--color-primary);
            font-size: 1.5em;
            cursor: pointer;
            padding: 5px;
            transition: transform 0.3s;
            line-height: 1;
        }
        
        .collapsed #toggle-salary-details {
            transform: rotate(180deg);
        }
        
        #salary-details-container.collapsed {
            display: none;
        }

        /* === 4. ë‹¬ë ¥ ì„¹ì…˜ === */
        #calendar-view {
            overflow-y: scroll;
            height: calc(100vh - 200px); /* í—¤ë” ë° ê¸‰ì—¬ ì„¹ì…˜ì„ ì œì™¸í•œ ë†’ì´ */
            scroll-snap-type: y mandatory;
        }

        .calendar-month {
            scroll-snap-align: center;
            background-color: var(--color-surface-dark);
            margin: 10px var(--mobile-padding);
            border-radius: 8px;
            padding: 10px;
            opacity: 0.3; /* ë¹„í™œì„±í™”ëœ ë‹¬ì€ íë¦¬ê²Œ */
            transition: opacity 0.3s, transform 0.3s;
        }

        .calendar-month.active {
            opacity: 1; /* í™œì„±í™”ëœ ë‹¬ì€ ì„ ëª…í•˜ê²Œ */
        }

        .month-header {
            text-align: center;
            font-size: 1.5em;
            margin-bottom: 10px;
            color: var(--color-primary);
        }

        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            font-size: 0.8em;
            margin-bottom: 5px;
        }

        .weekdays span {
            color: var(--color-text-light); /* ê¸°ë³¸ ë°ì€ìƒ‰ */
        }
        .weekdays .sunday {
            color: var(--color-error); /* ì¼ìš”ì¼ ë¶‰ì€ìƒ‰ */
        }
        .weekdays .saturday {
            color: #4c91b1; /* í† ìš”ì¼ íŒŒë€ìƒ‰ ê³„ì—´ */
        }


        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }

        .day-cell {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 5px 0;
            border-radius: 6px;
            font-size: 1em;
            min-height: 50px;
            cursor: pointer;
            position: relative;
            background-color: var(--color-bg-dark);
            transition: background-color 0.2s;
        }
        
        /* ì•¼ê°„ ë¡œí…Œì´ì…˜ì¼ ë°°ê²½ ìƒ‰ìƒ ì¶”ê°€ */
        .day-cell.night-shift-background {
            background-color: #2C2C2C; /* ì§„í•œ íšŒìƒ‰ */
        }
        .day-cell.night-shift-background.disabled {
             background-color: #262626; /* ë¹„í™œì„±í™”ëœ ì•¼ê°„ì¼ì€ ë” ì–´ë‘¡ê²Œ */
        }


        .day-cell:not(.disabled):active {
            background-color: var(--color-highlight);
        }

        .day-number {
            font-weight: bold;
            margin-bottom: 2px;
            font-size: 1em;
        }

        .day-status {
            font-size: 0.7em;
            font-weight: 500;
            color: var(--color-primary);
            margin-bottom: 1px;
            line-height: 1; 
        }
        
        .day-overtime {
            font-size: 0.7em;
            color: var(--color-secondary);
            min-height: 0.8em; 
            line-height: 1; 
        }

        .holiday .day-number {
            color: var(--color-error); /* ê³µíœ´ì¼ì€ ë¶‰ì€ìƒ‰ */
        }

        .disabled {
            color: var(--color-disabled);
            background-color: var(--color-surface-dark);
            cursor: default;
        }

        .today {
            border: 2px solid var(--color-secondary);
        }

        /* === 5. ëª¨ë‹¬ (ì…ë ¥/ì„¤ì • íŒì—…) === */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 200;
        }

        .modal-content {
            background-color: var(--color-surface-dark);
            padding: var(--mobile-padding);
            border-radius: 12px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-elevation);
        }

        .modal-content h3 {
            margin-top: 0;
            border-bottom: 1px solid var(--color-disabled);
            padding-bottom: 10px;
            color: var(--color-primary);
        }

        .form-row {
            margin-bottom: 15px;
        }

        .form-row label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .radio-group input[type="radio"] {
            display: none;
        }

        .radio-group label {
            background-color: var(--color-bg-dark);
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
            font-weight: normal;
        }

        .radio-group input[type="radio"]:checked + label {
            background-color: var(--color-primary);
            color: var(--color-bg-dark);
            font-weight: bold;
        }

        /* ì”ì—… ì…ë ¥ ìŠ¤íƒ€ì¼ */
        .overtime-input-row {
            display: grid;
            grid-template-columns: 2fr 1fr 0.5fr;
            gap: 10px;
            align-items: center;
            margin-top: 5px;
        }
        
        .overtime-input-row select, .overtime-input-row input {
            padding: 8px;
            border: 1px solid var(--color-disabled);
            border-radius: 4px;
            background-color: var(--color-bg-dark);
            color: var(--color-text-light);
            font-size: 0.9em;
        }

        .modal-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .modal-actions button {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            font-size: 1em;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .modal-actions button.primary {
            background-color: var(--color-primary);
            color: var(--color-bg-dark);
        }

        .modal-actions button.secondary {
            background-color: var(--color-disabled);
            color: var(--color-text-light);
        }
        
        .modal-actions button.danger {
            background-color: var(--color-error);
            color: var(--color-text-light);
        }

        /* ê¸°íƒ€ ìœ í‹¸ë¦¬í‹° */
        .float-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--color-secondary);
            color: var(--color-bg-dark);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-elevation);
            z-index: 150;
        }
        
        /* í†µê³„ ì‹œíŠ¸ ìŠ¤íƒ€ì¼ */
        #statistics-view {
            padding: var(--mobile-padding);
        }
        
        .stats-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .stats-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .stats-table th, .stats-table td {
            padding: 8px 5px;
            text-align: left;
            border-bottom: 1px solid var(--color-disabled);
            font-size: 0.9em;
            white-space: nowrap;
        }
        
        .stats-table th {
            color: var(--color-primary);
            font-weight: bold;
        }
        
        .stats-summary-row {
            background-color: var(--color-bg-dark);
        }

        /* ì„¤ì • ì„¹ì…˜ ë‚´ small íƒœê·¸ í…ìŠ¤íŠ¸ ìƒ‰ìƒ ë³€ê²½ */
        #tab-content-settings small {
            color: var(--color-text-light) !important;
            opacity: 0.7;
        }
        
        /* ì´ˆê¸° ì„¤ì • ëª¨ë‹¬ */
        #initial-setup-modal .modal-content {
            width: 80%;
        }
        
        #initial-setup-modal input {
            width: 100%;
            box-sizing: border-box;
        }

        /* ì”ì—… ì¢…ë¥˜ ê´€ë¦¬ */
        #overtime-list-container div,
        .change-record-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
        }
        #overtime-list-container input {
            flex: 1;
        }
        
        .change-record-row select, .change-record-row input[type="date"] {
            flex: 1;
        }

    </style>
</head>
<body>

    <div class="app-container">
        
        <header class="header">
            <h1 id="app-title">ìŠ¤ë§ˆíŠ¸ ì›”ê¸‰ ê³„ì‚°</h1>
            <button id="today-button" class="float-button" title="ì˜¤ëŠ˜ ë‚ ì§œë¡œ ì´ë™" style="bottom: auto; top: 10px; right: 10px; width: 40px; height: 40px; font-size: 1.2em;">ğŸ“…</button>
        </header>
        
        <div class="tab-bar">
            <button class="tab-button active" id="tab-calendar">ë‹¬ë ¥/ì…ë ¥</button>
            <button class="tab-button" id="tab-statistics">í†µê³„</button>
            <button class="tab-button" id="tab-settings">ì„¤ì •</button>
        </div>
        
        <div class="content-area">

            <div id="tab-content-calendar" class="tab-content">
                
                <section id="salary-input-section">
                    <div class="salary-summary-header">
                        <div>
                            <small id="salary-period-info">ì´ ì˜ˆìƒ ì›”ê¸‰ (ê¸°ê°„ ì •ë³´ ë¡œë”© ì¤‘...)</small>
                            <h2 id="total-expected-salary">0 ì›</h2>
                        </div>
                        <button id="toggle-salary-details" onclick="toggleSalaryDetails()">â–¼</button>
                    </div>

                    <div id="salary-details-container">
                        <div id="current-salary-options" style="font-size:0.8em; color: var(--color-primary);"></div>
                        
                        <div id="calculated-stats" style="margin-top: 5px; margin-bottom: 15px; padding: 10px; border: 1px solid var(--color-disabled); border-radius: 4px; background-color: var(--color-bg-dark);">
                            <div class="stats-row" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                <span style="flex: 2; color: var(--color-text-light);">í‰ì¼ì”ì—…ì‹œê°„:</span>
                                <span id="stat-weekday-ot-time-count" style="flex: 1; text-align: right; font-weight: bold; margin-right: 10px;">0.0h</span>
                                <span id="stat-weekday-ot-time-amount" style="flex: 2; text-align: right; color: var(--color-primary);">0 ì›</span>
                            </div>
                            <div class="stats-row" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                <span style="flex: 2; color: var(--color-text-light);">íŠ¹ê·¼ì”ì—…ì‹œê°„:</span>
                                <span id="stat-special-ot-time-count" style="flex: 1; text-align: right; font-weight: bold; margin-right: 10px;">0.0h</span>
                                <span id="stat-special-ot-time-amount" style="flex: 2; text-align: right; color: var(--color-primary);">0 ì›</span>
                            </div>
                            <div class="stats-row" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                <span style="flex: 2; color: var(--color-text-light);">íŠ¹ê·¼ì¼ìˆ˜:</span>
                                <span id="stat-special-day-count-count" style="flex: 1; text-align: right; font-weight: bold; margin-right: 10px;">0ì¼</span>
                                <span id="stat-special-day-count-amount" style="flex: 2; text-align: right; color: var(--color-primary);">0 ì›</span>
                            </div>
                            <div class="stats-row" style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="flex: 2; color: var(--color-text-light);">ì•¼ê°„ì¼ìˆ˜:</span>
                                <span id="stat-night-day-count-count" style="flex: 1; text-align: right; font-weight: bold; margin-right: 10px;">0ì¼</span>
                                <span id="stat-night-day-count-amount" style="flex: 2; text-align: right; color: var(--color-primary);">0 ì›</span>
                            </div>
                        </div>

                        <div class="input-group" style="margin-top: 10px;">
                            <label for="base-pay">ê¸°ë³¸ê¸‰ ì…ë ¥</label>
                            <div style="display:flex; gap: 5px; flex: 3;">
                                <input type="number" id="base-pay" placeholder="ê¸°ë³¸ê¸‰" oninput="saveBasePaySetting()" style="flex: 1;">
                                <button onclick="copyPreviousMonthBasePay()" style="background-color: var(--color-secondary); color: var(--color-bg-dark); padding: 5px 10px; border: none; border-radius: 4px; font-size: 0.8em; line-height: 1.2; text-align: center; width: 60px; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer;">ì´ì „ë‹¬<br>ê¸°ë³¸ê¸‰</button>
                            </div>
                        </div>
                        <div class="checkbox-group">
                            <label for="regular-pay-check">í†µìƒì„ê¸ˆ í¬í•¨ (ì”ì—… ì‹œê¸‰ ê³„ì‚°ì— ë°˜ì˜)</label>
                            <input type="checkbox" id="regular-pay-check" onchange="saveRegularPayCheckSetting()">
                        </div>
                        
                        <hr style="border-color: var(--color-disabled); margin: 10px 0;">
                        
                        <label style="font-size: 0.9em;">ì¶”ê°€ ìˆ˜ë‹¹ ëª©ë¡ (ìƒì—¬, êµí†µë¹„, ì‹ëŒ€ ë“± - í˜„ì¬ ê¸°ê°„ì—ë§Œ ì ìš©):</label>
                        <div id="additional-items-list">
                            </div>
                        <button onclick="addAdditionalItem()" style="background-color: var(--color-disabled); color: var(--color-text-light); padding: 5px 10px; border: none; border-radius: 4px; margin-top: 5px;">+ ì¶”ê°€ í•­ëª©</button>
                    </div>

                </section>

                <div id="calendar-view">
                    </div>
            </div>

            <div id="tab-content-statistics" class="tab-content" style="display:none;">
                <section id="statistics-view">
                    <h3>ì›”ë³„ ê·¼ë¬´ í†µê³„</h3>
                    <div id="stats-total-sum" style="font-size: 1.5em; color: var(--color-secondary); margin-bottom: 15px; text-align: right;">ì´ í•©ê³„: 0 ì›</div>
                    
                    <div class="stats-filter">
                        <select id="stats-year-filter" onchange="renderStatistics()"></select>
                        <select id="stats-month-filter" onchange="renderStatistics()">
                            <option value="">ì „ì²´ ì›”</option>
                            </select>
                    </div>

                    <table class="stats-table">
                        <thead>
                            <tr>
                                <th>ê¸°ê°„</th>
                                <th>ì´ì•¡</th>
                                <th>ì£¼ê°„</th>
                                <th>ì•¼ê°„</th>
                                <th>íŠ¹ê·¼</th>
                                <th>íœ´ê°€</th>
                                </tr>
                        </thead>
                        <tbody id="stats-table-body">
                            </tbody>
                    </table>
                </section>
            </div>

            <div id="tab-content-settings" class="tab-content" style="display:none;">
                <section style="padding: var(--mobile-padding);">
                    <h3>ì‚¬ìš©ì ë° ë°˜ ì„¤ì •</h3>
                    <div class="form-row">
                        <label for="setting-account">ë‚´ ê³„ì • ì •ë³´ (ê¸°ê¸°ë‹¹ ê³ ìœ )</label>
                        <input type="text" id="setting-account" disabled>
                    </div>
                    <div class="form-row">
                        <label for="setting-class">ì†Œì† ë°˜ (í˜„ì¬ ê¸°ì¤€)</label>
                        <select id="setting-class" onchange="saveSettings();">
                            <option value="A">Aë°˜</option>
                            <option value="B">Bë°˜</option>
                            <option value="C">Cë°˜</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <label for="setting-a-night">Aë°˜ ì•¼ê°„ ì‹œì‘ì¼ (ê¸°ì¤€ì¼)</label>
                        <input type="date" id="setting-a-night" onchange="saveSettings(); generateCalendar();">
                        <small>* ì´ ë‚ ì§œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë°˜ë³„ ì•¼ê°„ ë¡œí…Œì´ì…˜ì´ ê³„ì‚°ë©ë‹ˆë‹¤. (ì „ì—­ ê¸°ì¤€ì¼, **ë°˜ë“œì‹œ ì¼ìš”ì¼ì´ì–´ì•¼ í•¨**)</small>
                    </div>
                    
                    <hr style="border-color: var(--color-disabled); margin: 20px 0;">

                    <h3>ë°˜ ë³€ê²½ ê¸°ë¡ ê´€ë¦¬ (ê°œì¸ íŒ¨í„´ ë³€ê²½)</h3>
                    <small>* ë°˜ ë³€ê²½ì¼ ì´í›„ë¶€í„° **ë³€ê²½ëœ ë°˜ì˜ ë¡œí…Œì´ì…˜**ì´ **ê³ ì •ëœ Aë°˜ ì•¼ê°„ ì‹œì‘ì¼**ì„ ê¸°ì¤€ìœ¼ë¡œ ì ìš©ë©ë‹ˆë‹¤.</small>
                    <div id="class-change-history-list">
                    </div>
                    <button onclick="addClassChangeRecordInput()" style="background-color: var(--color-disabled); color: var(--color-text-light); padding: 5px 10px; border: none; border-radius: 4px; margin-top: 5px;">+ ë°˜ ë³€ê²½ ê¸°ë¡ ì¶”ê°€</button>

                    <hr style="border-color: var(--color-disabled); margin: 20px 0;">
                    
                    <h3>ì”ì—… ì¢…ë¥˜ ê´€ë¦¬</h3>
                    <div class="form-row">
                        <label style="font-size: 0.9em;">ì”ì—… ì´ë¦„ê³¼ ê¸°ë³¸ ì‹œê°„(h)ì„ ì„¤ì •í•©ë‹ˆë‹¤.</label>
                        <div id="overtime-list-container">
                        </div>
                        <button onclick="addOvertimeSettingItem()" style="background-color: var(--color-disabled); color: var(--color-text-light); padding: 5px 10px; border: none; border-radius: 4px; margin-top: 5px;">+ ì”ì—… ì¢…ë¥˜ ì¶”ê°€</button>
                    </div>

                    <hr style="border-color: var(--color-disabled); margin: 20px 0;">

                    <h3>ì‚¬ìš©ì ì§€ì • ê³µíœ´ì¼</h3>
                    <div id="custom-holidays-list">
                        </div>
                    <button onclick="addCustomHolidayInput()" style="background-color: var(--color-disabled); color: var(--color-text-light); padding: 5px 10px; border: none; border-radius: 4px; margin-top: 5px;">+ ê³µíœ´ì¼ ì¶”ê°€</button>
                    
                    <hr style="border-color: var(--color-disabled); margin: 20px 0;">

                    <button onclick="resetAllData()" 
                            style="width: 100%; 
                                   background-color: var(--color-error); 
                                   color: var(--color-text-light); 
                                   padding: 10px 20px; 
                                   border: none; 
                                   border-radius: 20px; 
                                   font-size: 1em; 
                                   cursor: pointer;">
                        ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™” (ì£¼ì˜)
                    </button>

                </section>
            </div>

        </div>

    </div>

    <div id="work-record-modal" class="modal">
        <div class="modal-content">
            <h3 id="modal-date-title">ê·¼ë¬´ ê¸°ë¡ ì…ë ¥</h3>
            <input type="hidden" id="modal-selected-date">

            <div class="form-row">
                <label>ê·¼ë¬´ í˜•íƒœ</label>
                <div class="radio-group" id="work-type-group">
                    <input type="radio" id="type-ì£¼ê°„" name="work-type" value="ì£¼ê°„"><label for="type-ì£¼ê°„">ì£¼ê°„</label>
                    <input type="radio" id="type-ì•¼ê°„" name="work-type" value="ì•¼ê°„"><label for="type-ì•¼ê°„">ì•¼ê°„</label>
                    <input type="radio" id="type-ì£¼íŠ¹" name="work-type" value="ì£¼ê°„íŠ¹ê·¼"><label for="type-ì£¼íŠ¹">ì£¼ê°„íŠ¹ê·¼</label>
                    <input type="radio" id="type-ì•¼íŠ¹" name="work-type" value="ì•¼ê°„íŠ¹ê·¼"><label for="type-ì•¼íŠ¹">ì•¼ê°„íŠ¹ê·¼</label>
                    <input type="radio" id="type-17ì‹œ" name="work-type" value="17ì‹œí‡´ê·¼"><label for="type-17ì‹œ">17ì‹œ í‡´ê·¼</label>
                    <input type="radio" id="type-íœ´ë¬´" name="work-type" value="íœ´ë¬´"><label for="type-íœ´ë¬´">íœ´ë¬´</label>
                    <input type="radio" id="type-íœ´ê°€" name="work-type" value="íœ´ê°€"><label for="type-íœ´ê°€">íœ´ê°€</label>
                    <input type="radio" id="type-ë°˜ì°¨" name="work-type" value="ë°˜ì°¨"><label for="type-ë°˜ì°¨">ë°˜ì°¨ (0.5ì¼)</label>
                    <input type="radio" id="type-ë¯¸ì„ íƒ" name="work-type" value="ë¯¸ì„ íƒ"><label for="type-ë¯¸ì„ íƒ">ë¯¸ì„ íƒ (ê³„ì‚° ì œì™¸)</label>
                </div>
            </div>

            <div class="form-row" id="overtime-input-section">
                <label>ì¶”ê°€ ê·¼ë¬´ (ì¡°ì¶œ/ì§€ì›)</label>
                <div class="overtime-input-row" style="font-weight: bold; color: var(--color-primary);">
                    <div>ì¢…ë¥˜</div>
                    <div>ì‹œê°„ (h)</div>
                    <div>ì‚­ì œ</div>
                </div>
                <div id="modal-overtime-list">
                    </div>
                <button onclick="addOvertimeRow(true)" style="background-color: var(--color-disabled); color: var(--color-text-light); padding: 5px 10px; border: none; border-radius: 4px; margin-top: 10px;">+ ì”ì—… ì¶”ê°€</button>
            </div>

            <div class="modal-actions">
                <button onclick="closeModal('work-record-modal')" class="secondary">ë‹«ê¸°</button>
                <button onclick="deleteWorkRecord()" class="danger" id="delete-record-btn" style="display:none;">ì‚­ì œ</button>
                <button onclick="saveWorkRecord()" class="primary">ì €ì¥/ìˆ˜ì •</button>
            </div>
        </div>
    </div>
    
    <div id="initial-setup-modal" class="modal" style="display:none;">
        <div class="modal-content">
            <h3>ìŠ¤ë§ˆíŠ¸ ì›”ê¸‰ ê³„ì‚° ì´ˆê¸° ì„¤ì •</h3>
            <p>ì•±ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ê¸°ë³¸ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. ë°ì´í„°ëŠ” í˜„ì¬ ê¸°ê¸°ì— ì•ˆì „í•˜ê²Œ ì €ì¥ë©ë‹ˆë‹¤.</p>
            <div class="form-row">
                <label for="init-class">ì†Œì† ë°˜ì„ ì„ íƒí•˜ì„¸ìš”.</label>
                <select id="init-class">
                    <option value="A">Aë°˜</option>
                    <option value="B">Bë°˜</option>
                    <option value="C">Cë°˜</option>
                </select>
            </div>
            <div class="form-row">
                <label for="init-a-night">Aë°˜ ì•¼ê°„ ë¡œí…Œì´ì…˜ ì‹œì‘ì¼ (YYYY-MM-DD)</label>
                <input type="date" id="init-a-night" value="2025-10-05">
                <small>* ì˜ˆì‹œ: 2025ë…„ 10ì›” 5ì¼ (Bë°˜ ì•¼ê°„ ì‹œì‘ 2025/10/12 ê¸°ì¤€, **ì¼ìš”ì¼ë¡œ ì„¤ì •í•´ì•¼ í•¨**)</small>
            </div>
            <div class="modal-actions">
                <button onclick="completeInitialSetup()" class="primary" style="width: 100%;">ì„¤ì • ì™„ë£Œ ë° ì‹œì‘</button>
            </div>
        </div>
    </div>


    <script>
        // =======================================================================
        // === JavaScript Core Logic (ìˆ˜ì •ëœ ë¡œì§ ì ìš© - V1.8 Final) ===
        // =======================================================================

        // 1. ë°ì´í„° ì €ì¥ ë° ì´ˆê¸°í™”
        let USER_DATA = {
            account: Date.now().toString(), // ê¸°ê¸°ë‹¹ ê³ ìœ  ID
            class: 'A',
            A_night_start: '2025-10-05', // ì´ˆê¸°ê°’: 2025/10/12 Bë°˜ ì•¼ê°„ ì‹œì‘ì´ ë˜ë„ë¡ Aë°˜ ì‹œì‘ì¼ ì„¤ì • (ì¼ìš”ì¼)
            settings: {
                basePays: {}, 
                regularPayChecks: {},
                additionalItemsByPeriod: {}, 
                customHolidays: [], // ìˆ˜ì •: ì´ì œ { date: 'YYYY-MM-DD', name: 'ì„¤ëª…' } ê°ì²´ ë°°ì—´ì„ ì €ì¥í•©ë‹ˆë‹¤.
                isSalaryDetailsCollapsed: false, 
                classChangeHistory: [], 
                overtimeList: [
                    { name: 'G1ì¡°ì¶œ', time: 1.0 }, { name: 'G2ì¡°ì¶œ', time: 1.0 },
                    { name: 'G2ì§€ì›', time: 0.5 }, { name: 'G3ì¡°ì¶œ', time: 1.0 },
                    { name: 'G5ì¡°ì¶œ', time: 1.0 }, { name: 'G5ì§€ì›', time: 0.5 },
                    { name: 'R&Dì¡°ì¶œ', time: 1.0 }, { name: 'R&Dì§€ì›', time: 0.5 },
                    { name: 'ë²„ìŠ¤ê²€ì°¨', time: 0.5 }
                ]
            },
            workRecords: {} 
        };
        
        // --- ê¸‰ì—¬ ê¸°ê°„ ê´€ë ¨ í—¬í¼ í•¨ìˆ˜ ---
        // ê¸‰ì—¬ ê¸°ê°„ì˜ ì‹œì‘ ì›”ì„ ê¸°ì¤€ìœ¼ë¡œ YYYY-MM í‚¤ë¥¼ ë°˜í™˜ (20ì¼ ê¸°ì¤€)
        function getPeriodKeyFromDate(date) {
            let year = date.getFullYear();
            let month = date.getMonth(); // 0-11
            
            // 19ì¼ ì´ì „ì´ë©´ ì´ì „ ë‹¬ì„ ê¸°ì¤€ìœ¼ë¡œ
            if (date.getDate() < 20) {
                month--;
                if (month < 0) {
                    month = 11;
                    year--;
                }
            }
            return `${year}-${String(month + 1).padStart(2, '0')}`;
        }
        
        // í˜„ì¬ í™œì„±í™”ëœ ë‹¬ë ¥ ë·°ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê¸‰ì—¬ ê¸°ê°„ í‚¤ë¥¼ ë°˜í™˜
        function getCurrentActivePeriodKey() {
            const activeMonthElement = document.querySelector('.calendar-month.active');
            if (!activeMonthElement) return null;

            const idParts = activeMonthElement.id.split('-');
            const activeYear = Number(idParts[1]);
            const activeMonthIndex = Number(idParts[2]); // 0-11
            
            const dateOn1st = new Date(activeYear, activeMonthIndex, 1); 
            return getPeriodKeyFromDate(dateOn1st);
        }
        
        // ğŸ”¥ [ìˆ˜ì •ëœ ë¶€ë¶„] ê¸‰ì—¬ ê¸°ê°„ì˜ ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì„ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜
        function getSalaryPeriodByPeriodKey(periodKey) {
            if (!periodKey) return null;
            const [periodYear, periodMonth] = periodKey.split('-').map(Number); // periodMonthëŠ” 1-12

            const startDay = 20;
            const endDay = 19;
            
            // ì‹œì‘ì¼: í•´ë‹¹ ì›”(periodMonthëŠ” 1ë¶€í„° ì‹œì‘í•˜ë¯€ë¡œ -1)ì˜ 20ì¼
            const startDate = new Date(periodYear, periodMonth - 1, startDay); 
            
            // ì¢…ë£Œì¼: ë‹¤ìŒ ë‹¬ì˜ 19ì¼. 
            // JavaScriptì˜ Date ê°ì²´ëŠ” ì›”(month)ì´ 11(12ì›”)ì„ ë„˜ì–´ê°€ë©´ ìë™ìœ¼ë¡œ ì—°ë„ë¥¼ ì¦ê°€ì‹œì¼œ ê³„ì‚°í•˜ë¯€ë¡œ í¸ë¦¬í•©ë‹ˆë‹¤.
            // ì˜ˆ: periodMonthê°€ 12(12ì›”)ì´ë©´, month ì¸ìì—ëŠ” 12ê°€ ë“¤ì–´ê°€ê³ , ì´ëŠ” ë‹¤ìŒ í•´ 1ì›”ë¡œ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤.
            const endDate = new Date(periodYear, periodMonth, endDay);
            endDate.setHours(23, 59, 59, 999);

            return { startDate, endDate };
        }


        // í˜„ì¬ í‚¤ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì´ì „ ê¸°ê°„ í‚¤ë¥¼ ë°˜í™˜
        function getPreviousPeriodKey(currentKey) {
            if (!currentKey) return null;
            const [year, month] = currentKey.split('-').map(Number);
            
            let prevYear = year;
            let prevMonth = month - 1;
            
            if (prevMonth === 0) {
                prevMonth = 12;
                prevYear--;
            }
            return `${prevYear}-${String(prevMonth).padStart(2, '0')}`;
        }
        // ------------------------------------

        function saveData() {
            // ë°˜ ë³€ê²½ ê¸°ë¡ì€ í•­ìƒ ë‚ ì§œ ìˆœìœ¼ë¡œ ì •ë ¬í•˜ì—¬ ì €ì¥
            USER_DATA.settings.classChangeHistory.sort((a, b) => new Date(a.changeDate) - new Date(b.changeDate));
            localStorage.setItem('smartSalaryApp_user_data', JSON.stringify(USER_DATA));
        }

        function loadData() {
            const data = localStorage.getItem('smartSalaryApp_user_data');
            if (data) {
                const loadedData = JSON.parse(data);
                
                // ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡œì§ 
                if (loadedData.settings) {
                    const today = new Date();
                    const currentKey = getPeriodKeyFromDate(today); 
                    
                    if (loadedData.settings.basePay !== undefined) {
                        loadedData.settings.basePays = { [currentKey]: loadedData.settings.basePay };
                        delete loadedData.settings.basePay; 
                    }
                    if (loadedData.settings.isRegularPay !== undefined && loadedData.settings.regularPayChecks === undefined) {
                        loadedData.settings.regularPayChecks = { [currentKey]: loadedData.settings.isRegularPay };
                        delete loadedData.settings.isRegularPay;
                    }
                    
                    if (!loadedData.settings.additionalItemsByPeriod) {
                        loadedData.settings.additionalItemsByPeriod = {};
                        if (loadedData.settings.additionalItems && loadedData.settings.additionalItems.length > 0) {
                            loadedData.settings.additionalItemsByPeriod[currentKey] = loadedData.settings.additionalItems;
                        }
                        delete loadedData.settings.additionalItems; 
                    }
                    
                    // ë§ˆì´ê·¸ë ˆì´ì…˜: ê¸°ì¡´ customHolidays (ë¬¸ìì—´ ë°°ì—´)ë¥¼ ìƒˆ êµ¬ì¡° (ê°ì²´ ë°°ì—´)ë¡œ ë³€í™˜
                    if (loadedData.settings.customHolidays && loadedData.settings.customHolidays.length > 0) {
                        if (typeof loadedData.settings.customHolidays[0] === 'string') {
                            loadedData.settings.customHolidays = loadedData.settings.customHolidays.map(dateStr => ({ date: dateStr, name: 'ì‚¬ìš©ì ì§€ì • ê³µíœ´ì¼' }));
                        }
                    }
                }

                // ì´ˆê¸°í™” ë¡œì§ (í•„ìš” í•„ë“œ ë³´ì¥)
                if (!loadedData.settings.basePays) loadedData.settings.basePays = {};
                if (!loadedData.settings.regularPayChecks) loadedData.settings.regularPayChecks = {};
                if (!loadedData.settings.additionalItemsByPeriod) loadedData.settings.additionalItemsByPeriod = {};
                if (loadedData.settings.isSalaryDetailsCollapsed === undefined) loadedData.settings.isSalaryDetailsCollapsed = false;
                if (!loadedData.settings.overtimeList) {
                     loadedData.settings.overtimeList = [
                        { name: 'G1ì¡°ì¶œ', time: 1.0 }, { name: 'G2ì¡°ì¶œ', time: 1.0 },
                        { name: 'G2ì§€ì›', time: 0.5 }, { name: 'G3ì¡°ì¶œ', time: 1.0 },
                        { name: 'G5ì¡°ì¶œ', time: 1.0 }, { name: 'G5ì§€ì›', time: 0.5 },
                        { name: 'R&Dì¡°ì¶œ', time: 1.0 }, { name: 'R&Dì§€ì›', time: 0.5 },
                        { name: 'ë²„ìŠ¤ê²€ì°¨', time: 0.5 }
                    ];
                }
                if (!loadedData.settings.classChangeHistory) loadedData.settings.classChangeHistory = []; 
                if (!loadedData.settings.customHolidays) loadedData.settings.customHolidays = [];

                USER_DATA = loadedData;
                
                // HTML ìš”ì†Œì— ë¡œë“œëœ ì„¤ì • ê°’ ë°˜ì˜
                document.getElementById('setting-account').value = USER_DATA.account;
                document.getElementById('setting-class').value = USER_DATA.class;
                document.getElementById('setting-a-night').value = USER_DATA.A_night_start;
                
                renderCustomHolidays();
                renderOvertimeSettings();
                renderClassChangeHistory(); 
                
                // ì˜ˆìƒ ê¸ˆì•¡ ì„¹ì…˜ ìƒíƒœ ì ìš©
                if (USER_DATA.settings.isSalaryDetailsCollapsed) {
                    document.getElementById('salary-input-section').classList.add('collapsed');
                    document.getElementById('salary-details-container').classList.add('collapsed');
                    document.getElementById('toggle-salary-details').textContent = 'â–²';
                }

                // ì´ˆê¸° ì„¤ì • ì™„ë£Œ ì—¬ë¶€ í™•ì¸
                if (USER_DATA.account && USER_DATA.class && USER_DATA.A_night_start) {
                    document.getElementById('initial-setup-modal').style.display = 'none';
                    generateCalendar(true); 
                    updateSalary();
                } else {
                    document.getElementById('initial-setup-modal').style.display = 'flex';
                }

            } else {
                USER_DATA.settings.basePays = {};
                USER_DATA.settings.regularPayChecks = {};
                USER_DATA.settings.additionalItemsByPeriod = {}; 
                USER_DATA.settings.classChangeHistory = []; 
                document.getElementById('initial-setup-modal').style.display = 'flex';
            }
        }

        function saveBasePaySetting() {
            const currentKey = getCurrentActivePeriodKey();
            const basePayInput = document.getElementById('base-pay');
            if (currentKey) {
                USER_DATA.settings.basePays[currentKey] = Number(basePayInput.value) || 0;
                saveData();
                updateSalary();
            }
        }
        
        function saveRegularPayCheckSetting() {
            const currentKey = getCurrentActivePeriodKey();
            const isChecked = document.getElementById('regular-pay-check').checked;
            if (currentKey) {
                USER_DATA.settings.regularPayChecks[currentKey] = isChecked;
                saveData();
                updateSalary();
            }
        }


        function saveSettings() {
            USER_DATA.class = document.getElementById('setting-class').value;
            USER_DATA.A_night_start = document.getElementById('setting-a-night').value;
            saveData();
            generateCalendar(); // ì„¤ì • ë³€ê²½ ì‹œ ë‹¬ë ¥ ì¬ìƒì„±
            updateSalary();
        }

        function completeInitialSetup() {
            const initClass = document.getElementById('init-class').value;
            const initANightInput = document.getElementById('init-a-night');
            const initANight = initANightInput.value;
            
            if (!initANight) {
                alert("Aë°˜ ì•¼ê°„ ì‹œì‘ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                initANightInput.focus();
                return;
            }
            
            const dateCheck = new Date(initANight);
            if(dateCheck.getDay() !== 0) {
                 if(!confirm("Aë°˜ ì•¼ê°„ ì‹œì‘ì¼ì€ ë¡œí…Œì´ì…˜ ê·œì¹™ìƒ ì¼ìš”ì¼ì´ì–´ì•¼ í•©ë‹ˆë‹¤. ê³„ì† ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                    return;
                }
            }


            USER_DATA.class = initClass;
            USER_DATA.A_night_start = initANight;
            USER_DATA.account = USER_DATA.account || Date.now().toString(); 

            document.getElementById('setting-account').value = USER_DATA.account;
            document.getElementById('setting-class').value = initClass;
            document.getElementById('setting-a-night').value = initANight;

            saveData();

            document.getElementById('initial-setup-modal').style.display = 'none';
            
            generateCalendar(true);
            updateSalary();
            switchTab('calendar'); 
        }

        function resetAllData() {
            if(confirm("ëª¨ë“  ì €ì¥ëœ ë°ì´í„°(ê·¼ë¬´ ê¸°ë¡, ì„¤ì •)ë¥¼ ì •ë§ë¡œ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")) {
                localStorage.removeItem('smartSalaryApp_user_data');
                location.reload(); 
            }
        }
        
        function toggleSalaryDetails() {
            const section = document.getElementById('salary-input-section');
            const details = document.getElementById('salary-details-container');
            const button = document.getElementById('toggle-salary-details');
            
            const isCollapsed = !details.classList.contains('collapsed');
            if (isCollapsed) {
                section.classList.add('collapsed');
                details.classList.add('collapsed');
                button.textContent = 'â–²';
                USER_DATA.settings.isSalaryDetailsCollapsed = true;
            } else {
                section.classList.remove('collapsed');
                details.classList.remove('collapsed');
                button.textContent = 'â–¼';
                USER_DATA.settings.isSalaryDetailsCollapsed = false;
            }
            saveData();
        }

        // 2. ê³µíœ´ì¼ ì²˜ë¦¬
        const FIXED_HOLIDAYS = {
            '01-01': 'ì‹ ì •', '03-01': 'ì‚¼ì¼ì ˆ', '05-05': 'ì–´ë¦°ì´ë‚ ', 
            '06-06': 'í˜„ì¶©ì¼', '08-15': 'ê´‘ë³µì ˆ', '10-03': 'ê°œì²œì ˆ', 
            '10-09': 'í•œê¸€ë‚ ', '12-25': 'ì„±íƒ„ì ˆ'
        };

        function getLunarHolidays(year) {
            const lunarData = {
                2025: ['01-29', '01-30', '01-31', '04-04', '10-06', '10-07', '10-08'],
                2026: ['02-16', '02-17', '02-18', '05-24', '09-25', '09-26', '09-27'], 
            };
            return lunarData[year] || [];
        }

        function isHoliday(dateStr) {
            const date = new Date(dateStr);
            const monthDay = dateStr.substring(5);
            const year = date.getFullYear();
            
            // ê³ ì • ê³µíœ´ì¼ ë˜ëŠ” ì¼ìš”ì¼
            if (FIXED_HOLIDAYS[monthDay] || date.getDay() === 0) {
                return true;
            }
            
            // ìˆ˜ì •ë¨: ì‚¬ìš©ì ì§€ì • ê³µíœ´ì¼ ì²´í¬ (ê°ì²´ ë°°ì—´ì—ì„œ ë‚ ì§œ í™•ì¸)
            if (USER_DATA.settings.customHolidays.some(h => h.date === dateStr)) {
                return true;
            }

            if (getLunarHolidays(year).includes(monthDay)) {
                return true;
            }
            
            return false;
        }

        // 3. ë°˜ ë¡œí…Œì´ì…˜ ê³„ì‚° **[í•µì‹¬ ìˆ˜ì • ì˜ì—­]**
        
        // íŠ¹ì • ë‚ ì§œì— ì ìš©ë˜ëŠ” ì‹¤ì œ ë°˜(A, B, C)ì„ ë°˜í™˜
        function getActualClassForDate(dateStr) {
            // ì´ˆê¸° ì„¤ì •ëœ ë°˜ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ ì‚¬ìš©
            let actualClass = USER_DATA.class; 

            // ë‚ ì§œ ìˆœìœ¼ë¡œ ì •ë ¬ëœ ë°˜ ë³€ê²½ ê¸°ë¡
            const history = USER_DATA.settings.classChangeHistory
                .sort((a, b) => new Date(a.changeDate) - new Date(b.changeDate));
                
            // í•´ë‹¹ ë‚ ì§œ(dateStr)ì— ì ìš©ë˜ëŠ” ê°€ì¥ ìµœê·¼ì˜ ë°˜ ë³€ê²½ ê¸°ë¡ì„ ì°¾ìŒ
            for (const record of history) {
                if (dateStr >= record.changeDate) {
                    actualClass = record.newClass;
                }
            }
            return actualClass;
        }

        /**
         * **[ì´ì „ ë‹¨ê³„ì—ì„œ ì‚­ì œ]**
         * ë°˜ ë³€ê²½ ê¸°ë¡ì— ë”°ë¼ ë¡œí…Œì´ì…˜ ê¸°ì¤€ì¼(Aë°˜ ì•¼ê°„ ì‹œì‘ì¼)ì„ ë™ì ìœ¼ë¡œ ê²°ì •í•˜ëŠ” í•¨ìˆ˜ì˜€ìœ¼ë‚˜, 
         * ì‚¬ìš©ìì˜ ìš”ì²­ì— ë”°ë¼ Aë°˜ ì•¼ê°„ ì‹œì‘ì¼ì€ USER_DATA.A_night_startë¡œ ê³ ì •ë˜ì–´ì•¼ í•˜ë¯€ë¡œ ì œê±°í•¨.
         */
        // function getEffectiveANightStart(dateStr) { return USER_DATA.A_night_start; } 
        // -> ì´ í•¨ìˆ˜ë¥¼ ì œê±°í•˜ê³ , getClassWorkTypeì—ì„œ ì§ì ‘ USER_DATA.A_night_start ì‚¬ìš©

        // ë¡œí…Œì´ì…˜ íƒ€ì…ì„ ë°˜í™˜í•˜ëŠ” ë©”ì¸ í•¨ìˆ˜
        function getClassWorkType(dateStr) {
            const targetClass = getActualClassForDate(dateStr); // í•´ë‹¹ ë‚ ì§œì— ì ìš©ë˜ëŠ” ì‚¬ìš©ìì˜ ì‹¤ì œ ë°˜
            
            // ì•¼ê°„ ë¡œí…Œì´ì…˜ ê¸°ì¤€ì¼ì€ ì „ì—­ ì„¤ì •ê°’(USER_DATA.A_night_start)ìœ¼ë¡œ ê³ ì •
            const aNightStartStr = USER_DATA.A_night_start; 

            const date = new Date(dateStr);
            const A_start_date = new Date(aNightStartStr);
            if (isNaN(A_start_date.getTime())) return 'ì£¼ê°„';

            const diffTime = date.getTime() - A_start_date.getTime();
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            const cycleDays = 21;
            let dayInCycle = diffDays % cycleDays;
            if (dayInCycle < 0) dayInCycle += cycleDays;
            dayInCycle++; // 1ë¶€í„° 21ê¹Œì§€ì˜ ì£¼ê¸° ì¼ìˆ˜

            let workType = 'ì£¼ê°„';

            // 21ì¼ ì£¼ê¸° ë¡œí…Œì´ì…˜ ì ìš©
            // Aë°˜: 1~7ì¼ ì•¼ê°„
            if (dayInCycle >= 1 && dayInCycle <= 7) {
                if (targetClass === 'A') workType = 'ì•¼ê°„';
            // Bë°˜: 8~14ì¼ ì•¼ê°„
            } else if (dayInCycle >= 8 && dayInCycle <= 14) {
                if (targetClass === 'B') workType = 'ì•¼ê°„';
            // Cë°˜: 15~21ì¼ ì•¼ê°„
            } else if (dayInCycle >= 15 && dayInCycle <= 21) {
                if (targetClass === 'C') workType = 'ì•¼ê°„';
            }

            return workType;
        }


        // 4. ë‹¬ë ¥ ìƒì„± ë° ë Œë”ë§ 
        function generateCalendar(scrollToToday = false) { 
            const startYear = 2025;
            const endYear = startYear + 10;
            const calendarView = document.getElementById('calendar-view');
            calendarView.innerHTML = '';

            const today = new Date();
            const todayStr = today.toISOString().substring(0, 10);
            const todayCalId = `cal-${today.getFullYear()}-${today.getMonth()}`;

            for (let year = startYear; year < endYear; year++) {
                for (let month = 0; month < 12; month++) {
                    const monthDate = new Date(year, month, 1);
                    const monthName = monthDate.toLocaleDateString('ko-KR', { month: 'long', year: 'numeric' });

                    const monthDiv = document.createElement('div');
                    monthDiv.className = 'calendar-month';
                    monthDiv.id = `cal-${year}-${month}`;

                    const weekdaysHTML = `
                        <div class="weekdays">
                            <span class="sunday">ì¼</span><span>ì›”</span><span>í™”</span><span>ìˆ˜</span><span>ëª©</span><span>ê¸ˆ</span><span class="saturday">í† </span>
                        </div>
                    `;

                    monthDiv.innerHTML = `<div class="month-header">${monthName}</div>
                                          ${weekdaysHTML}
                                          <div class="calendar-grid"></div>`;

                    const grid = monthDiv.querySelector('div.calendar-grid');
                    const firstDay = new Date(year, month, 1).getDay();

                    for (let i = 0; i < firstDay; i++) {
                        grid.innerHTML += '<div></div>';
                    }

                    const lastDate = new Date(year, month + 1, 0).getDate();
                    for (let date = 1; date <= lastDate; date++) {
                        const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
                        const isToday = dateStr === todayStr;

                        const cell = document.createElement('div');
                        cell.className = 'day-cell';
                        cell.innerHTML = `<span class="day-number">${date}</span><span class="day-status"></span><span class="day-overtime"></span>`;
                        cell.dataset.date = dateStr;

                        const rotationWorkType = getClassWorkType(dateStr); 
                        if (rotationWorkType === 'ì•¼ê°„') {
                            cell.classList.add('night-shift-background');
                        }
                        
                        if (isHoliday(dateStr)) {
                            cell.classList.add('holiday');
                        }
                        if (isToday) {
                            cell.classList.add('today');
                        }

                        let isSalaryPeriod = false;
                        // âœ¨ [ìˆ˜ì •ëœ ë¶€ë¶„] ë‚ ì§œ ë¬¸ìì—´ ëŒ€ì‹  ë…„, ì›”, ì¼ ë³€ìˆ˜ë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ì—¬ Date ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
                        // ì´ë ‡ê²Œ í•˜ë©´ ì‹œê°„ëŒ€(timezone) ê´€ë ¨ ë¶ˆì¼ì¹˜ ì˜¤ë¥˜ë¥¼ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        const currentDay = new Date(year, month, date);
                        
                        const periodKey = getPeriodKeyFromDate(currentDay);
                        const periodDates = getSalaryPeriodByPeriodKey(periodKey);
                        
                        if (periodDates && currentDay >= periodDates.startDate && currentDay <= periodDates.endDate) {
                            isSalaryPeriod = true;
                        }

                        if (isSalaryPeriod) {
                            cell.onclick = () => openWorkRecordModal(dateStr);
                        } else {
                            cell.classList.add('disabled');
                        }

                        const record = USER_DATA.workRecords[dateStr];
                        let displayStatus = '';
                        let displayOvertime = '';

                        if (record && record.type !== 'ë¯¸ì„ íƒ') {
                            switch(record.type) {
                                case 'ì£¼ê°„': displayStatus = 'ì£¼'; break;
                                case 'ì•¼ê°„': displayStatus = 'ì•¼'; break;
                                case 'ì£¼ê°„íŠ¹ê·¼': displayStatus = 'ì£¼íŠ¹'; break;
                                case 'ì•¼ê°„íŠ¹ê·¼': displayStatus = 'ì•¼íŠ¹'; break;
                                case '17ì‹œí‡´ê·¼': displayStatus = '17ì‹œ'; break;
                                case 'íœ´ë¬´': displayStatus = 'íœ´ë¬´'; break;
                                case 'íœ´ê°€': displayStatus = 'íœ´ê°€'; break;
                                case 'ë°˜ì°¨': displayStatus = 'ë°˜ì°¨'; break;
                                default: displayStatus = record.type; // âœ¨ ìˆ˜ì •: 'ê¸°ë¡' ëŒ€ì‹  ì‹¤ì œ íƒ€ì… í‘œì‹œ
                            }

                            if(record.totalOvertime && record.totalOvertime > 0) {
                                displayOvertime = `${record.totalOvertime.toFixed(1)}h`;
                            } else {
                                displayOvertime = '&nbsp;';
                            }
                        } else {
                            // âœ¨ ìˆ˜ì •: ê·¼ë¬´ ê¸°ë¡ì´ ì—†ê±°ë‚˜ 'ë¯¸ì„ íƒ'ì¼ ê²½ìš° ìƒíƒœ í‘œì‹œë¥¼ ë¹„ì›ë‹ˆë‹¤.
                            displayStatus = ''; 
                            displayOvertime = '&nbsp;';
                        }

                        cell.querySelector('.day-status').textContent = displayStatus;
                        cell.querySelector('.day-overtime').innerHTML = displayOvertime;

                        grid.appendChild(cell);
                    }

                    calendarView.appendChild(monthDiv);
                }
            }

            const todayCal = document.getElementById(todayCalId);
            if (todayCal) {
                document.querySelectorAll('.calendar-month').forEach(el => el.classList.remove('active'));
                todayCal.classList.add('active');

                if (scrollToToday) {
                    setTimeout(() => {
                        todayCal.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 100);
                }
            }
            
            calendarView.onscroll = updateActiveMonth;
            updateActiveMonth();
        }

        function updateActiveMonth() {
            const calendarView = document.getElementById('calendar-view');
            const months = calendarView.querySelectorAll('.calendar-month');
            const center = calendarView.scrollTop + (calendarView.clientHeight / 2);

            months.forEach(month => {
                const monthCenterY = month.offsetTop + month.offsetHeight / 2;
                if (Math.abs(monthCenterY - center) < month.offsetHeight / 2) {
                    month.classList.add('active');
                } else {
                    month.classList.remove('active');
                }
            });

            // ë‹¬ë ¥ í™œì„±í™” ì‹œ í•´ë‹¹ ê¸°ê°„ì˜ ì¶”ê°€ ìˆ˜ë‹¹ì„ ë Œë”ë§í•˜ê³  ê¸‰ì—¬ ê³„ì‚°
            renderAdditionalItems(); 
            updateSalary();
        }

        document.getElementById('today-button').addEventListener('click', () => {
            const today = new Date();
            const todayCalId = `cal-${today.getFullYear()}-${today.getMonth()}`;
            const todayCal = document.getElementById(todayCalId);
            if (todayCal) {
                setTimeout(() => {
                    todayCal.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 10);
            }
        });

        // 5. ê·¼ë¬´ ê¸°ë¡ ëª¨ë‹¬ (ë³€ê²½ ì—†ìŒ)
        function openWorkRecordModal(dateStr) {
            const modal = document.getElementById('work-record-modal');
            const title = document.getElementById('modal-date-title');
            const dateInput = document.getElementById('modal-selected-date');
            const deleteBtn = document.getElementById('delete-record-btn');
            const record = USER_DATA.workRecords[dateStr];

            title.textContent = `${dateStr} ê·¼ë¬´ ê¸°ë¡`;
            dateInput.value = dateStr;
            deleteBtn.style.display = record ? 'inline-block' : 'none';

            const workType = record ? record.type : 'ë¯¸ì„ íƒ';
            const typeId = `type-${workType.replace(/ì£¼ê°„íŠ¹ê·¼/, 'ì£¼íŠ¹').replace(/ì•¼ê°„íŠ¹ê·¼/, 'ì•¼íŠ¹').replace(/17ì‹œí‡´ê·¼/, '17ì‹œ')}`;
            const radio = document.getElementById(typeId);
            if (radio) radio.checked = true;

            const overtimeListDiv = document.getElementById('modal-overtime-list');
            overtimeListDiv.innerHTML = '';
            if (record && record.overtimeList && record.overtimeList.length > 0) {
                record.overtimeList.forEach(item => {
                    addOvertimeRow(true, item.name, item.time);
                });
            } else {
                addOvertimeRow(false);
            }

            modal.style.display = 'flex';
        }

        function closeModal(id) {
            document.getElementById(id).style.display = 'none';
        }

        function addOvertimeRow(canDelete, selectedName = '', selectedTime = 0) {
            const listDiv = document.getElementById('modal-overtime-list');
            const row = document.createElement('div');
            row.className = 'overtime-input-row';

            let options = USER_DATA.settings.overtimeList.map(item =>
                `<option value="${item.name}" data-time="${item.time}" ${item.name === selectedName ? 'selected' : ''}>${item.name} (${item.time}h)</option>`
            ).join('');

            let inputValue = selectedTime > 0 ? selectedTime.toFixed(1) : '';
            if (!inputValue && selectedName) {
                const defaultItem = USER_DATA.settings.overtimeList.find(item => item.name === selectedName);
                if (defaultItem) inputValue = defaultItem.time.toFixed(1);
            }

            row.innerHTML = `
                <select onchange="updateOvertimeTime(this)">
                    <option value="">ì”ì—… ì¢…ë¥˜ ì„ íƒ</option>
                    ${options}
                </select>
                <input type="number" step="0.5" value="${inputValue}" class="overtime-time-input" placeholder="ì‹œê°„">
                <button type="button" onclick="this.parentNode.remove()" style="background: none; border: none; color: var(--color-error); font-size: 1.2em; ${canDelete ? '' : 'display:none;'}">ğŸ—‘ï¸</button>
            `;
            listDiv.appendChild(row);
        }

        function updateOvertimeTime(selectElement) {
            const selectedOption = selectElement.options[selectElement.selectedIndex];
            const timeInput = selectElement.parentNode.querySelector('.overtime-time-input');
            const defaultTime = selectedOption.dataset.time;
            if (defaultTime) {
                timeInput.value = Number(defaultTime).toFixed(1);
            } else {
                timeInput.value = '';
            }
        }

        function saveWorkRecord() {
            const dateStr = document.getElementById('modal-selected-date').value;
            const workTypeElement = document.querySelector('input[name="work-type"]:checked');
            const workType = workTypeElement ? workTypeElement.value : 'ë¯¸ì„ íƒ';

            let totalOvertime = 0;
            const overtimeList = [];

            document.querySelectorAll('#modal-overtime-list .overtime-input-row').forEach(row => {
                const select = row.querySelector('select');
                const timeInput = row.querySelector('.overtime-time-input');
                const name = select.value;
                const time = Number(timeInput.value);

                if (name && time > 0) {
                    overtimeList.push({ name, time });
                    totalOvertime += time;
                }
            });

            let automaticOvertime = 0;
            switch (workType) {
                case 'ì£¼ê°„': automaticOvertime = 3.0; break;
                case 'ì•¼ê°„': automaticOvertime = 4.5; break;
                case 'ì£¼ê°„íŠ¹ê·¼': automaticOvertime = 0.5; break;
                case 'ì•¼ê°„íŠ¹ê·¼': automaticOvertime = 7.0; break;
                case '17ì‹œí‡´ê·¼': automaticOvertime = 0.5; break;
            }

            const finalTotalOvertime = totalOvertime + automaticOvertime;

            const newRecord = {
                type: workType,
                overtimeList: overtimeList,
                totalOvertime: finalTotalOvertime 
            };

            USER_DATA.workRecords[dateStr] = newRecord;
            saveData();
            closeModal('work-record-modal');
            generateCalendar(false);
            updateSalary();
        }

        function deleteWorkRecord() {
            if (confirm("í•´ë‹¹ ë‚ ì§œì˜ ê·¼ë¬´ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                const dateStr = document.getElementById('modal-selected-date').value;
                delete USER_DATA.workRecords[dateStr];
                saveData();
                closeModal('work-record-modal');
                generateCalendar(false);
                updateSalary();
            }
        }

        // 6. ê¸‰ì—¬ ê³„ì‚° ë¡œì§ (ë³€ê²½ ì—†ìŒ)
        function calculateHourlyRate(basePay, isRegularPay) {
            let rateBasis = basePay;
            if (isRegularPay) {
                const ANNUAL_REGULAR_BONUS = 2000000; 
                rateBasis += (ANNUAL_REGULAR_BONUS / 12); 
            }
            return rateBasis / 226;
        }

        function calculateDailyPay(dateStr, workRecord, settings, currentBasePay, isRegularPay) {
            if (!workRecord || workRecord.type === 'ë¯¸ì„ íƒ') return 0;

            const hourlyRate = calculateHourlyRate(currentBasePay, isRegularPay);
            let totalDailyAllowance = 0;
            let totalOvertimeHours = workRecord.totalOvertime || 0;

            // --- 1. ê¸°ë³¸ ê·¼ë¬´ì— ëŒ€í•œ ê°€ì‚° ìˆ˜ë‹¹ (ì”ì—… ì œì™¸) ---
            switch (workRecord.type) {
                case 'ì•¼ê°„':
                    totalDailyAllowance += (hourlyRate * 0.5) * 8;
                    break;
                case 'ì£¼ê°„íŠ¹ê·¼':
                    totalDailyAllowance += (hourlyRate * 1.5) * 8;
                    break;
                case 'ì•¼ê°„íŠ¹ê·¼':
                    totalDailyAllowance += (hourlyRate * 2.0) * 8;
                    break;
                case 'ì£¼ê°„':
                case '17ì‹œí‡´ê·¼':
                case 'íœ´ê°€':
                case 'ë°˜ì°¨':
                case 'íœ´ë¬´':
                    break;
            }

            // --- 2. ì”ì—…/ì¶”ê°€ ê·¼ë¬´ ìˆ˜ë‹¹ ê³„ì‚° (ê°€ì‚°ìœ¨ ì ìš©) ---
            if (totalOvertimeHours > 0) {
                let overtimeRateMultiplier = 0;

                if (workRecord.type.includes('íŠ¹ê·¼')) {
                    overtimeRateMultiplier = 2.0;
                } else {
                    overtimeRateMultiplier = 1.5;
                }

                totalDailyAllowance += totalOvertimeHours * hourlyRate * overtimeRateMultiplier;
            }

            return totalDailyAllowance;
        }


        function updateSalary() {
            const currentPeriodKey = getCurrentActivePeriodKey(); 
            
            if (!currentPeriodKey) {
                document.getElementById('total-expected-salary').textContent = "0 ì›";
                document.getElementById('current-salary-options').textContent = 'ë‹¬ë ¥ í™œì„±í™”ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...';
                return;
            }

            const { startDate, endDate } = getSalaryPeriodByPeriodKey(currentPeriodKey);

            // 1. ê¸°ê°„ë³„ ì„¤ì • ë¡œë“œ ë° UI ë°˜ì˜
            const settings = USER_DATA.settings;
            const currentBasePay = settings.basePays[currentPeriodKey] || 0;
            const isRegularPayChecked = settings.regularPayChecks[currentPeriodKey] || false;
            const periodAdditionalItems = settings.additionalItemsByPeriod[currentPeriodKey] || []; 

            document.getElementById('base-pay').value = currentBasePay > 0 ? currentBasePay : '';
            document.getElementById('regular-pay-check').checked = isRegularPayChecked;


            // ê¸°ê°„ ì •ë³´ í‘œì‹œ
            const startMonth = startDate.getMonth() + 1;
            const endMonth = endDate.getMonth() + 1;
            document.getElementById('salary-period-info').textContent = `ì´ ì˜ˆìƒ ì›”ê¸‰ (${startDate.getFullYear()}/${startMonth}ì›” 20ì¼ ~ ${endDate.getFullYear()}/${endMonth}ì›” 19ì¼)`;

            let totalExpectedSalary = 0; 
            let hasWorkRecordInPeriod = false;

            let weekdayOtTime = 0;
            let specialDayCount = 0; 
            let specialOtTime = 0;
            let nightDayCount = 0;
            
            let weekdayOtAmount = 0;
            let specialOtAmount = 0;
            let specialDayAmount = 0; 
            let nightDayAmount = 0;
            
            const hourlyRate = calculateHourlyRate(currentBasePay, isRegularPayChecked);

            for (const dateStr in USER_DATA.workRecords) {
                const date = new Date(dateStr);
                const record = USER_DATA.workRecords[dateStr];

                if (date >= startDate && date <= endDate) {
                    if (record && record.type !== 'ë¯¸ì„ íƒ') {
                        hasWorkRecordInPeriod = true;
                    }

                    const dailyAllowance = calculateDailyPay(dateStr, record, settings, currentBasePay, isRegularPayChecked); 
                    totalExpectedSalary += dailyAllowance;

                    let totalOvertimeHours = record.totalOvertime || 0;

                    // í†µê³„ ê³„ì‚°
                    if (record.type === 'ì•¼ê°„' || record.type === 'ì•¼ê°„íŠ¹ê·¼') { // ì•¼ê°„ìˆ˜ë‹¹ ë¶™ëŠ” ë‚ 
                        nightDayCount++;
                        nightDayAmount += (hourlyRate * 0.5) * 8; 
                    }

                    if (record.type === 'ì£¼ê°„íŠ¹ê·¼' || record.type === 'ì•¼ê°„íŠ¹ê·¼') { // íŠ¹ê·¼ ê°€ì‚° ë¶™ëŠ” ë‚ 
                        specialDayCount++;
                        specialDayAmount += (hourlyRate * 1.5) * 8; 
                    }
                    
                    if (totalOvertimeHours > 0) {
                        if (record.type.includes('íŠ¹ê·¼')) {
                            let overtimeRateMultiplier = 2.0;
                            specialOtTime += totalOvertimeHours; 
                            specialOtAmount += totalOvertimeHours * hourlyRate * overtimeRateMultiplier;
                        } else if (record.type === 'ì£¼ê°„' || record.type === '17ì‹œí‡´ê·¼' || record.type === 'ì•¼ê°„') {
                            let overtimeRateMultiplier = 1.5;
                            weekdayOtTime += totalOvertimeHours;
                            weekdayOtAmount += totalOvertimeHours * hourlyRate * overtimeRateMultiplier;
                        }
                    }
                }
            }

            // ê¸°ê°„ ë‚´ ê·¼ë¬´ ê¸°ë¡ì´ ìˆê³ , ê¸°ë³¸ê¸‰ì´ 0ë³´ë‹¤ í´ ê²½ìš°ì—ë§Œ ê¸°ë³¸ê¸‰ê³¼ ì¶”ê°€ ìˆ˜ë‹¹ í•©ì‚°
            if (hasWorkRecordInPeriod) {
                totalExpectedSalary += currentBasePay;
                totalExpectedSalary += periodAdditionalItems.reduce((sum, item) => sum + item.amount, 0); 
            }

            // ì´ ì˜ˆìƒ ê¸ˆì•¡ ì†Œìˆ˜ì  ë°˜ì˜¬ë¦¼ ë° í‘œì‹œ
            document.getElementById('total-expected-salary').textContent = Math.round(totalExpectedSalary).toLocaleString('ko-KR') + " ì›";

            // í†µê³„ í‘œì‹œ ì—…ë°ì´íŠ¸
            document.getElementById('stat-weekday-ot-time-count').textContent = `${weekdayOtTime.toFixed(1)}h`;
            document.getElementById('stat-weekday-ot-time-amount').textContent = `${Math.round(weekdayOtAmount).toLocaleString('ko-KR')} ì›`;

            document.getElementById('stat-special-ot-time-count').textContent = `${specialOtTime.toFixed(1)}h`;
            document.getElementById('stat-special-ot-time-amount').textContent = `${Math.round(specialOtAmount).toLocaleString('ko-KR')} ì›`;

            document.getElementById('stat-special-day-count-count').textContent = `${specialDayCount}ì¼`;
            document.getElementById('stat-special-day-count-amount').textContent = `${Math.round(specialDayAmount).toLocaleString('ko-KR')} ì›`;

            document.getElementById('stat-night-day-count-count').textContent = `${nightDayCount}ì¼`;
            document.getElementById('stat-night-day-count-amount').textContent = `${Math.round(nightDayAmount).toLocaleString('ko-KR')} ì›`;

            // ê¸°ë³¸ê¸‰ ë° í†µìƒì„ê¸ˆ ì •ë³´ë¥¼ ì—…ë°ì´íŠ¸
            document.getElementById('current-salary-options').innerHTML = `
                ì‹œê¸‰ ê³„ì‚° ê¸°ì¤€: <b>${isRegularPayChecked ? 'í†µìƒì„ê¸ˆ í¬í•¨' : 'ê¸°ë³¸ê¸‰ë§Œ'}</b> / ì˜ˆìƒ ì‹œê¸‰: <b>${Math.round(hourlyRate).toLocaleString('ko-KR', { maximumFractionDigits: 0 })} ì›</b>
            `;
        }

        // ì´ì „ë‹¬ ê¸°ë³¸ê¸‰ ë³µì‚¬ í•¨ìˆ˜ (ë³€ê²½ ì—†ìŒ)
        function copyPreviousMonthBasePay() {
            const currentKey = getCurrentActivePeriodKey();
            if (!currentKey) {
                alert("í™œì„±í™”ëœ ê¸‰ì—¬ ê¸°ê°„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }
            
            const prevKey = getPreviousPeriodKey(currentKey);
            const prevBasePay = USER_DATA.settings.basePays[prevKey] || 0;
            
            if (prevBasePay > 0) {
                USER_DATA.settings.basePays[currentKey] = prevBasePay;
                document.getElementById('base-pay').value = prevBasePay;
                saveData();
                updateSalary();
                alert(`${prevKey.substring(0, 4)}ë…„ ${Number(prevKey.substring(5))}ì›”ë¶„ ê¸°ë³¸ê¸‰ (${prevBasePay.toLocaleString('ko-KR')}ì›)ì´ í˜„ì¬ ê¸°ê°„ì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            } else {
                alert("ì´ì „ë‹¬ì˜ ê¸°ë³¸ê¸‰ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.");
            }
        }
        
        // 7. ì”ì—… ì¢…ë¥˜ ì„¤ì • ê´€ë¦¬ (ì„¤ì • íƒ­ - ë³€ê²½ ì—†ìŒ)
        function renderOvertimeSettings() {
            const listDiv = document.getElementById('overtime-list-container');
            listDiv.innerHTML = '';

            USER_DATA.settings.overtimeList.forEach((item, index) => {
                const div = document.createElement('div');
                div.innerHTML = `
                    <input type="text" value="${item.name}" placeholder="ì”ì—… ì´ë¦„" oninput="updateOvertimeSettingName(${index}, this.value)">
                    <input type="number" step="0.5" value="${item.time}" placeholder="ì‹œê°„(h)" oninput="updateOvertimeSettingTime(${index}, this.value)">
                    <button onclick="removeOvertimeSettingItem(${index})" style="background: none; border: none; color: var(--color-error);">ğŸ—‘ï¸</button>
                `;
                listDiv.appendChild(div);
            });
        }

        function addOvertimeSettingItem() {
            USER_DATA.settings.overtimeList.push({ name: '', time: 0 });
            saveData();
            renderOvertimeSettings();
        }

        function updateOvertimeSettingName(index, name) {
            USER_DATA.settings.overtimeList[index].name = name;
            saveData();
        }

        function updateOvertimeSettingTime(index, time) {
            USER_DATA.settings.overtimeList[index].time = Number(time) || 0;
            saveData();
        }

        function removeOvertimeSettingItem(index) {
            USER_DATA.settings.overtimeList.splice(index, 1);
            saveData();
            renderOvertimeSettings();
        }
        
        // 8. ë°˜ ë³€ê²½ ê¸°ë¡ ê´€ë¦¬ 
        function renderClassChangeHistory() {
            const listDiv = document.getElementById('class-change-history-list');
            listDiv.innerHTML = '';

            USER_DATA.settings.classChangeHistory.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'change-record-row';
                div.dataset.index = index;
                div.innerHTML = `
                    <input type="date" value="${item.changeDate}" onchange="updateClassChangeRecordDate(${index}, this.value)">
                    <select onchange="updateClassChangeRecordClass(${index}, this.value)">
                        <option value="A" ${item.newClass === 'A' ? 'selected' : ''}>Aë°˜</option>
                        <option value="B" ${item.newClass === 'B' ? 'selected' : ''}>Bë°˜</option>
                        <option value="C" ${item.newClass === 'C' ? 'selected' : ''}>Cë°˜</option>
                    </select>
                    <button onclick="removeClassChangeRecord(${index})" style="background: none; border: none; color: var(--color-error);">ğŸ—‘ï¸</button>
                `;
                listDiv.appendChild(div);
            });
        }

        function addClassChangeRecordInput() {
            const history = USER_DATA.settings.classChangeHistory;
            const latestDate = history.length > 0 ? history[history.length - 1].changeDate : null;
            
            let newDate = new Date();
            if (latestDate) {
                // ìƒˆ ë³€ê²½ì¼ì€ ê°€ì¥ ìµœê·¼ ë³€ê²½ì¼ ë‹¤ìŒ ë‚ ë¶€í„° ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì • (ì•ˆì „ì¥ì¹˜)
                const latest = new Date(latestDate);
                latest.setDate(latest.getDate() + 1);
                newDate = latest;
            }

            const newDateStr = newDate.toISOString().substring(0, 10);
            
            if (latestDate && newDate.getTime() <= new Date(latestDate).getTime()) {
                alert("ë°˜ ë³€ê²½ì¼ì€ ê°€ì¥ ìµœê·¼ ê¸°ë¡ëœ ë³€ê²½ì¼ ì´í›„ë¡œ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.");
                return;
            }

            USER_DATA.settings.classChangeHistory.push({ changeDate: newDateStr, newClass: 'A' });
            saveData();
            renderClassChangeHistory();
            generateCalendar(false);
        }
        
        function updateClassChangeRecordDate(index, newDateStr) {
            const history = USER_DATA.settings.classChangeHistory;
            
            // ì•ˆì „ì¥ì¹˜: ì´ì „ ë³€ê²½ì¼ë³´ë‹¤ ë¹ ë¥´ê²Œ ì„¤ì •í•  ìˆ˜ ì—†ìŒ
            if (index > 0) {
                if (newDateStr <= history[index - 1].changeDate) {
                    alert("ë³€ê²½ì¼ì€ ì´ì „ ë³€ê²½ì¼ (" + history[index - 1].changeDate + ") ì´í›„ì—¬ì•¼ í•©ë‹ˆë‹¤.");
                    document.querySelector(`.change-record-row[data-index="${index}"] input[type="date"]`).value = history[index].changeDate; // ë¡¤ë°±
                    return;
                }
            }
            
            history[index].changeDate = newDateStr;
            saveData();
            renderClassChangeHistory(); // ì •ë ¬ì„ ìœ„í•´ ë‹¤ì‹œ ë Œë”ë§
            generateCalendar(false);
        }
        
        function updateClassChangeRecordClass(index, newClass) {
            const history = USER_DATA.settings.classChangeHistory;
            history[index].newClass = newClass;
            saveData();
            generateCalendar(false);
        }

        function removeClassChangeRecord(index) {
            USER_DATA.settings.classChangeHistory.splice(index, 1);
            saveData();
            renderClassChangeHistory();
            generateCalendar(false);
        }


        // 9. ì¶”ê°€ í•­ëª© ê´€ë¦¬ (ë‹¬ë ¥ íƒ­ - ê¸°ê°„ë³„ ì ìš© - ë³€ê²½ ì—†ìŒ)
        function getPeriodAdditionalItems(periodKey) {
             if (!USER_DATA.settings.additionalItemsByPeriod[periodKey]) {
                USER_DATA.settings.additionalItemsByPeriod[periodKey] = [];
            }
            return USER_DATA.settings.additionalItemsByPeriod[periodKey];
        }

        function renderAdditionalItems() {
            const currentKey = getCurrentActivePeriodKey();
            if (!currentKey) return;

            const items = getPeriodAdditionalItems(currentKey);
            const listDiv = document.getElementById('additional-items-list');
            listDiv.innerHTML = '';

            items.forEach((item, index) => {
                const div = document.createElement('div');
                div.innerHTML = `
                    <input type="text" value="${item.name}" placeholder="ìˆ˜ë‹¹ ì´ë¦„" oninput="updateAdditionalItemName(${index}, this.value)">
                    <input type="number" value="${item.amount}" placeholder="ê¸ˆì•¡" oninput="updateAdditionalItemAmount(${index}, this.value)">
                    <button onclick="removeAdditionalItem(${index})" style="background: none; border: none; color: var(--color-error);">ğŸ—‘ï¸</button>
                `;
                listDiv.appendChild(div);
            });
        }

        function addAdditionalItem() {
            const currentKey = getCurrentActivePeriodKey();
            if (!currentKey) return;
            getPeriodAdditionalItems(currentKey).push({ name: '', amount: 0 });
            saveData();
            renderAdditionalItems();
        }

        function updateAdditionalItemName(index, name) {
            const currentKey = getCurrentActivePeriodKey();
            if (!currentKey) return;
            getPeriodAdditionalItems(currentKey)[index].name = name;
            saveData();
        }

        function updateAdditionalItemAmount(index, amount) {
            const currentKey = getCurrentActivePeriodKey();
            if (!currentKey) return;
            getPeriodAdditionalItems(currentKey)[index].amount = Number(amount) || 0;
            saveData();
            updateSalary();
        }

        function removeAdditionalItem(index) {
            const currentKey = getCurrentActivePeriodKey();
            if (!currentKey) return;
            getPeriodAdditionalItems(currentKey).splice(index, 1);
            saveData();
            renderAdditionalItems();
            updateSalary();
        }

        // 10. ì‚¬ìš©ì ì •ì˜ ê³µíœ´ì¼ ê´€ë¦¬ (ìˆ˜ì •ë¨: ë‚ ì§œ + ë‚´ìš© ì…ë ¥ ì¹¸ ì¶”ê°€)
        function renderCustomHolidays() {
            const listDiv = document.getElementById('custom-holidays-list');
            listDiv.innerHTML = '';

            USER_DATA.settings.customHolidays.forEach((item, index) => { // itemì€ {date, name} ê°ì²´
                const div = document.createElement('div');
                div.style.marginBottom = '8px';
                div.style.display = 'flex';
                div.style.gap = '10px';
                div.innerHTML = `
                    <input type="date" value="${item.date}" onchange="updateCustomHolidayDate(${index}, this.value)" style="flex:1;">
                    <input type="text" value="${item.name}" placeholder="ê³µíœ´ì¼/íŠ¹ì´ì‚¬í•­ ë‚´ìš©" oninput="updateCustomHolidayName(${index}, this.value)" style="flex:1;">
                    <button onclick="removeCustomHoliday(${index})" style="background: none; border: none; color: var(--color-error); padding: 0 5px;">ğŸ—‘ï¸</button>
                `;
                listDiv.appendChild(div);
            });
        }

        function addCustomHolidayInput() {
            const today = new Date().toISOString().substring(0, 10);
            // ë°ì´í„° êµ¬ì¡° ë³€ê²½: { date: string, name: string }
            USER_DATA.settings.customHolidays.push({ date: today, name: '' }); 
            saveData();
            renderCustomHolidays();
        }

        function updateCustomHolidayDate(index, dateStr) {
            USER_DATA.settings.customHolidays[index].date = dateStr;
            saveData();
            generateCalendar(false); // ë‚ ì§œ ë³€ê²½ ì‹œ ë‹¬ë ¥ ì¬ìƒì„± í•„ìš”
        }

        function updateCustomHolidayName(index, nameStr) {
            USER_DATA.settings.customHolidays[index].name = nameStr;
            saveData();
            // ì´ë¦„ ë³€ê²½ì€ ë‹¬ë ¥ ì¬ìƒì„± ë¶ˆí•„ìš”
        }

        function removeCustomHoliday(index) {
            USER_DATA.settings.customHolidays.splice(index, 1);
            saveData();
            renderCustomHolidays();
            generateCalendar(false);
        }

        // 11. í†µê³„ ë Œë”ë§ ë° í•„í„° (ì”ì—… ì‚­ì œ ë° ì´í•©ê³„ ì¶”ê°€)
        function renderStatistics() {
            const yearFilterEl = document.getElementById('stats-year-filter');
            const monthFilterEl = document.getElementById('stats-month-filter');
            const tableBody = document.getElementById('stats-table-body');
            tableBody.innerHTML = '';

            const statsByPeriod = {};
            const recordedPeriods = new Set();

            for (const dateStr in USER_DATA.workRecords) {
                const record = USER_DATA.workRecords[dateStr];
                if (record.type === 'ë¯¸ì„ íƒ') continue; 
                
                const date = new Date(dateStr);
                const periodKey = getPeriodKeyFromDate(date);
                recordedPeriods.add(periodKey);

                if (!statsByPeriod[periodKey]) {
                    const periodBasePay = USER_DATA.settings.basePays[periodKey] || 0;
                    const isRegularPay = USER_DATA.settings.regularPayChecks[periodKey] || false;
                    const periodAdditionalItems = USER_DATA.settings.additionalItemsByPeriod[periodKey] || []; 
                    
                    statsByPeriod[periodKey] = {
                        'baseAndAdditional': periodBasePay + periodAdditionalItems.reduce((sum, item) => sum + item.amount, 0),
                        'dailyAllowance': 0,
                        'ì£¼ê°„': 0,
                        'ì•¼ê°„': 0,
                        'íŠ¹ê·¼': 0,
                        'íœ´ê°€': 0,
                        'ë°˜ì°¨': 0,
                        // 'ì´ ì”ì—…': 0, // ì‚­ì œë¨
                        'basePayForRate': periodBasePay, 
                        'isRegularPay': isRegularPay
                    };
                }

                const stats = statsByPeriod[periodKey];
                
                const dailyAllowance = calculateDailyPay(dateStr, record, USER_DATA.settings, stats['basePayForRate'], stats['isRegularPay']); 
                stats['dailyAllowance'] += dailyAllowance;

                switch (record.type) {
                    case 'ì£¼ê°„':
                    case '17ì‹œí‡´ê·¼':
                        stats['ì£¼ê°„']++;
                        break;
                    case 'ì•¼ê°„':
                        stats['ì•¼ê°„']++;
                        break;
                    case 'ì£¼ê°„íŠ¹ê·¼':
                        stats['íŠ¹ê·¼']++;
                        break;
                    case 'ì•¼ê°„íŠ¹ê·¼': 
                        stats['íŠ¹ê·¼']++;
                        stats['ì•¼ê°„']++; 
                        break;
                    case 'íœ´ê°€':
                        stats['íœ´ê°€']++;
                        break;
                    case 'ë°˜ì°¨':
                        stats['ë°˜ì°¨'] += 0.5;
                        break;
                }
                // stats['ì´ ì”ì—…'] += record.totalOvertime || 0; // ì”ì—… ê³„ì‚° ë¡œì§ ì‚­ì œ
            }

            // í†µê³„ í•„í„° ì—…ë°ì´íŠ¸: ê¸°ë¡ëœ ê¸°ê°„ë§Œ í‘œì‹œ
            const periodYears = Array.from(new Set(Array.from(recordedPeriods).map(p => p.split('-')[0]))).sort((a, b) => b - a);
            const recordedMonths = Array.from(new Set(Array.from(recordedPeriods).map(p => p.split('-')[1]))).sort((a, b) => a - b);

            const selectedYear = yearFilterEl.value;
            const selectedMonth = monthFilterEl.value;

            // ì—°ë„ í•„í„° ì˜µì…˜ ì±„ìš°ê¸° (ê¸°ë¡ëœ ì—°ë„ + í˜„ì¬ ì—°ë„)
            const currentYear = new Date().getFullYear();
            let yearsToDisplay = new Set([...periodYears.map(String), String(currentYear)]);
            yearFilterEl.innerHTML = Array.from(yearsToDisplay).sort((a, b) => b - a).map(y => 
                `<option value="${y}" ${y == selectedYear ? 'selected' : ''}>${y}ë…„</option>`
            ).join('');

            // ì›” í•„í„° ì˜µì…˜ ì±„ìš°ê¸° (ì „ì²´ + ê¸°ë¡ëœ ì›”)
            monthFilterEl.innerHTML = `<option value="">ì „ì²´ ì›”</option>` + recordedMonths.map(m => {
                const monthName = Number(m) + 'ì›”';
                return `<option value="${Number(m)}" ${m == selectedMonth ? 'selected' : ''}>${monthName}</option>`;
            }).join('');


            const yearFilter = yearFilterEl.value;
            const monthFilter = monthFilterEl.value;

            let totalSumOfFilteredPeriods = 0; // NEW: í•„í„°ë§ëœ ì´í•©ê³„ë¥¼ ì €ì¥í•  ë³€ìˆ˜

            // í…Œì´ë¸” ë Œë”ë§
            const sortedKeys = Object.keys(statsByPeriod).sort((a, b) => b.localeCompare(a));
            
            let filteredPeriods = sortedKeys.filter(periodKey => {
                const [year, month] = periodKey.split('-');
                if (yearFilter && year != yearFilter) return false;
                if (monthFilter !== "" && Number(month) != Number(monthFilter)) return false; 
                return true;
            });


            filteredPeriods.forEach(periodKey => {
                const stats = statsByPeriod[periodKey];
                const [year, month] = periodKey.split('-');

                const totalAmount = stats['dailyAllowance'] + (stats['basePayForRate'] > 0 ? stats['baseAndAdditional'] : 0); 
                
                totalSumOfFilteredPeriods += totalAmount; // NEW: ì´í•©ê³„ ëˆ„ì 

                const row = tableBody.insertRow();
                row.classList.add('stats-summary-row');

                row.insertCell().textContent = `${year}/${Number(month)}`;
                row.insertCell().textContent = Math.round(totalAmount).toLocaleString('ko-KR') + "ì›"; 
                row.insertCell().textContent = stats['ì£¼ê°„'] + (stats['ì£¼ê°„'] > 0 ? 'ì¼' : '');
                row.insertCell().textContent = stats['ì•¼ê°„'] + (stats['ì•¼ê°„'] > 0 ? 'ì¼' : '');
                row.insertCell().textContent = stats['íŠ¹ê·¼'] + (stats['íŠ¹ê·¼'] > 0 ? 'ì¼' : '');
                row.insertCell().textContent = (stats['íœ´ê°€'] + stats['ë°˜ì°¨']) + 'ì¼'; 
                // ì”ì—…(h) ì…€ ì‚­ì œë¨
            });
            
            // NEW: ì´ í•©ê³„ ê¸ˆì•¡ í‘œì‹œ
            document.getElementById('stats-total-sum').textContent = 
                `ì´ í•©ê³„: ${Math.round(totalSumOfFilteredPeriods).toLocaleString('ko-KR')} ì›`;


            if (filteredPeriods.length === 0) {
                 const row = tableBody.insertRow();
                 row.insertCell().textContent = "ì„ íƒëœ ì¡°ê±´ì— ê¸°ë¡ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.";
                 row.cells[0].colSpan = 6; // ì»¬ëŸ¼ ê°¯ìˆ˜ 6ê°œë¡œ ìˆ˜ì • (ê¸°ê°„, ì´ì•¡, ì£¼ê°„, ì•¼ê°„, íŠ¹ê·¼, íœ´ê°€)
            }
        }

        // 12. íƒ­ ì „í™˜ (ë³€ê²½ ì—†ìŒ)
        document.getElementById('tab-calendar').addEventListener('click', () => switchTab('calendar'));
        document.getElementById('tab-statistics').addEventListener('click', () => { switchTab('statistics'); renderStatistics(); });
        document.getElementById('tab-settings').addEventListener('click', () => { switchTab('settings'); renderOvertimeSettings(); renderClassChangeHistory(); }); 

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.tab-button').forEach(el => el.classList.remove('active'));

            document.getElementById(`tab-content-${tabName}`).style.display = 'block';
            document.getElementById(`tab-${tabName}`).classList.add('active');
            
            if (tabName === 'statistics') {
                renderStatistics();
            } else if (tabName === 'settings') {
                renderOvertimeSettings();
                renderClassChangeHistory(); 
            }
            if (tabName === 'calendar') {
                 renderAdditionalItems(); 
                 updateSalary(); 
            }
        }

        // 13. ì´ˆê¸° ë¡œë“œ (ë³€ê²½ ì—†ìŒ)
        document.addEventListener('DOMContentLoaded', loadData);

    </script>

</body>
</html>
