<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ìŠ¤ë§ˆíŠ¸ ì›”ê¸‰ ê³„ì‚° Ver.1.7.0 [GDì‹œíì–´]</title>
    <style>
        /* === 1. ë‹¤í¬ ëª¨ë“œ ë° ê¸°ë³¸ ìŠ¤íƒ€ì¼ === */
        :root {
            --color-bg: #121212;
            --color-surface: #1E1E1E;
            --color-text: #E0E0E0;
            --color-text-secondary: #AAAAAA;
            --color-primary: #00BFFF;
            --color-secondary: #FF6F00;
            --color-error: #CF6679;
            --color-highlight: rgba(0, 191, 255, 0.15);
            --color-disabled: #383838;
            --color-border: #444444;
            --color-night-shift-dark: #2A3B4D;
            --shadow-elevation: 0 4px 8px rgba(0, 0, 0, 0.5);
            --mobile-padding: 16px;
        }

        :root.light-mode {
            --color-bg: #F5F5F5;
            --color-surface: #FFFFFF;
            --color-text: #212121;
            --color-text-secondary: #757575;
            --color-primary: #1976D2;
            --color-secondary: #FFA000;
            --color-error: #D32F2F;
            --color-highlight: rgba(25, 118, 210, 0.1);
            --color-disabled: #BDBDBD;
            --color-border: #E0E0E0;
            --color-night-shift-dark: #E3F2FD;
            --shadow-elevation: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        body {
            background-color: var(--color-bg);
            color: var(--color-text);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* === ë¼ì´íŠ¸ ëª¨ë“œ íŠ¹í™” ìŠ¤íƒ€ì¼ === */
        :root.light-mode .day-cell { background-color: #FAFAFA; }
        :root.light-mode .day-cell.disabled { background-color: #EEEEEE; color: var(--color-disabled); }
        :root.light-mode .day-cell.night-shift-background { background-color: var(--color-night-shift-dark); }
        :root.light-mode .day-cell.night-shift-background.disabled { background-color: #ECEFF1; }
        :root.light-mode .input-group input,
        :root.light-mode .input-group select,
        :root.light-mode .overtime-input-row select,
        :root.light-mode .overtime-input-row input,
        :root.light-mode #stats-year-filter,
        :root.light-mode #stats-month-filter,
        :root.light-mode #overtime-list-container select {
            background-color: #FFFFFF;
            color: var(--color-text);
            border: 1px solid var(--color-border);
        }
        :root.light-mode .radio-group label { background-color: #EEEEEE; color: var(--color-text-secondary); }
        :root.light-mode .radio-group input[type="radio"]:checked + label { background-color: var(--color-primary); color: #FFFFFF; }
        :root.light-mode .modal-actions button.primary { color: #FFFFFF; }
        :root.light-mode .modal-actions button.secondary { background-color: #E0E0E0; color: #424242; }
        :root.light-mode #tab-content-settings small { color: var(--color-text-secondary) !important; }
        :root.light-mode button { color: var(--color-text); }
        :root.light-mode button[onclick^="add"],
        :root.light-mode button[onclick^="backup"],
        :root.light-mode button[onclick*="restore"] { background-color: #E0E0E0; color: #424242; }
        :root.light-mode button[onclick="copyPreviousMonthBasePay()"] { background-color: var(--color-secondary); color: #FFFFFF; }
        :root.light-mode button[onclick="resetAllData()"] { background-color: var(--color-error); color: #FFFFFF; }
        :root.light-mode .weekdays .saturday { color: var(--color-primary); }


        /* === ë ˆì´ì•„ì›ƒ ë° íƒ­ === */
        .app-container { flex-grow: 1; display: flex; flex-direction: column; }
        .header { background-color: var(--color-surface); padding: 12px var(--mobile-padding); box-shadow: var(--shadow-elevation); position: sticky; top: 0; z-index: 100; }
        .header h1 { font-size: 1.4em; margin: 0; text-align: center; }
        .tab-bar { display: flex; justify-content: space-around; background-color: var(--color-surface); border-bottom: 1px solid var(--color-border); }
        .tab-button { flex: 1; padding: 12px 0; text-align: center; font-size: 1em; cursor: pointer; border: none; background: none; color: var(--color-text); opacity: 0.6; transition: opacity 0.3s, color 0.3s, border-bottom 0.3s; }
        .tab-button.active { color: var(--color-primary); opacity: 1; border-bottom: 3px solid var(--color-primary); }
        .content-area { flex-grow: 1; overflow-y: auto; position: relative; }

        /* === ê¸‰ì—¬ ì„¹ì…˜ === */
        #salary-input-section { background-color: var(--color-surface); padding: 10px var(--mobile-padding); margin-bottom: 10px; border-radius: 8px; margin: 10px var(--mobile-padding); position: relative; }
        .salary-summary h2 { font-size: 1.6em; color: var(--color-primary); margin: 0 0 5px 0; }
        .salary-summary small { color: var(--color-text-secondary); }
        .salary-summary-header { display: flex; justify-content: space-between; align-items: center; }
        .input-group, .checkbox-group { display: flex; align-items: center; margin-bottom: 8px; }
        .input-group label { flex: 2; font-size: 0.9em; }
        .input-group input, .input-group select { flex: 3; padding: 8px; border: 1px solid var(--color-border); border-radius: 4px; background-color: var(--color-bg); color: var(--color-text); font-size: 1em; }
        #additional-items-list div { display: flex; align-items: center; gap: 10px; margin-bottom: 5px; }
        #additional-items-list input { flex: 1; }
        #toggle-salary-details { position: absolute; top: 10px; right: 10px; background: none; border: none; color: var(--color-primary); font-size: 1.5em; cursor: pointer; padding: 5px; transition: transform 0.3s; line-height: 1; }
        .collapsed #toggle-salary-details { transform: rotate(180deg); }
        #salary-details-container.collapsed { display: none; }
        #calculated-stats { background-color: var(--color-bg) !important; border: 1px solid var(--color-border) !important; }
        #calculated-stats .stats-row span:first-child { color: var(--color-text-secondary); }
        /* Fix 4: í† ê¸€ ìŠ¤ìœ„ì¹˜ ê°€ë¡œ ë„“ì´ ìˆ˜ì • - í…ìŠ¤íŠ¸ ë ˆì´ë¸”ê³¼ ìŠ¤ìœ„ì¹˜ ì˜ì—­ ë¹„ìœ¨ ì¡°ì • */
        .checkbox-group label { 
            flex: 1 1 0%; 
            font-size: 0.9em; 
        } 
        .checkbox-group .toggle-switch { 
            flex: 0 0 50px; /* ê³ ì • í­ 50px */
            min-width: 50px; 
        }


        /* === ë‹¬ë ¥ ì„¹ì…˜ === */
        #calendar-view { overflow-y: scroll; height: calc(100vh - 200px); scroll-snap-type: y mandatory; }
        .calendar-month { scroll-snap-align: center; background-color: var(--color-surface); margin: 10px var(--mobile-padding); border-radius: 8px; padding: 10px; opacity: 0.3; transition: opacity 0.3s, transform 0.3s; }
        .calendar-month.active { opacity: 1; }
        .month-header { text-align: center; font-size: 1.5em; margin-bottom: 10px; color: var(--color-primary); }
        .weekdays { display: grid; grid-template-columns: repeat(7, 1fr); text-align: center; font-size: 0.8em; margin-bottom: 5px; }
        .weekdays span { color: var(--color-text-secondary); }
        .weekdays .sunday { color: var(--color-error); }
        .weekdays .saturday { color: var(--color-primary); }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; }
        .day-cell { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 5px 0; border-radius: 6px; font-size: 1em; min-height: 50px; cursor: pointer; position: relative; background-color: var(--color-bg); transition: background-color 0.2s; border: 1px solid transparent; }
        .day-cell.night-shift-background { background-color: var(--color-night-shift-dark); }
        :root:not(.light-mode) .day-cell.night-shift-background.disabled { background-color: #262626; opacity: 0.7; }
        .day-cell:not(.disabled):active { background-color: var(--color-highlight); }
        .day-number { font-weight: bold; margin-bottom: 2px; font-size: 1em; }
        .day-status { font-size: 0.7em; font-weight: 500; color: var(--color-primary); margin-bottom: 1px; line-height: 1; min-height: 0.8em; }
        .day-overtime { font-size: 0.7em; color: var(--color-secondary); min-height: 0.8em; line-height: 1; }
        .holiday .day-number { color: var(--color-error); }
        .day-cell.disabled { color: var(--color-disabled); background-color: var(--color-surface); cursor: default; opacity: 0.6; }
        .today { border: 1px solid var(--color-secondary); }

        /* === ëª¨ë‹¬ === */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); display: none; justify-content: center; align-items: center; z-index: 200; }
        .modal-content { background-color: var(--color-surface); padding: var(--mobile-padding); border-radius: 12px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: var(--shadow-elevation); }
        .modal-content h3 { margin-top: 0; border-bottom: 1px solid var(--color-border); padding-bottom: 10px; color: var(--color-primary); }
        .form-row { margin-bottom: 15px; }
        .form-row label { display: block; margin-bottom: 5px; font-weight: bold; }
        .radio-group { display: flex; flex-wrap: wrap; gap: 10px; }
        .radio-group input[type="radio"] { display: none; }
        .radio-group label { background-color: var(--color-bg); padding: 8px 12px; border-radius: 20px; cursor: pointer; transition: background-color 0.2s, color 0.2s; font-weight: normal; border: 1px solid var(--color-border); }
        .radio-group input[type="radio"]:checked + label { background-color: var(--color-primary); color: var(--color-bg); font-weight: bold; border-color: var(--color-primary); }
        .overtime-input-row { display: grid; grid-template-columns: 2fr 1fr 0.5fr; gap: 10px; align-items: center; margin-top: 5px; }
        .overtime-input-row select, .overtime-input-row input { padding: 8px; border: 1px solid var(--color-border); border-radius: 4px; background-color: var(--color-bg); color: var(--color-text); font-size: 0.9em; }
        .overtime-input-row input[readonly] { cursor: default; opacity: 0.8; background-color: var(--color-disabled); color: var(--color-text-secondary); }
        .modal-actions { display: flex; justify-content: space-between; margin-top: 20px; gap: 10px;}
        .modal-actions button { flex:1; padding: 10px 15px; border: none; border-radius: 20px; font-size: 1em; cursor: pointer; transition: opacity 0.2s; white-space: nowrap; }
        .modal-actions button.primary { background-color: var(--color-primary); color: var(--color-bg); }
        .modal-actions button.secondary { background-color: var(--color-disabled); color: var(--color-text); }
        .modal-actions button.danger { background-color: var(--color-error); color: #FFFFFF; }

        /* === ê¸°íƒ€ UI ìš”ì†Œ === */
        .float-button { position: fixed; bottom: 20px; right: 20px; background-color: var(--color-secondary); color: var(--color-bg); border: none; border-radius: 50%; width: 50px; height: 50px; font-size: 1.5em; display: flex; align-items: center; justify-content: center; box-shadow: var(--shadow-elevation); z-index: 150; }
        #statistics-view { padding: var(--mobile-padding); }
        .stats-filter { display: flex; gap: 10px; margin-bottom: 20px; }
        .stats-filter select { flex: 1; padding: 8px; border: 1px solid var(--color-border); border-radius: 4px; background-color: var(--color-bg); color: var(--color-text); }
        .stats-table { width: 100%; border-collapse: collapse; }
        .stats-table th, .stats-table td { padding: 12px 5px; text-align: left; border-bottom: 1px solid var(--color-border); font-size: 0.9em; white-space: nowrap; }
        .stats-table th { color: var(--color-primary); font-weight: bold; }
        .stats-table td:not(:first-child), .stats-table th:not(:first-child) { text-align: right; }
        /* Fix 7: ì†Œì†ë°˜ ì„¤ì • ì„¤ëª…ê¸€ ì¤„ ë°”ê¿ˆ */
        #tab-content-settings small { 
            color: var(--color-text-secondary) !important; 
            opacity: 1; 
            white-space: pre-wrap; /* ğŸ’¡ ì¤„ ë°”ê¿ˆ ì†ì„± ì¶”ê°€ */
        }
        #initial-setup-modal .modal-content { width: 80%; }
        #initial-setup-modal input { width: 100%; box-sizing: border-box; }
        #overtime-list-container div, .change-record-row { display: flex; align-items: center; gap: 10px; margin-bottom: 5px; }
        #overtime-list-container input, #overtime-list-container select { flex: 1; }
        .change-record-row select, .change-record-row input[type="date"] { flex: 1; }
        hr { border: none; border-top: 1px solid var(--color-border); }

        /* === í† ê¸€ ìŠ¤ìœ„ì¹˜ === */
        .toggle-switch { position: relative; display: inline-block; width: 50px; height: 28px; flex-shrink: 0; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--color-disabled); transition: .4s; border-radius: 28px; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--color-primary); }
        input:checked + .slider:before { transform: translateX(22px); }
    </style>
</head>
<body>

    <div class="app-container">
        <header class="header">
            <h1 id="app-title">ìŠ¤ë§ˆíŠ¸ ì›”ê¸‰ ê³„ì‚°</h1>
            <button id="today-button" class="float-button" title="ì˜¤ëŠ˜ ë‚ ì§œë¡œ ì´ë™" style="bottom: auto; top: 10px; right: 10px; width: 40px; height: 40px; font-size: 1.2em;">ğŸ“…</button>
        </header>

        <div class="tab-bar">
            <button class="tab-button active" id="tab-calendar">ë‹¬ë ¥/ì…ë ¥</button>
            <button class="tab-button" id="tab-statistics">í†µê³„</button>
            <button class="tab-button" id="tab-settings">ì„¤ì •</button>
        </div>

        <div class="content-area">
            <div id="tab-content-calendar" class="tab-content">
                <section id="salary-input-section">
                    <div class="salary-summary-header">
                        <div>
                            <small id="salary-period-info">ì´ ì˜ˆìƒ ì›”ê¸‰ (ê¸°ê°„ ì •ë³´ ë¡œë”© ì¤‘...)</small>
                            <h2 id="total-expected-salary">0 ì›</h2>
                        </div>
                        <button id="toggle-salary-details" onclick="toggleSalaryDetails()">â–¼</button>
                    </div>

                    <div id="salary-details-container">
                        <div id="current-salary-options" style="font-size:0.8em; color: var(--color-primary);"></div>
                        <div id="calculated-stats" style="margin-top: 5px; margin-bottom: 15px; padding: 10px; border: 1px solid var(--color-disabled); border-radius: 4px; background-color: var(--color-bg);">
                            <div class="stats-row" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                <span style="flex: 2;">í‰ì¼ì”ì—…ì‹œê°„:</span>
                                <span id="stat-weekday-ot-time-count" style="flex: 1; text-align: right; font-weight: bold; margin-right: 10px;">0.0h</span>
                                <span id="stat-weekday-ot-time-amount" style="flex: 2; text-align: right; color: var(--color-primary);">0 ì›</span>
                            </div>
                            <div class="stats-row" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                <span style="flex: 2;">íŠ¹ê·¼ì”ì—…ì‹œê°„:</span>
                                <span id="stat-special-ot-time-count" style="flex: 1; text-align: right; font-weight: bold; margin-right: 10px;">0.0h</span>
                                <span id="stat-special-ot-time-amount" style="flex: 2; text-align: right; color: var(--color-primary);">0 ì›</span>
                            </div>
                            <div class="stats-row" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                <span style="flex: 2;">íŠ¹ê·¼ì¼ìˆ˜:</span>
                                <span id="stat-special-day-count-count" style="flex: 1; text-align: right; font-weight: bold; margin-right: 10px;">0ì¼</span>
                                <span id="stat-special-day-count-amount" style="flex: 2; text-align: right; color: var(--color-primary);">0 ì›</span>
                            </div>
                            <div class="stats-row" style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="flex: 2;">ì•¼ê°„ì¼ìˆ˜:</span>
                                <span id="stat-night-day-count-count" style="flex: 1; text-align: right; font-weight: bold; margin-right: 10px;">0ì¼</span>
                                <span id="stat-night-day-count-amount" style="flex: 2; text-align: right; color: var(--color-primary);">0 ì›</span>
                            </div>
                        </div>

                        <div class="input-group" style="margin-top: 10px;">
                            <label for="base-pay">ê¸°ë³¸ê¸‰ ì…ë ¥</label>
                            <div style="display:flex; gap: 5px; flex: 3;">
                                <input type="number" id="base-pay" placeholder="ê¸°ë³¸ê¸‰" oninput="saveBasePaySetting()" style="flex: 1;">
                                <button onclick="copyPreviousMonthBasePay()" style="background-color: var(--color-secondary); color: var(--color-bg); padding: 5px 10px; border: none; border-radius: 4px; font-size: 0.8em; line-height: 1.2; text-align: center; width: 60px; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer;">ì´ì „ë‹¬<br>ê¸°ë³¸ê¸‰</button>
                            </div>
                        </div>
                        <div class="checkbox-group">
                            <label for="regular-pay-check">í†µìƒì„ê¸ˆ í¬í•¨</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="regular-pay-check" onchange="saveRegularPayCheckSetting()">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <hr>
                        <label style="font-size: 0.9em;">ì¶”ê°€ ìˆ˜ë‹¹ ëª©ë¡ (í˜„ì¬ ê¸°ê°„ì—ë§Œ ì ìš©):</label>
                        <div id="additional-items-list"></div>
                        <button onclick="addAdditionalItem()" style="background-color: var(--color-disabled); color: var(--color-text); padding: 5px 10px; border: none; border-radius: 4px; margin-top: 5px;">+ ì¶”ê°€ í•­ëª©</button>
                    </div>
                </section>
                <div id="calendar-view"></div>
            </div>

            <div id="tab-content-statistics" class="tab-content" style="display:none;">
                <section id="statistics-view">
                    <h3>ì›”ë³„ ê·¼ë¬´ í†µê³„</h3>
                    <div id="stats-total-sum" style="font-size: 1.5em; color: var(--color-secondary); margin-bottom: 15px; text-align: right;">ì´ í•©ê³„: 0 ì›</div>
                    <div class="stats-filter">
                        <select id="stats-year-filter" onchange="renderStatistics()"></select>
                        <select id="stats-month-filter" onchange="renderStatistics()">
                            <option value="0">ì „ì²´ ì›”</option>
                            <option value="1">1ì›”</option><option value="2">2ì›”</option><option value="3">3ì›”</option><option value="4">4ì›”</option><option value="5">5ì›”</option><option value="6">6ì›”</option>
                            <option value="7">7ì›”</option><option value="8">8ì›”</option><option value="9">9ì›”</option><option value="10">10ì›”</option><option value="11">11ì›”</option><option value="12">12ì›”</option>
                        </select>
                    </div>
                    <table class="stats-table">
                        <thead><tr><th>ê¸°ê°„</th><th>ì´ ê¸‰ì—¬</th><th>ì•¼ê°„</th><th>íŠ¹ê·¼</th><th>íœ´ê°€/ë°˜ì°¨</th></tr></thead>
                        <tbody id="stats-table-body"></tbody>
                    </table>
                </section>
            </div>

            <div id="tab-content-settings" class="tab-content" style="display:none;">
                <section style="padding: var(--mobile-padding);">
                    <h3>ì‚¬ìš©ì ë° ë°˜ ì„¤ì •</h3>
                    <div class="form-row"><label for="setting-account">ë‚´ ê³„ì • ì •ë³´ (ê¸°ê¸°ë‹¹ ê³ ìœ )</label><input type="text" id="setting-account" disabled></div>
                    <div class="form-row">
                        <label for="setting-class">ì†Œì† ë°˜ (í˜„ì¬ ê¸°ì¤€)</label>
                        <select id="setting-class" onchange="saveSettings();"><option value="A">Aë°˜</option><option value="B">Bë°˜</option><option value="C">Cë°˜</option><option value="D">Dë°˜</option></select>
                        <small>* Aë°˜ ì•¼ê°„ ì‹œì‘ì¼ì€ 2025-01-05ë¡œ ê³ ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</small>
                    </div>
                    <hr>
                    <h3>ë°˜ ë³€ê²½ ê¸°ë¡ ê´€ë¦¬</h3>
                    <small>* ë°˜ ë³€ê²½ì¼ ì´í›„ë¶€í„° ë³€ê²½ëœ ë°˜ì˜ ë¡œí…Œì´ì…˜ì´ ì ìš©ë©ë‹ˆë‹¤.</small>
                    <div id="class-change-history-list"></div>
                    <button onclick="addClassChangeRecordInput()" style="background-color: var(--color-disabled); color: var(--color-text); padding: 5px 10px; border: none; border-radius: 4px; margin-top: 5px;">+ ë°˜ ë³€ê²½ ê¸°ë¡ ì¶”ê°€</button>
                    <hr>
                    <h3>ì”ì—… ì¢…ë¥˜ ê´€ë¦¬</h3>
                    <div class="form-row">
                        <label style="font-size: 0.9em;">ì”ì—… ì´ë¦„ê³¼ ê¸°ë³¸ ì‹œê°„ì„ ì„¤ì •í•©ë‹ˆë‹¤.</label>
                        <div id="overtime-list-container"></div>
                        <button onclick="addOvertimeSettingItem()" style="background-color: var(--color-disabled); color: var(--color-text); padding: 5px 10px; border: none; border-radius: 4px; margin-top: 5px;">+ ì”ì—… ì¢…ë¥˜ ì¶”ê°€</button>
                    </div>
                    <hr>
                    <h3>ì‚¬ìš©ì ì§€ì • ê³µíœ´ì¼</h3>
                    <div id="custom-holidays-list"></div>
                    <button onclick="addCustomHolidayInput()" style="background-color: var(--color-disabled); color: var(--color-text); padding: 5px 10px; border: none; border-radius: 4px; margin-top: 5px;">+ ê³µíœ´ì¼ ì¶”ê°€</button>
                    <hr>
                    <h3>í…Œë§ˆ ì„¤ì •</h3>
                    <div class="form-row checkbox-group">
                        <label for="theme-toggle">ë¼ì´íŠ¸ ëª¨ë“œ í™œì„±í™”</label>
                         <label class="toggle-switch"><input type="checkbox" id="theme-toggle" onchange="toggleTheme(this.checked)"><span class="slider"></span></label>
                    </div>
                    <hr>
                    <h3>ë°ì´í„° ë°±ì—…/ë³µêµ¬</h3>
                    <div class="form-row" style="display:flex; gap: 10px;">
                        <button onclick="backupData()" style="flex: 1; padding: 10px; border: none; border-radius: 4px; background-color: var(--color-primary); color: var(--color-bg); cursor: pointer; font-weight: bold;">ë°±ì—…</button>
                        <button onclick="document.getElementById('file-upload-input').click()" style="flex: 1; padding: 10px; border: none; border-radius: 4px; background-color: var(--color-disabled); color: var(--color-text); cursor: pointer; font-weight: bold;">ë³µêµ¬</button>
                        <input type="file" id="file-upload-input" accept="application/json" onchange="restoreData(event)" style="display:none;">
                    </div>
                    <hr>
                    <button onclick="resetAllData()" style="width: 100%; background-color: var(--color-error); color: #FFFFFF; padding: 10px 20px; border: none; border-radius: 20px; font-size: 1em; cursor: pointer;">ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™” (ì£¼ì˜)</button>
                </section>
            </div>
        </div>
    </div>

    <div id="work-record-modal" class="modal">
        <div class="modal-content">
            <h3 id="modal-date-title">ê·¼ë¬´ ê¸°ë¡ ì…ë ¥</h3><input type="hidden" id="modal-selected-date">
            <div class="form-row"><label>ê·¼ë¬´ í˜•íƒœ</label><div class="radio-group" id="work-type-group"><input type="radio" id="type-ì£¼ê°„" name="work-type" value="ì£¼ê°„"><label for="type-ì£¼ê°„">ì£¼ê°„</label><input type="radio" id="type-ì•¼ê°„" name="work-type" value="ì•¼ê°„"><label for="type-ì•¼ê°„">ì•¼ê°„</label><input type="radio" id="type-ì£¼íŠ¹" name="work-type" value="ì£¼ê°„íŠ¹ê·¼"><label for="type-ì£¼íŠ¹">ì£¼ê°„íŠ¹ê·¼</label><input type="radio" id="type-ì•¼íŠ¹" name="work-type" value="ì•¼ê°„íŠ¹ê·¼"><label for="type-ì•¼íŠ¹">ì•¼ê°„íŠ¹ê·¼</label><input type="radio" id="type-17ì‹œ" name="work-type" value="17ì‹œí‡´ê·¼"><label for="type-17ì‹œ">17ì‹œ í‡´ê·¼</label><input type="radio" id="type-íœ´ë¬´" name="work-type" value="íœ´ë¬´"><label for="type-íœ´ë¬´">íœ´ë¬´</label><input type="radio" id="type-íœ´ê°€" name="work-type" value="íœ´ê°€"><label for="type-íœ´ê°€">íœ´ê°€</label><input type="radio" id="type-ë°˜ì°¨" name="work-type" value="ë°˜ì°¨"><label for="type-ë°˜ì°¨">ë°˜ì°¨</label><input type="radio" id="type-ë¯¸ì„ íƒ" name="work-type" value="ë¯¸ì„ íƒ"><label for="type-ë¯¸ì„ íƒ">ë¯¸ì„ íƒ</label></div></div>
            <div class="form-row" id="overtime-input-section">
                <label>ì¶”ê°€ ì”ì—… (ê¸°ë³¸ ê·¼ë¬´ ì™¸)</label>
                <div class="overtime-input-row" style="font-weight: bold; color: var(--color-primary);"><div>ì¢…ë¥˜</div><div>ì‹œê°„(h)</div><div>ì‚­ì œ</div></div>
                <div id="modal-overtime-list"></div>
                <button onclick="addOvertimeRow(true)" style="background-color: var(--color-disabled); color: var(--color-text); padding: 5px 10px; border: none; border-radius: 4px; margin-top: 10px;">+ ì”ì—… ì¶”ê°€</button>
            </div>
            <div class="modal-actions"><button onclick="closeModal('work-record-modal')" class="secondary">ë‹«ê¸°</button><button onclick="deleteWorkRecord()" class="danger" id="delete-record-btn" style="display:none;">ì‚­ì œ</button><button onclick="saveWorkRecord()" class="primary">ì €ì¥/ìˆ˜ì •</button></div>
        </div>
    </div>
    <div id="initial-setup-modal" class="modal" style="display:none;">
        <div class="modal-content">
            <h3>ì´ˆê¸° ì„¤ì •</h3><p>ì‚¬ìš©ì„ ìœ„í•´ ê¸°ë³¸ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
            <div class="form-row">
                <label for="init-class">ì†Œì† ë°˜ì„ ì„ íƒí•˜ì„¸ìš”.</label>
                <select id="init-class"><option value="A">Aë°˜</option><option value="B">Bë°˜</option><option value="C">Cë°˜</option><option value="D">Dë°˜</option></select>
                <small>* Aë°˜ ì•¼ê°„ ì‹œì‘ì¼ì€ 2025-01-05ë¡œ ê³ ì •ë©ë‹ˆë‹¤.</small>
            </div>
            <div class="modal-actions"><button onclick="completeInitialSetup()" class="primary" style="width: 100%;">ì„¤ì • ì™„ë£Œ</button></div>
        </div>
    </div>
    <div id="confirm-modal" class="modal" style="z-index: 300;">
        <div class="modal-content">
            <h3 id="confirm-modal-title">í™•ì¸</h3>
            <p id="confirm-modal-text" style="line-height: 1.5;"></p>
            <div class="modal-actions">
                <button id="confirm-modal-cancel" class="secondary">ì·¨ì†Œ</button>
                <button id="confirm-modal-ok" class="danger">í™•ì¸</button>
            </div>
        </div>
    </div>


    <script>
        const CURRENT_APP_VERSION = "1.7.0";
        const DEFAULT_OVERTIME_MAP = { 'ì£¼ê°„': 3.0, 'ì•¼ê°„': 4.5, 'ì£¼ê°„íŠ¹ê·¼': 0.5, 'ì•¼ê°„íŠ¹ê·¼': 7.0, '17ì‹œí‡´ê·¼': 0.5 };
        
        // ğŸ’¡ Fix 1: ê¸°ë³¸ ê³µíœ´ì¼ ë°ì´í„°ë¥¼ ìƒìˆ˜ë¡œ ë¶„ë¦¬í•˜ì—¬ localStorageì— ì˜í•´ ë®ì–´ì“°ì´ì§€ ì•Šë„ë¡ ë³´ì¥
        const DEFAULT_HOLIDAYS_BASE = [ 
            { date: '2024-01-01', name: 'ì‹ ì •' }, { date: '2024-02-09', name: 'ì„¤ë‚ ' }, { date: '2024-02-10', name: 'ì„¤ë‚ ' }, { date: '2024-02-11', name: 'ì„¤ë‚ ' }, { date: '2024-02-12', name: 'ì„¤ë‚  ëŒ€ì²´ê³µíœ´ì¼' }, { date: '2024-03-01', name: 'ì‚¼ì¼ì ˆ' }, 
            { date: '2024-04-10', name: 'êµ­íšŒì˜ì›ì„ ê±°ì¼' }, { date: '2024-05-05', name: 'ì–´ë¦°ì´ë‚ ' }, { date: '2024-05-06', name: 'ì–´ë¦°ì´ë‚  ëŒ€ì²´ê³µíœ´ì¼' }, { date: '2024-05-15', name: 'ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ' }, 
            { date: '2024-06-06', name: 'í˜„ì¶©ì¼' }, { date: '2024-08-15', name: 'ê´‘ë³µì ˆ' }, { date: '2024-09-16', name: 'ì¶”ì„' }, { date: '2024-09-17', name: 'ì¶”ì„' }, { date: '2024-09-18', name: 'ì¶”ì„' },
            { date: '2024-10-03', name: 'ê°œì²œì ˆ' }, { date: '2024-10-09', name: 'í•œê¸€ë‚ ' }, { date: '2024-12-25', name: 'ì„±íƒ„ì ˆ' },
            { date: '2025-01-01', name: 'ì‹ ì •' }, { date: '2025-01-29', name: 'ì„¤ë‚ ' }, { date: '2025-01-30', name: 'ì„¤ë‚ ' }, { date: '2025-01-31', name: 'ì„¤ë‚ ' }, { date: '2025-03-01', name: 'ì‚¼ì¼ì ˆ' }, 
            { date: '2025-05-05', name: 'ì–´ë¦°ì´ë‚ ' }, { date: '2025-05-26', name: 'ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ' }, { date: '2025-06-06', name: 'í˜„ì¶©ì¼' }, { date: '2025-08-15', name: 'ê´‘ë³µì ˆ' }, 
            { date: '2025-10-03', name: 'ê°œì²œì ˆ' }, { date: '2025-10-06', name: 'ì¶”ì„' }, { date: '2025-10-07', name: 'ì¶”ì„' }, { date: '2025-10-08', name: 'ì¶”ì„' }, { date: '2025-10-09', name: 'í•œê¸€ë‚ ' }, 
            { date: '2025-12-25', name: 'ì„±íƒ„ì ˆ' }
        ];
        
        let USER_DATA = {
            appVersion: CURRENT_APP_VERSION,
            account: Date.now().toString(),
            class: 'A',
            A_night_start: '2025-01-05',
            settings: { 
                basePays: {}, 
                regularPayChecks: {}, 
                additionalItemsByPeriod: {}, 
                customHolidays: DEFAULT_HOLIDAYS_BASE, // ì´ˆê¸°ê°’ìœ¼ë¡œ ê¸°ë³¸ ê³µíœ´ì¼ ì„¤ì •
                isSalaryDetailsCollapsed: false, 
                classChangeHistory: [], 
                isLightMode: false, 
                overtimeList: [ { name: 'G1ì¡°ì¶œ', time: 1.0 }, { name: 'G2ì¡°ì¶œ', time: 1.0 }, { name: 'G2ì§€ì›', time: 0.5 }, { name: 'G3ì¡°ì¶œ', time: 1.0 }, { name: 'G5ì¡°ì¶œ', time: 1.0 }, { name: 'G5ì§€ì›', time: 0.5 }, { name: 'R&Dì¡°ì¶œ', time: 1.0 }, { name: 'R&Dì§€ì›', time: 0.5 }, { name: 'ë²„ìŠ¤ê²€ì°¨', time: 0.5 }] 
            },
            workRecords: {}
        };

        // --- Helper Functions ---
        const getPeriodKeyFromDate = date => { let y = date.getFullYear(), m = date.getMonth(); if (date.getDate() < 20) { m--; if (m < 0) { m = 11; y--; } } return `${y}-${String(m + 1).padStart(2, '0')}`; };
        const getCurrentActivePeriodKey = () => { const el = document.querySelector('.calendar-month.active'); if (!el) return getPeriodKeyFromDate(new Date()); const [, y, m] = el.id.split('-'); return getPeriodKeyFromDate(new Date(Number(y), Number(m), 1)); };
        const getSalaryPeriodByPeriodKey = key => { if (!key) return null; const [y, m] = key.split('-').map(Number); const sd = new Date(y, m - 1, 20); const ed = new Date(y, m, 19); ed.setHours(23, 59, 59, 999); return { startDate: sd, endDate: ed }; };
        const getPreviousPeriodKey = key => { if (!key) return null; let [y, m] = key.split('-').map(Number); m--; if (m === 0) { m = 12; y--; } return `${y}-${String(m).padStart(2, '0')}`; };
        const formatDate = date => `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;

        // --- Data Management ---
        const saveData = () => { USER_DATA.appVersion = CURRENT_APP_VERSION; USER_DATA.settings.classChangeHistory.sort((a, b) => new Date(a.changeDate) - new Date(b.changeDate)); localStorage.setItem('smartSalaryApp_user_data', JSON.stringify(USER_DATA)); };
        const loadData = () => {
            const data = localStorage.getItem('smartSalaryApp_user_data');
            if (!data) { applyTheme(false); document.getElementById('initial-setup-modal').style.display = 'flex'; return; }
            let loadedData;
            try { loadedData = JSON.parse(data); } catch (e) { document.getElementById('initial-setup-modal').style.display = 'flex'; return; }
            if (!loadedData.appVersion || loadedData.appVersion < CURRENT_APP_VERSION) {
                // Future migration logic can go here
            }
            loadedData.A_night_start = '2025-01-05';

            // ğŸ’¡ Fix 2: ê¸°ë³¸ ê³µíœ´ì¼ ëª©ë¡ê³¼ ì‚¬ìš©ì ì •ì˜ ê³µíœ´ì¼ì„ ë³‘í•©í•˜ì—¬ ê¸°ë³¸ ëª©ë¡ ëˆ„ë½ ë°©ì§€
            const existingCustomHolidays = loadedData.settings?.customHolidays || [];
            
            // 1. ê¸°ë³¸ ê³µíœ´ì¼ ëª©ë¡(DEFAULT_HOLIDAYS_BASE)ì„ Mapì˜ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •
            const allHolidays = new Map(DEFAULT_HOLIDAYS_BASE.map(h => [h.date, h]));
            
            // 2. ì‚¬ìš©ì ì €ì¥ ëª©ë¡ì„ ì¶”ê°€ (ë‚ ì§œê°€ ê²¹ì¹˜ë©´ ì‚¬ìš©ì ëª©ë¡ì´ ìš°ì„ í•¨)
            existingCustomHolidays.forEach(h => allHolidays.set(h.date, h));

            // 3. ë¡œë“œëœ ë°ì´í„°ì— ë³‘í•©ëœ ê³µíœ´ì¼ ëª©ë¡ì„ ë‹¤ì‹œ ì„¤ì • (USER_DATAì— ë¡œë“œë  ë•Œ ì ìš©)
            if (!loadedData.settings) loadedData.settings = {};
            loadedData.settings.customHolidays = Array.from(allHolidays.values());
            
            USER_DATA = { ...USER_DATA, ...loadedData };
            
            applyTheme(USER_DATA.settings.isLightMode);
            document.getElementById('setting-account').value = USER_DATA.account;
            document.getElementById('setting-class').value = USER_DATA.class;
            document.getElementById('theme-toggle').checked = USER_DATA.settings.isLightMode;
            renderCustomHolidays();
            renderOvertimeSettings();
            renderClassChangeHistory();
            if (USER_DATA.settings.isSalaryDetailsCollapsed) {
                document.getElementById('salary-input-section').classList.add('collapsed');
                document.getElementById('salary-details-container').classList.add('collapsed');
                document.getElementById('toggle-salary-details').textContent = 'â–²';
            }
            generateCalendar(true);
        };
        const completeInitialSetup = () => {
            const initClass = document.getElementById('init-class').value;
            USER_DATA.class = initClass;
            saveData();
            document.getElementById('setting-class').value = initClass; 
            document.getElementById('initial-setup-modal').style.display = 'none';
            generateCalendar(true);
        };

        // --- Work Type Calculation ---
        const getClassForDate = date => { const dateStr = formatDate(date); let cls = USER_DATA.class; for (let i = USER_DATA.settings.classChangeHistory.length - 1; i >= 0; i--) { const r = USER_DATA.settings.classChangeHistory[i]; if (dateStr >= r.changeDate) { cls = r.newClass; break; } } return cls; };
        const getCalculatedWorkType = (date, cls, start) => { 
            const s = new Date(start); 
            if (isNaN(s)) return { type: 'ë¯¸ì„ íƒ' }; 
            const diff = Math.floor((new Date(date.getFullYear(), date.getMonth(), date.getDate()) - s) / 864e5);
            
            // ğŸ’¡ Fix 1: ì•¼ê°„ ì‹œì‘ì¼ í‘œì‹œ ë°€ë¦¼ ìˆ˜ì •. diffì— 1ì„ ë”í•´ ë¡œí…Œì´ì…˜ ì‹œì‘ì ì„ ì¡°ì •í•¨.
            const w = (Math.floor((diff + 1) / 7) % 3 + 3) % 3; 
            
            let type = 'ì£¼ê°„'; 
            if ((cls === 'A' && w === 0) || (cls === 'B' && w === 1) || (cls === 'C' && w === 2)) type = 'ì•¼ê°„'; 
            return { type }; 
        };
        const isHoliday = date => USER_DATA.settings.customHolidays.some(h => h.date === formatDate(date));

        // --- Salary Calculation ---
        const calculatePeriodStats = (periodKey) => {
            const stats = { totalSalary: 0, nightDays: 0, specialDays: 0, vacationDays: 0, weekdayOT: 0, specialOT: 0, nightAmount: 0, specialAmount: 0, weekdayOTAmount: 0, specialOTAmount: 0, basePay: 0, finalHourlyWage: 0 };
            const period = getSalaryPeriodByPeriodKey(periodKey);
            if (!period) return stats;

            const standardMonthlyHours = 226;
            stats.basePay = USER_DATA.settings.basePays[periodKey] || 0;
            const isRegularPayChecked = USER_DATA.settings.regularPayChecks[periodKey] || false;
            
            let effectiveBasePay = stats.basePay;
            // 4. í†µìƒì„ê¸ˆ ê³„ì‚° ë¡œì§ ìˆ˜ì •
            if (isRegularPayChecked) {
                const regularPayAnnualBonus = 2000000;
                effectiveBasePay += (regularPayAnnualBonus / 12);
            }
            const hourlyWage = stats.basePay > 0 ? effectiveBasePay / standardMonthlyHours : 0;
            stats.finalHourlyWage = hourlyWage;

            let tempDate = new Date(period.startDate);
            while (tempDate <= period.endDate) {
                const dateStr = formatDate(tempDate);
                const workRecord = USER_DATA.workRecords[dateStr];
                if (workRecord && workRecord.type !== 'ë¯¸ì„ íƒ') {
                    if (workRecord.type.includes('ì•¼ê°„')) stats.nightDays++;
                    if (workRecord.type.includes('íŠ¹ê·¼')) stats.specialDays++;
                    if (workRecord.type === 'íœ´ê°€') stats.vacationDays++;
                    else if (workRecord.type === 'ë°˜ì°¨') stats.vacationDays += 0.5;

                    let totalOvertime = 0;
                    totalOvertime += DEFAULT_OVERTIME_MAP[workRecord.type] || 0; 
                    if (workRecord.overtimes) totalOvertime += workRecord.overtimes.reduce((sum, item) => sum + (Number(item.time) || 0), 0);

                    if (totalOvertime > 0) {
                        const isHolidayDay = isHoliday(tempDate) || tempDate.getDay() === 0;
                        if (workRecord.type.includes('íŠ¹ê·¼') || isHolidayDay) stats.specialOT += totalOvertime;
                        else stats.weekdayOT += totalOvertime;
                    }
                }
                tempDate.setDate(tempDate.getDate() + 1);
            }
            
            stats.weekdayOTAmount = stats.weekdayOT * hourlyWage * 1.5;
            stats.specialOTAmount = stats.specialOT * hourlyWage * 2.0;
            stats.specialAmount = stats.specialDays * hourlyWage * 1.5 * 8; 
            stats.nightAmount = stats.nightDays * hourlyWage * 0.5 * 8; 
            
            const additionalItems = USER_DATA.settings.additionalItemsByPeriod[periodKey] || [];
            const totalAdditionalAmount = additionalItems.reduce((sum, item) => sum + item.amount, 0);
            stats.totalSalary = stats.basePay + stats.weekdayOTAmount + stats.specialOTAmount + stats.specialAmount + stats.nightAmount + totalAdditionalAmount;
            return stats;
        };
        const updateSalary = () => {
            const currentKey = getCurrentActivePeriodKey();
            if (!currentKey) return;
            const stats = calculatePeriodStats(currentKey);
            document.getElementById('total-expected-salary').textContent = Math.round(stats.totalSalary).toLocaleString() + ' ì›';
            document.getElementById('current-salary-options').textContent = `ì ìš©ì‹œê¸‰: ${stats.finalHourlyWage.toLocaleString(undefined, { maximumFractionDigits: 0 })}ì›`;
            ['weekday-ot-time', 'special-ot-time', 'special-day-count', 'night-day-count'].forEach(key => {
                let count = 0, amount = 0;
                
                // ğŸ’¡ Fix 5: íŠ¹ê·¼ì¼ìˆ˜ê°€ ì‹œê°„ìœ¼ë¡œ í‘œì‹œë˜ëŠ” ë¬¸ì œ ìˆ˜ì •. keyì— '-ot-time'ì´ í¬í•¨ë  ë•Œë§Œ ì‹œê°„(h)ìœ¼ë¡œ ì²˜ë¦¬
                if(key.includes('-ot-time')) { 
                    const type = key.split('-')[0];
                    count = stats[type + 'OT'].toFixed(1) + 'h';
                    amount = stats[type + 'OTAmount'];
                } else {
                    const type = key.split('-')[0];
                    const statsKey = type === 'special' ? 'specialDays' : 'nightDays';
                    const amountKey = type === 'special' ? 'specialAmount' : 'nightAmount';
                    count = stats[statsKey] + 'ì¼';
                    amount = stats[amountKey];
                }
                document.getElementById(`stat-${key}-count`).textContent = count;
                document.getElementById(`stat-${key}-amount`).textContent = Math.round(amount).toLocaleString() + ' ì›';
            });
        };

        // --- UI Rendering ---
        const generateCalendar = (scrollToToday = false) => {
            const calendarView = document.getElementById('calendar-view');
            calendarView.innerHTML = '';
            const today = new Date();
            let lastScrollMonthId = '';
            for (let y = today.getFullYear() - 1; y <= today.getFullYear() + 1; y++) {
                for (let m = 0; m < 12; m++) {
                    const monthId = `month-${y}-${m}`;
                    const monthElement = document.createElement('div');
                    monthElement.className = 'calendar-month';
                    monthElement.id = monthId;
                    const grid = document.createElement('div');
                    grid.className = 'calendar-grid';
                    monthElement.innerHTML = `<div class="month-header">${y}ë…„ ${m + 1}ì›”</div><div class="weekdays"><span class="sunday">ì¼</span><span>ì›”</span><span>í™”</span><span>ìˆ˜</span><span>ëª©</span><span>ê¸ˆ</span><span class="saturday">í† </span></div>`;
                    monthElement.appendChild(grid);
                    const firstDay = new Date(y, m, 1);
                    const daysInMonth = new Date(y, m + 1, 0).getDate();
                    for (let i = 0; i < firstDay.getDay(); i++) grid.insertAdjacentHTML('beforeend', '<div class="day-cell disabled"></div>');
                    for (let day = 1; day <= daysInMonth; day++) {
                        const date = new Date(y, m, day);
                        const dateStr = formatDate(date);
                        const dayCell = document.createElement('div');
                        dayCell.className = 'day-cell';
                        dayCell.setAttribute('data-date', dateStr);
                        if (formatDate(today) === dateStr) { dayCell.classList.add('today'); lastScrollMonthId = monthId; }
                        dayCell.onclick = () => openWorkRecordModal(dateStr);
                        grid.appendChild(dayCell);
                        updateDayCell(dateStr, dayCell);
                    }
                    calendarView.appendChild(monthElement);
                }
            }
            calendarView.removeEventListener('scroll', updateActiveMonth);
            calendarView.addEventListener('scroll', updateActiveMonth);
            if (scrollToToday && lastScrollMonthId) scrollToTodayMonth(lastScrollMonthId);
            else updateActiveMonth();
        };
        const updateDayCell = (dateStr, cell) => {
            const dayCell = cell || document.querySelector(`.day-cell[data-date="${dateStr}"]`);
            if (!dayCell) return;
            const date = new Date(dateStr);
            const day = date.getDate();
            const workRecord = USER_DATA.workRecords[dateStr];
            const activeClass = getClassForDate(date);
            const calculated = getCalculatedWorkType(date, activeClass, USER_DATA.A_night_start);
            
            const workType = workRecord ? workRecord.type : '';
            let dayStatusText = workType === 'ë¯¸ì„ íƒ' ? '' : workType; // work recordê°€ ìˆìœ¼ë©´ work type, ì•„ë‹ˆë©´ ''
            
            // ğŸ’¡ Fix 3: ê³µíœ´ì¼ í…ìŠ¤íŠ¸ í‘œì‹œ ë¡œì§ ìˆ˜ì •
            dayCell.classList.toggle('night-shift-background', calculated.type.includes('ì•¼ê°„'));
            dayCell.classList.toggle('holiday', isHoliday(date) || date.getDay() === 0);
            
            // ê³µíœ´ì¼ì´ë©´ì„œ ê·¼ë¬´ í˜•íƒœê°€ ê¸°ë¡ë˜ì§€ ì•Šì€(dayStatusTextê°€ ë¹„ì–´ìˆëŠ”) ê²½ìš°ì—ë§Œ 'ê³µíœ´ì¼' í…ìŠ¤íŠ¸ í‘œì‹œ
            if (isHoliday(date) && dayStatusText === '') { 
                dayStatusText = '';
            }
            
            // ğŸ’¡ Fix 2: ì”ì—… ì‹œê°„ ì´í•© í‘œì‹œ (ê¸°ë³¸ + ìˆ˜ë™ ì”ì—…)
            let totalOvertime = 0;
            if (workType !== 'ë¯¸ì„ íƒ' && workType !== 'íœ´ë¬´' && workType !== 'íœ´ê°€' && workType !== 'ë°˜ì°¨') {
                totalOvertime += DEFAULT_OVERTIME_MAP[workType] || 0;
            }
            if (workRecord?.overtimes) {
                totalOvertime += workRecord.overtimes.reduce((sum, item) => sum + (Number(item.time) || 0), 0);
            }

            dayCell.innerHTML = `<div class="day-number">${day}</div><div class="day-status" style="color:${calculated.type.includes('ì•¼ê°„') ? 'var(--color-secondary)' : 'var(--color-primary)'};">${dayStatusText}</div><div class="day-overtime">${totalOvertime > 0 ? totalOvertime.toFixed(1) + 'h' : ''}</div>`;
        };
        let scrollTimeout;
        const updateActiveMonth = () => {
            clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(() => {
                const calendarViewRect = document.getElementById('calendar-view').getBoundingClientRect();
                const viewportCenter = calendarViewRect.top + calendarViewRect.height / 2;
                const months = document.querySelectorAll('.calendar-month');
                let closestMonth = null;
                let minDistance = Infinity;
                months.forEach(month => { 
                    const monthRect = month.getBoundingClientRect();
                    const monthCenter = monthRect.top + monthRect.height / 2;
                    const distance = Math.abs(viewportCenter - monthCenter);
                    if (distance < minDistance) { minDistance = distance; closestMonth = month; }
                });
                if (closestMonth && !closestMonth.classList.contains('active')) {
                    months.forEach(m => m.classList.remove('active'));
                    closestMonth.classList.add('active');
                    loadPeriodSettingsToUI(); 
                }
            }, 100);
        };
        const loadPeriodSettingsToUI = () => {
            const currentKey = getCurrentActivePeriodKey();
            if (!currentKey) return;
            const period = getSalaryPeriodByPeriodKey(currentKey);
            if(period) document.getElementById('salary-period-info').textContent = `ì´ ì˜ˆìƒ ì›”ê¸‰ (${formatDate(period.startDate)} ~ ${formatDate(period.endDate)})`;
            document.getElementById('base-pay').value = USER_DATA.settings.basePays[currentKey] || '';
            document.getElementById('regular-pay-check').checked = USER_DATA.settings.regularPayChecks[currentKey] || false;
            renderAdditionalItems(currentKey);
            updateSalary();
        };

        // --- Work Record Modal ---
        const openWorkRecordModal = (dateStr) => {
            document.getElementById('modal-date-title').textContent = `${dateStr} ê·¼ë¬´ ê¸°ë¡`;
            document.getElementById('modal-selected-date').value = dateStr;
            document.querySelectorAll('input[name="work-type"]').forEach(i => i.checked = false);
            document.getElementById('modal-overtime-list').innerHTML = '';
            const workRecord = USER_DATA.workRecords[dateStr];
            if (workRecord) {
                const typeInput = document.getElementById(`type-${workRecord.type}`);
                if (typeInput) typeInput.checked = true;
                if (workRecord.overtimes) workRecord.overtimes.forEach(ot => addOvertimeRow(false, ot.name, ot.time));
                document.getElementById('delete-record-btn').style.display = 'inline-block';
            } else {
                document.getElementById('type-ë¯¸ì„ íƒ').checked = true;
                document.getElementById('delete-record-btn').style.display = 'none';
            }
            document.getElementById('work-record-modal').style.display = 'flex';
        };
        const saveWorkRecord = () => {
            const dateStr = document.getElementById('modal-selected-date').value;
            const type = document.querySelector('input[name="work-type"]:checked')?.value;
            if (!type) return;
            const overtimes = [];
            document.querySelectorAll('#modal-overtime-list .overtime-input-row').forEach(row => {
                const name = row.querySelector('select').value;
                const time = Number(row.querySelector('input[type="number"]').value);
                if (name && time > 0) overtimes.push({ name, time });
            });
            USER_DATA.workRecords[dateStr] = { date: dateStr, type, overtimes };
            saveData();
            updateDayCell(dateStr); updateSalary(); closeModal('work-record-modal');
        };
        const deleteWorkRecord = () => {
            const dateStr = document.getElementById('modal-selected-date').value;
            showConfirm(`${dateStr} ê¸°ë¡ ì‚­ì œ`, 'ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?', () => {
                delete USER_DATA.workRecords[dateStr];
                saveData(); updateDayCell(dateStr); updateSalary(); closeModal('work-record-modal');
            });
        };
        const addOvertimeRow = (isNew, name = '', time = '') => {
            const container = document.getElementById('modal-overtime-list');
            const row = document.createElement('div');
            row.className = 'overtime-input-row';
            const options = USER_DATA.settings.overtimeList.map(item => `<option value="${item.name}" ${item.name === name ? 'selected' : ''}>${item.name}</option>`).join('');
            row.innerHTML = `<select><option value="">--- ì„ íƒ ---</option>${options}</select><input type="number" step="0.5" placeholder="ì‹œê°„" value="${time}" readonly><button onclick="this.parentNode.remove()" style="background:none; border:none; color:var(--color-error); font-size:1.2em; padding:0; cursor:pointer;">&times;</button>`;
            row.querySelector('select').addEventListener('change', function() {
                const selected = USER_DATA.settings.overtimeList.find(i => i.name === this.value);
                this.nextElementSibling.value = selected ? selected.time : '';
            });
            container.appendChild(row);
        };
        
        // --- Settings Functions ---
        const saveBasePaySetting = () => { const key = getCurrentActivePeriodKey(); if (key) { USER_DATA.settings.basePays[key] = Number(document.getElementById('base-pay').value) || 0; saveData(); updateSalary(); } };
        const saveRegularPayCheckSetting = () => { const key = getCurrentActivePeriodKey(); if (key) { USER_DATA.settings.regularPayChecks[key] = document.getElementById('regular-pay-check').checked; saveData(); updateSalary(); } };
        const saveSettings = () => { USER_DATA.class = document.getElementById('setting-class').value; saveData(); generateCalendar(); };
        const addOvertimeSettingItem = (name = '', time = 0.5) => { 
             const container = document.getElementById('overtime-list-container');
             const div = document.createElement('div');
             let timeOptions = '';
             for (let i = 0; i <= 10; i += 0.5) timeOptions += `<option value="${i}" ${i === time ? 'selected' : ''}>${i.toFixed(1)}h</option>`;
             div.innerHTML = `<input type="text" placeholder="ì”ì—… ì´ë¦„" value="${name}" oninput="saveOvertimeSettings()"><select onchange="saveOvertimeSettings()">${timeOptions}</select><button onclick="this.parentNode.remove(); saveOvertimeSettings();" style="background: none; border: none; color: var(--color-error); padding: 5px; font-size: 1.2em;">&times;</button>`;
             container.appendChild(div);
        };
        const saveOvertimeSettings = () => {
             const list = [];
             document.querySelectorAll('#overtime-list-container > div').forEach(div => {
                 const name = div.querySelector('input[type="text"]').value;
                 const time = Number(div.querySelector('select').value);
                 if (name) list.push({ name, time });
             });
             USER_DATA.settings.overtimeList = list; saveData();
        };

        // --- Generic Functions ---
        const switchTab = (tabName) => { document.querySelectorAll('.tab-content').forEach(c => c.style.display = 'none'); document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active')); document.getElementById(`tab-content-${tabName}`).style.display = 'block'; document.getElementById(`tab-${tabName}`).classList.add('active'); if (tabName === 'statistics') { populateStatsFilter(); renderStatistics(); } else if (tabName === 'calendar') { loadPeriodSettingsToUI(); } };
        const closeModal = (modalId) => document.getElementById(modalId).style.display = 'none';
        const showConfirm = (title, text, onOk) => { 
            const modal = document.getElementById('confirm-modal');
            document.getElementById('confirm-modal-title').textContent = title;
            document.getElementById('confirm-modal-text').textContent = text;
            const okBtn = document.getElementById('confirm-modal-ok');
            const cancelBtn = document.getElementById('confirm-modal-cancel');
            const okListener = () => { onOk(); close(); };
            const cancelListener = () => close();
            const close = () => { modal.style.display = 'none'; okBtn.removeEventListener('click', okListener); cancelBtn.removeEventListener('click', cancelListener); };
            okBtn.addEventListener('click', okListener);
            cancelBtn.addEventListener('click', cancelListener);
            modal.style.display = 'flex';
        };
        const resetAllData = () => showConfirm('ë°ì´í„° ì´ˆê¸°í™”', 'ê²½ê³ : ëª¨ë“  ì €ì¥ëœ ë°ì´í„°ë¥¼ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œí•˜ê³  ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?', () => { localStorage.removeItem('smartSalaryApp_user_data'); window.location.reload(); }); 
        const backupData = () => { const dataStr = JSON.stringify(USER_DATA); const blob = new Blob([dataStr], { type: 'application/json' }); const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `smartSalaryApp_backup_${formatDate(new Date())}.json`; a.click(); URL.revokeObjectURL(a.href); };
        const restoreData = (event) => { const file = event.target.files[0]; if (!file) return; showConfirm('ë°ì´í„° ë³µêµ¬', 'í˜„ì¬ ë°ì´í„°ë¥¼ ë®ì–´ì“°ê³  ë³µêµ¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?', () => { const reader = new FileReader(); reader.onload = (e) => { try { const data = JSON.parse(e.target.result); if (!data.account) throw new Error("Invalid data"); localStorage.setItem('smartSalaryApp_user_data', JSON.stringify(data)); window.location.reload(); } catch (err) { /* Show error modal in future */ } }; reader.readAsText(file); }); event.target.value = ''; };

        // --- Unchanged Functions (Shortened for brevity) ---
        const toggleSalaryDetails = () => { const collapsed = document.getElementById('salary-input-section').classList.toggle('collapsed'); document.getElementById('salary-details-container').classList.toggle('collapsed'); document.getElementById('toggle-salary-details').textContent = collapsed ? 'â–²' : 'â–¼'; USER_DATA.settings.isSalaryDetailsCollapsed = collapsed; saveData(); };
        const copyPreviousMonthBasePay = () => { const prevKey = getPreviousPeriodKey(getCurrentActivePeriodKey()); const prevPay = USER_DATA.settings.basePays[prevKey] || 0; if (prevPay > 0) { document.getElementById('base-pay').value = prevPay; saveBasePaySetting(); } };
        const addAdditionalItem = (n = '', a = '') => { const c = document.getElementById('additional-items-list'); const d = document.createElement('div'); d.innerHTML = `<input type="text" placeholder="ìˆ˜ë‹¹ ì´ë¦„" value="${n}" oninput="saveAdditionalItems()"><input type="number" placeholder="ê¸ˆì•¡" value="${a}" oninput="saveAdditionalItems()"><button onclick="this.parentNode.remove(); saveAdditionalItems();" style="background: none; border: none; color: var(--color-error); padding: 5px; font-size: 1.2em;">&times;</button>`; c.appendChild(d); };
        const renderAdditionalItems = key => { const c = document.getElementById('additional-items-list'); c.innerHTML = ''; if (key) (USER_DATA.settings.additionalItemsByPeriod[key] || []).forEach(i => addAdditionalItem(i.name, i.amount)); };
        const saveAdditionalItems = () => { const key = getCurrentActivePeriodKey(); if (!key) return; const items = []; document.querySelectorAll('#additional-items-list > div').forEach(d => { const n = d.querySelector('input[type="text"]').value, a = Number(d.querySelector('input[type="number"]').value); if (n) items.push({ name: n, amount: a }); }); USER_DATA.settings.additionalItemsByPeriod[key] = items; saveData(); updateSalary(); };
        const populateStatsFilter = () => { const yf = document.getElementById('stats-year-filter'); const years = new Set(); Object.keys(USER_DATA.settings.basePays).forEach(k => years.add(k.substring(0, 4))); Object.keys(USER_DATA.workRecords).forEach(d => years.add(d.substring(0, 4))); years.add(new Date().getFullYear().toString()); const sorted = Array.from(years).sort((a, b) => b - a); yf.innerHTML = '<option value="all">ì „ì²´ ë…„ë„</option>'; sorted.forEach(y => yf.innerHTML += `<option value="${y}">${y}ë…„</option>`); yf.value = new Date().getFullYear(); };
        const renderStatistics = () => { const yVal = document.getElementById('stats-year-filter').value, mVal = Number(document.getElementById('stats-month-filter').value), tb = document.getElementById('stats-table-body'); tb.innerHTML = ''; let years = yVal === 'all' ? Array.from(document.getElementById('stats-year-filter').options).map(o => o.value).filter(v => v !== 'all') : [yVal]; let total = 0; years.forEach(y => { for (let m = (mVal || 1); m <= (mVal || 12); m++) { const key = `${y}-${String(m).padStart(2, '0')}`; const s = calculatePeriodStats(key); if (s.totalSalary > 0) { tb.innerHTML += `<tr><td>${y}ë…„ ${m}ì›”</td><td>${Math.round(s.totalSalary).toLocaleString()} ì›</td><td>${s.nightDays}ì¼</td><td>${s.specialDays}ì¼</td><td>${s.vacationDays}ì¼</td></tr>`; total += s.totalSalary; } } }); document.getElementById('stats-total-sum').textContent = `ì´ í•©ê³„: ${Math.round(total).toLocaleString()} ì›`; };
        const renderCustomHolidays = () => { document.getElementById('custom-holidays-list').innerHTML = ''; USER_DATA.settings.customHolidays.filter(h => !DEFAULT_HOLIDAYS_BASE.some(d => d.date === h.date)).forEach(h => addCustomHolidayInput(h.date, h.name)); }; // ê¸°ë³¸ ê³µíœ´ì¼ì€ ì œì™¸í•˜ê³  ì‚¬ìš©ì ì¶”ê°€ ê³µíœ´ì¼ë§Œ ì„¤ì •ì— í‘œì‹œ
        const addCustomHolidayInput = (d = '', n = '') => { const c = document.getElementById('custom-holidays-list'); c.insertAdjacentHTML('beforeend', `<div style="display: flex; gap: 10px; margin-bottom: 5px;"><input type="date" value="${d}" onchange="saveCustomHolidays()"><input type="text" placeholder="ê³µíœ´ì¼ ì´ë¦„" value="${n}" oninput="saveCustomHolidays()"><button onclick="this.parentNode.remove(); saveCustomHolidays();" style="background:none;border:none;color:var(--color-error);font-size:1.2em;">&times;</button></div>`); };
        const saveCustomHolidays = () => { 
            const h = [...DEFAULT_HOLIDAYS_BASE]; // ê¸°ë³¸ ê³µíœ´ì¼ì„ ë² ì´ìŠ¤ë¡œ ì‹œì‘
            const addedHolidays = new Set(DEFAULT_HOLIDAYS_BASE.map(d => d.date));
            document.querySelectorAll('#custom-holidays-list > div').forEach(d => { 
                const date = d.querySelector('input[type="date"]').value; 
                const name = d.querySelector('input[type="text"]').value || 'ì§€ì • ê³µíœ´ì¼';
                if (date && !addedHolidays.has(date)) { // ì¤‘ë³µ í™•ì¸ í›„ ì‚¬ìš©ì ì •ì˜ ê³µíœ´ì¼ ì¶”ê°€
                     h.push({ date, name }); 
                }
            }); 
            USER_DATA.settings.customHolidays = h; saveData(); generateCalendar(); 
        };
        const renderOvertimeSettings = () => { document.getElementById('overtime-list-container').innerHTML = ''; USER_DATA.settings.overtimeList.forEach(i => addOvertimeSettingItem(i.name, i.time)); };
        const renderClassChangeHistory = () => { document.getElementById('class-change-history-list').innerHTML = ''; USER_DATA.settings.classChangeHistory.forEach(r => addClassChangeRecordInput(r.changeDate, r.newClass)); };
        const addClassChangeRecordInput = (d = '', c = USER_DATA.class) => { const cont = document.getElementById('class-change-history-list'); const opts = ['A', 'B', 'C', 'D'].map(v => `<option value="${v}" ${v === c ? 'selected' : ''}>${v}ë°˜</option>`).join(''); cont.insertAdjacentHTML('beforeend', `<div class="change-record-row"><input type="date" value="${d}" onchange="saveClassChangeHistory()"><select onchange="saveClassChangeHistory()">${opts}</select><button onclick="this.parentNode.remove(); saveClassChangeHistory();" style="background:none;border:none;color:var(--color-error);font-size:1.2em;">&times;</button></div>`); };
        const saveClassChangeHistory = () => { const h = []; document.querySelectorAll('#class-change-history-list > div').forEach(d => { const date = d.querySelector('input[type="date"]').value; if (date) h.push({ changeDate: date, newClass: d.querySelector('select').value }); }); USER_DATA.settings.classChangeHistory = h; saveData(); generateCalendar(); };
        const toggleTheme = (isLight) => { USER_DATA.settings.isLightMode = isLight; saveData(); applyTheme(isLight); };
        const applyTheme = (isLight) => document.documentElement.classList.toggle('light-mode', isLight);
        
        const scrollToTodayMonth = (id = null) => { 
            const today = new Date(); 
            const monthId = id || `month-${today.getFullYear()}-${today.getMonth()}`; 
            const el = document.getElementById(monthId); 
            if (el) { 
                el.scrollIntoView({ behavior: 'auto', block: 'start' }); 
                setTimeout(() => updateActiveMonth(), 50); 
            } 
        };

        // --- Event Listeners ---
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('tab-calendar').addEventListener('click', () => switchTab('calendar'));
            document.getElementById('tab-statistics').addEventListener('click', () => switchTab('statistics'));
            document.getElementById('tab-settings').addEventListener('click', () => switchTab('settings'));
            document.getElementById('today-button').addEventListener('click', () => scrollToTodayMonth());
            document.getElementById('work-type-group').addEventListener('change', () => document.getElementById('modal-overtime-list').innerHTML = ''); 
            loadData();
        });
    </script>
</body>
</html>
