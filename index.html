<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ìŠ¤ë§ˆíŠ¸ ì›”ê¸‰ ê³„ì‚° Premium [GDì‹œíì–´]</title>

<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="ì›”ê¸‰ ê³„ì‚°ê¸°">
<meta name="theme-color" content="#00BFFF">

<style>
    /* === ğŸ’¡ ì „ì—­ ì„¤ì • === */
    *, *::before, *::after { box-sizing: border-box; }
    html { -webkit-text-size-adjust: 100%; text-size-adjust: 100%; width: 100%; height: 100%; overflow-x: hidden; }
    input, select { min-width: 0; }

    /* === ë‹¤í¬/ë¼ì´íŠ¸ ëª¨ë“œ ë³€ìˆ˜ === */
    :root {
        --color-bg: #121212; --color-surface: #1E1E1E; --color-text: #E0E0E0; --color-text-secondary: #AAAAAA;
        --color-primary: #00BFFF; --color-secondary: #FF6F00; --color-error: #CF6679;
        --color-success: #00E676; /* ì¶”ê°€ëœ ì„±ê³µ ìƒ‰ìƒ */
        --color-highlight: rgba(0, 191, 255, 0.15); --color-disabled: #383838; --color-border: #444444;
        --color-night-shift-dark: #2A3B4D; --shadow-elevation: 0 4px 8px rgba(0, 0, 0, 0.5); --mobile-padding: 16px;
    }
    :root.light-mode {
        --color-bg: #F5F5F5; --color-surface: #FFFFFF; --color-text: #212121; --color-text-secondary: #757575;
        --color-primary: #1976D2; --color-secondary: #FFA000; --color-error: #D32F2F;
        --color-success: #388E3C;
        --color-highlight: rgba(25, 118, 210, 0.1); --color-disabled: #BDBDBD; --color-border: #E0E0E0;
        --color-night-shift-dark: #E3F2FD; --shadow-elevation: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    body { background-color: var(--color-bg); color: var(--color-text); font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 0; display: flex; flex-direction: column; min-height: 100vh; width: 100%; overflow-x: hidden; position: relative; touch-action: pan-y; -webkit-font-smoothing: antialiased; word-break: keep-all; overflow-wrap: break-word; }

    /* === ë¼ì´íŠ¸ ëª¨ë“œ ìŠ¤íƒ€ì¼ ì˜¤ë²„ë¼ì´ë“œ === */
    :root.light-mode .day-cell { background-color: #FAFAFA; }
    :root.light-mode .day-cell.disabled { background-color: #EEEEEE; color: var(--color-disabled); }
    :root.light-mode .day-cell.night-shift-background { background-color: var(--color-night-shift-dark); }
    :root.light-mode .day-cell.night-shift-background.disabled { background-color: #ECEFF1; }
    :root.light-mode .input-group input, :root.light-mode .input-group select, :root.light-mode .overtime-input-row select, :root.light-mode .overtime-input-row input, :root.light-mode #stats-year-filter, :root.light-mode #stats-month-filter, :root.light-mode #stats-view-mode, :root.light-mode #overtime-list-container select { background-color: #FFFFFF; color: var(--color-text); border: 1px solid var(--color-border); }
    :root.light-mode .radio-group label { background-color: #EEEEEE; color: var(--color-text-secondary); }
    :root.light-mode .radio-group input[type="radio"]:checked + label { background-color: var(--color-primary); color: #FFFFFF; }
    :root.light-mode .sub-tab-button { background-color: #E0E0E0; color: #757575; }
    :root.light-mode .sub-tab-button.active { background-color: var(--color-primary); color: #FFFFFF; }

    /* === ë ˆì´ì•„ì›ƒ === */
    .app-container { flex-grow: 1; display: flex; flex-direction: column; padding-top: 0; width: 100%; max-width: 100vw; z-index: 10; position: relative; }
    .header { background-color: var(--color-surface); padding: 12px var(--mobile-padding); box-shadow: var(--shadow-elevation); position: sticky; top: 0; z-index: 100; width: 100%; }
    .header h1 { font-size: 1.4em; margin: 0; text-align: center; }
    .tab-bar { display: flex; justify-content: space-around; background-color: var(--color-surface); border-bottom: 1px solid var(--color-border); width: 100%; }
    .tab-button { flex: 1; padding: 12px 0; text-align: center; font-size: 1em; cursor: pointer; border: none; background: none; color: var(--color-text); opacity: 0.6; transition: opacity 0.3s, color 0.3s, border-bottom 0.3s; }
    .tab-button.active { color: var(--color-primary); opacity: 1; border-bottom: 3px solid var(--color-primary); }
    .content-area { flex-grow: 1; overflow-y: auto; position: relative; width: 100%; }

    /* === ê¸‰ì—¬ ì„¹ì…˜ === */
    #salary-input-section { background-color: var(--color-surface); padding: 10px var(--mobile-padding); margin-bottom: 10px; border-radius: 8px; margin: 10px var(--mobile-padding); position: relative; }
    .salary-summary h2 { font-size: 1.6em; color: var(--color-primary); margin: 0 0 5px 0; }
    .salary-summary small { color: var(--color-text-secondary); }
    .salary-summary-header { display: flex; justify-content: space-between; align-items: center; }
    .input-group, .checkbox-group { display: flex; align-items: center; margin-bottom: 8px; }
    .input-group label { flex: 2; font-size: 0.9em; }
    .input-group input, .input-group select { flex: 3; padding: 8px; border: 1px solid var(--color-border); border-radius: 4px; background-color: var(--color-bg); color: var(--color-text); font-size: 1em; }
    #additional-items-list div { display: flex; align-items: center; gap: 10px; margin-bottom: 5px; }
    #additional-items-list input { flex: 1; }
    #toggle-salary-details { position: absolute; top: 10px; right: 10px; background: none; border: none; color: var(--color-primary); font-size: 1.5em; cursor: pointer; padding: 5px; transition: transform 0.3s; line-height: 1; }
    .collapsed #toggle-salary-details { transform: rotate(180deg); }
    #salary-details-container.collapsed { display: none; }
    #calculated-stats { background-color: var(--color-bg) !important; border: 1px solid var(--color-border) !important; }
    #calculated-stats .stats-row span:first-child { color: var(--color-text-secondary); }
    .checkbox-group label { flex: 1 1 0%; font-size: 0.9em; } 
    .checkbox-group .toggle-switch { flex: 0 0 50px; min-width: 50px; }

    /* === 1ì›” ë¶„í•  íƒ­ ìŠ¤íƒ€ì¼ === */
    .sub-tab-container { display: flex; gap: 5px; margin-bottom: 15px; border-bottom: 1px solid var(--color-border); padding-bottom: 5px; }
    .sub-tab-button { flex: 1; padding: 8px 5px; border: none; background-color: var(--color-disabled); color: var(--color-text-secondary); border-radius: 6px 6px 0 0; cursor: pointer; font-size: 0.8em; transition: all 0.2s; opacity: 0.7; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .sub-tab-button.active { background-color: var(--color-primary); color: white; opacity: 1; font-weight: bold; box-shadow: 0 -2px 5px rgba(0,0,0,0.2); }
    .active-period-indicator { text-align: right; font-size: 0.8em; color: var(--color-secondary); margin-bottom: 5px; font-weight: bold; }

    /* === ë‹¬ë ¥ ì„¹ì…˜ === */
    #calendar-view { overflow-y: scroll; height: calc(100vh - 200px); scroll-snap-type: y mandatory; }
    .calendar-month { scroll-snap-align: center; background-color: var(--color-surface); margin: 10px var(--mobile-padding); border-radius: 8px; padding: 10px; opacity: 0.3; transition: opacity 0.3s, transform 0.3s; }
    .calendar-month.active { opacity: 1; }
    .month-header { text-align: center; font-size: 1.5em; margin-bottom: 10px; color: var(--color-primary); }
    .weekdays { display: grid; grid-template-columns: repeat(7, 1fr); text-align: center; font-size: 0.8em; margin-bottom: 5px; }
    .weekdays span { color: var(--color-text-secondary); }
    .weekdays .sunday { color: var(--color-error); }
    .weekdays .saturday { color: var(--color-primary); }
    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; }
    .day-cell { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 5px 0; border-radius: 6px; font-size: 1em; min-height: 50px; cursor: pointer; position: relative; background-color: var(--color-bg); transition: background-color 0.2s; border: 1px solid transparent; overflow: hidden; }
    .day-cell.night-shift-background { background-color: var(--color-night-shift-dark); }
    :root:not(.light-mode) .day-cell.night-shift-background.disabled { background-color: #262626; opacity: 0.7; }
    .day-cell:not(.disabled):active { background-color: var(--color-highlight); }
    .day-number { font-weight: bold; margin-bottom: 2px; font-size: 1em; }
    .day-status { font-size: 0.7em; font-weight: 500; color: var(--color-primary); margin-bottom: 1px; line-height: 1; min-height: 0.8em; width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: center; padding: 0 2px; }
    .day-overtime { font-size: 0.7em; color: var(--color-secondary); min-height: 0.8em; line-height: 1; }
    .holiday .day-number { color: var(--color-error); }
    .day-cell.disabled { color: var(--color-disabled); background-color: var(--color-surface); cursor: default; opacity: 0.6; }
    .today { border: 1px solid var(--color-secondary); }

    /* === ëª¨ë‹¬ ë° ê¸°íƒ€ === */
    .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); display: none; justify-content: center; align-items: center; z-index: 200; }
    .modal-content { background-color: var(--color-surface); padding: var(--mobile-padding); border-radius: 12px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: var(--shadow-elevation); }
    .modal-content h3 { margin-top: 0; border-bottom: 1px solid var(--color-border); padding-bottom: 10px; color: var(--color-primary); }
    .form-row { margin-bottom: 15px; }
    .form-row label { display: block; margin-bottom: 5px; font-weight: bold; }
    .radio-group { display: flex; flex-wrap: wrap; gap: 10px; }
    .radio-group input[type="radio"] { display: none; }
    .radio-group label { background-color: var(--color-bg); padding: 8px 12px; border-radius: 20px; cursor: pointer; transition: background-color 0.2s, color 0.2s; font-weight: normal; border: 1px solid var(--color-border); }
    .radio-group input[type="radio"]:checked + label { background-color: var(--color-primary); color: var(--color-bg); font-weight: bold; border-color: var(--color-primary); }
    .overtime-input-row { display: grid; grid-template-columns: 2fr 1fr 0.5fr; gap: 10px; align-items: center; margin-top: 5px; }
    .overtime-input-row select, .overtime-input-row input { padding: 8px; border: 1px solid var(--color-border); border-radius: 4px; background-color: var(--color-bg); color: var(--color-text); font-size: 0.9em; }
    .overtime-input-row input[readonly] { cursor: default; opacity: 0.8; background-color: var(--color-disabled); color: var(--color-text-secondary); }
    .modal-actions { display: flex; justify-content: space-between; margin-top: 20px; gap: 10px;}
    .modal-actions button { flex:1; padding: 10px 15px; border: none; border-radius: 20px; font-size: 1em; cursor: pointer; transition: opacity 0.2s; white-space: nowrap; }
    .modal-actions button.primary { background-color: var(--color-primary); color: var(--color-bg); }
    .modal-actions button.secondary { background-color: var(--color-disabled); color: var(--color-text); }
    .modal-actions button.danger { background-color: var(--color-error); color: #FFFFFF; }
    .float-button { position: fixed; bottom: 20px; right: 20px; background-color: var(--color-secondary); color: var(--color-bg); border: none; border-radius: 50%; width: 50px; height: 50px; font-size: 1.5em; display: flex; align-items: center; justify-content: center; box-shadow: var(--shadow-elevation); z-index: 150; }
    #statistics-view { padding: var(--mobile-padding); }
    .stats-filter { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
    .stats-filter select { flex: 1; padding: 8px; border: 1px solid var(--color-border); border-radius: 4px; background-color: var(--color-bg); color: var(--color-text); min-width: 100px; }
    .table-scroll-wrapper { overflow-x: auto; -webkit-overflow-scrolling: touch; }
    .stats-table { width: 100%; border-collapse: collapse; }
    .stats-table th, .stats-table td { padding: 12px 5px; text-align: left; border-bottom: 1px solid var(--color-border); font-size: 0.9em; white-space: nowrap; }
    .stats-table th { color: var(--color-primary); font-weight: bold; }
    .stats-table td:not(:first-child), .stats-table th:not(:first-child) { text-align: right; }
    #tab-content-settings small { color: var(--color-text-secondary) !important; opacity: 1; white-space: pre-wrap; }
    #initial-setup-modal .modal-content { width: 80%; }
    #initial-setup-modal input { width: 100%; }
    #overtime-list-container div, .change-record-row { display: flex; align-items: center; gap: 10px; margin-bottom: 5px; }
    #overtime-list-container input, #overtime-list-container select { flex: 1; }
    .change-record-row select, .change-record-row input[type="date"] { flex: 1; }
    hr { border: none; border-top: 1px solid var(--color-border); }
    .toggle-switch { position: relative; display: inline-block; width: 50px; height: 28px; flex-shrink: 0; }
    .toggle-switch input { opacity: 0; width: 0; height: 0; }
    .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--color-disabled); transition: .4s; border-radius: 28px; }
    .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
    input:checked + .slider { background-color: var(--color-primary); }
    input:checked + .slider:before { transform: translateX(22px); }

    /* === í†µê³„ ìƒì„¸ ë³´ê¸° ë° ëŒ€ì‹œë³´ë“œ ìŠ¤íƒ€ì¼ (ì¶”ê°€ë¨) === */
    .stats-dashboard { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; background-color: var(--color-bg); padding: 15px; border-radius: 8px; border: 1px solid var(--color-border); }
    .stats-dashboard-item { display: flex; flex-direction: column; }
    .stats-dashboard-item.full-width { grid-column: 1 / -1; border-bottom: 1px solid var(--color-border); padding-bottom: 10px; margin-bottom: 5px; }
    .stats-dashboard-label { font-size: 0.85em; color: var(--color-text-secondary); margin-bottom: 2px; }
    .stats-dashboard-value { font-size: 1.2em; font-weight: bold; }
    .stats-row-main { cursor: pointer; transition: background-color 0.2s; }
    .stats-row-main:hover { background-color: var(--color-highlight); }
    .stats-detail-row { display: none; background-color: var(--color-bg); }
    .stats-detail-row.show { display: table-row; animation: fadeIn 0.3s; }
    .detail-content { padding: 15px; border-left: 3px solid var(--color-primary); margin: 5px 0; }
    .detail-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 0.9em; margin-bottom: 10px; }
    .detail-label { color: var(--color-text-secondary); }
    .detail-value { text-align: right; font-weight: bold; }
    .amount-plus { color: var(--color-primary); }
    .amount-minus { color: var(--color-error); }
    .detail-list-item { display: flex; justify-content: space-between; font-size: 0.85em; padding: 2px 0; }
    .detail-section-title { font-weight: bold; margin-top: 10px; margin-bottom: 5px; border-bottom: 1px solid var(--color-border); padding-bottom: 3px; font-size: 0.95em; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
</style>
</head>
<body>

<div class="app-container">
    <header class="header">
        <h1 id="app-title">GDì‹œíì–´ ì›”ê¸‰ ê³„ì‚°</h1>
        <button id="today-button" class="float-button" title="ì˜¤ëŠ˜ ë‚ ì§œë¡œ ì´ë™" style="bottom: auto; top: 10px; right: 10px; width: 40px; height: 40px; font-size: 1.2em;">ğŸ“…</button>
    </header>

    <div class="tab-bar">
        <button class="tab-button active" id="tab-calendar">ë‹¬ë ¥/ì…ë ¥</button>
        <button class="tab-button" id="tab-statistics">í†µê³„</button>
        <button class="tab-button" id="tab-settings">ì„¤ì •</button>
    </div>

    <div class="content-area">
        <div id="tab-content-calendar" class="tab-content">
            <section id="salary-input-section">
                <div class="salary-summary-header">
                    <div>
                        <small id="salary-period-info">ì´ ì˜ˆìƒ ì›”ê¸‰ (ê¸°ê°„ ì •ë³´ ë¡œë”© ì¤‘...)</small>
                        <h2 id="total-expected-salary">0 ì›</h2>
                    </div>
                    <button id="toggle-salary-details" onclick="toggleSalaryDetails(); playSound('click');">â–¼</button>
                </div>

                <div id="salary-details-container">
                    <div id="january-split-tabs" style="display:none;"></div>
                    
                    <div id="current-salary-options" style="font-size:0.8em; color: var(--color-primary); white-space: pre-line;"></div>
                    
                    <div id="calculated-stats" style="margin-top: 5px; margin-bottom: 15px; padding: 10px; border: 1px solid var(--color-disabled); border-radius: 4px; background-color: var(--color-bg);">
                        <div class="active-period-indicator" id="stats-period-indicator" style="display:none;"></div>
                        <div class="stats-row" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                            <span style="flex: 2;">í‰ì¼ì”ì—…ì‹œê°„:</span>
                            <span id="stat-weekday-ot-time-count" style="flex: 1; text-align: right; font-weight: bold; margin-right: 10px;">0.0h</span>
                            <span id="stat-weekday-ot-time-amount" style="flex: 2; text-align: right; color: var(--color-primary);">0 ì›</span>
                        </div>
                        <div class="stats-row" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                            <span style="flex: 2;">íŠ¹ê·¼ì”ì—…ì‹œê°„:</span>
                            <span id="stat-special-ot-time-count" style="flex: 1; text-align: right; font-weight: bold; margin-right: 10px;">0.0h</span>
                            <span id="stat-special-ot-time-amount" style="flex: 2; text-align: right; color: var(--color-primary);">0 ì›</span>
                        </div>
                        <div class="stats-row" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                            <span style="flex: 2;">íŠ¹ê·¼ì¼ìˆ˜:</span>
                            <span id="stat-special-day-count-count" style="flex: 1; text-align: right; font-weight: bold; margin-right: 10px;">0ì¼</span>
                            <span id="stat-special-day-count-amount" style="flex: 2; text-align: right; color: var(--color-primary);">0 ì›</span>
                        </div>
                        <div class="stats-row" style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="flex: 2;">ì•¼ê°„ì¼ìˆ˜:</span>
                            <span id="stat-night-day-count-count" style="flex: 1; text-align: right; font-weight: bold; margin-right: 10px;">0ì¼</span>
                            <span id="stat-night-day-count-amount" style="flex: 2; text-align: right; color: var(--color-primary);">0 ì›</span>
                        </div>
                    </div>

                    <div class="input-group" style="margin-top: 10px; align-items: flex-start;">
                        <label for="base-pay" id="base-pay-label" style="padding-top: 10px;">ê¸°ë³¸ê¸‰ ì…ë ¥</label>
                        <div id="base-pay-container" style="flex: 3;">
                            </div>
                    </div>

                    <div class="checkbox-group" id="regular-pay-group">
                        <label for="regular-pay-check">í†µìƒì„ê¸ˆ í¬í•¨</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="regular-pay-check">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <hr>
                    <div id="additional-items-wrapper">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                            <label style="font-size: 0.9em; margin-bottom: 0;">ì¶”ê°€ ìˆ˜ë‹¹ ëª©ë¡ <span id="additional-items-label-suffix"></span>:</label>
                            <button onclick="copyPreviousMonthAdditionalItems(); playSound('click');" style="background-color: var(--color-secondary); color: var(--color-bg); padding: 5px 10px; border: none; border-radius: 4px; font-size: 0.8em; line-height: 1.2; text-align: center; cursor: pointer;">ì§€ë‚œë‹¬/êµ¬ê°„ ë³µì‚¬</button>
                        </div>
                        <div id="additional-items-list"></div>
                        <button onclick="addAdditionalItem(); playSound('click');" style="background-color: var(--color-disabled); color: var(--color-text); padding: 5px 10px; border: none; border-radius: 4px; margin-top: 5px;">+ ì¶”ê°€ í•­ëª©</button>
                    </div>
                </div>
            </section>
            <div id="calendar-view"></div>
        </div>

        <div id="tab-content-statistics" class="tab-content" style="display:none;">
            <section id="statistics-view">
                <h3>ì›”ë³„ ê·¼ë¬´ í†µê³„</h3>
                <div class="stats-dashboard">
                    <div class="stats-dashboard-item full-width">
                        <span class="stats-dashboard-label">ì‹¤ìˆ˜ë ¹ì•¡ (ìµœì¢…)</span>
                        <span class="stats-dashboard-value" id="stats-dash-net" style="color: var(--color-primary);">0 ì›</span>
                    </div>
                    <div class="stats-dashboard-item">
                        <span class="stats-dashboard-label">ì§€ê¸‰ ì´ì•¡ (ì„¸ì „/ìˆ˜ë‹¹í¬í•¨)</span>
                        <span class="stats-dashboard-value" id="stats-dash-gross" style="color: var(--color-text); font-size: 1em;">0 ì›</span>
                    </div>
                    <div class="stats-dashboard-item">
                        <span class="stats-dashboard-label">ê³µì œ ì´ì•¡ (ì°¨ê°)</span>
                        <span class="stats-dashboard-value" id="stats-dash-deduct" style="color: var(--color-error); font-size: 1em;">0 ì›</span>
                    </div>
                </div>

                <div class="stats-filter">
                    <select id="stats-year-filter" onchange="renderStatistics()"></select>
                    <select id="stats-month-filter" onchange="renderStatistics()">
                        <option value="0">ì „ì²´ ì›”</option>
                        <option value="1">1ì›”</option><option value="2">2ì›”</option><option value="3">3ì›”</option><option value="4">4ì›”</option><option value="5">5ì›”</option><option value="6">6ì›”</option>
                        <option value="7">7ì›”</option><option value="8">8ì›”</option><option value="9">9ì›”</option><option value="10">10ì›”</option><option value="11">11ì›”</option><option value="12">12ì›”</option>
                    </select>
                    <select id="stats-view-mode" onchange="renderStatistics()">
                        <option value="salary">ì‹¤ìˆ˜ë ¹ì•¡ ìš°ì„ </option>
                        <option value="work">ê·¼ë¬´ í˜„í™© (ì•¼ê°„/íŠ¹ê·¼/íœ´ê°€)</option>
                        <option value="deduction">ê³µì œ ì´ì•¡ ìš°ì„ </option>
                    </select>
                </div>
                <div class="table-scroll-wrapper">
                    <table class="stats-table">
                        <thead><tr><th>ê¸°ê°„</th><th>ì‹¤ìˆ˜ë ¹ì•¡</th><th style="text-align:center;">ìƒì„¸</th></tr></thead>
                        <tbody id="stats-table-body"></tbody>
                    </table>
                </div>
            </section>
        </div>

        <div id="tab-content-settings" class="tab-content" style="display:none;">
             <section style="padding: var(--mobile-padding);">
                <h3>ì‚¬ìš©ì ë° ë°˜ ì„¤ì •</h3>
                <div class="form-row"><label for="setting-account">ë‚´ ê³„ì • ì •ë³´ (ê¸°ê¸°ë‹¹ ê³ ìœ )</label><input type="text" id="setting-account" disabled></div>
                <div class="form-row">
                    <label for="setting-class">ì†Œì† ë°˜ (í˜„ì¬ ê¸°ì¤€)</label>
                    <select id="setting-class" onchange="saveSettings();"><option value="A">Aë°˜</option><option value="B">Bë°˜</option><option value="C">Cë°˜</option><option value="D">Dë°˜</option></select>
                    <small>* Aë°˜ ì•¼ê°„ ì‹œì‘ì¼ì€ 2025-01-05ë¡œ ê³ ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</small>
                </div>
                <hr>
                <h3>ë°˜ ë³€ê²½ ê¸°ë¡ ê´€ë¦¬</h3>
                <small>* ë°˜ ë³€ê²½ì¼ ì´í›„ë¶€í„° ë³€ê²½ëœ ë°˜ì˜ ë¡œí…Œì´ì…˜ì´ ì ìš©ë©ë‹ˆë‹¤.</small>
                <div id="class-change-history-list"></div>
                <button onclick="addClassChangeRecordInput(); playSound('click');" style="background-color: var(--color-disabled); color: var(--color-text); padding: 5px 10px; border: none; border-radius: 4px; margin-top: 5px;">+ ë°˜ ë³€ê²½ ê¸°ë¡ ì¶”ê°€</button>
                <hr>
                <h3>ì”ì—… ì¢…ë¥˜ ê´€ë¦¬</h3>
                <div class="form-row">
                    <label style="font-size: 0.9em;">ì”ì—… ì´ë¦„ê³¼ ê¸°ë³¸ ì‹œê°„ì„ ì„¤ì •í•©ë‹ˆë‹¤.</label>
                    <div id="overtime-list-container"></div>
                    <button onclick="addOvertimeSettingItem(); playSound('click');" style="background-color: var(--color-disabled); color: var(--color-text); padding: 5px 10px; border: none; border-radius: 4px; margin-top: 5px;">+ ì”ì—… ì¢…ë¥˜ ì¶”ê°€</button>
                </div>
                <hr>
                <h3>ì‚¬ìš©ì ì§€ì • ê³µíœ´ì¼</h3>
                <div id="custom-holidays-list"></div>
                <button onclick="addCustomHolidayInput(); playSound('click');" style="background-color: var(--color-disabled); color: var(--color-text); padding: 5px 10px; border: none; border-radius: 4px; margin-top: 5px;">+ ê³µíœ´ì¼ ì¶”ê°€</button>
                <hr>
                <h3>í…Œë§ˆ ì„¤ì •</h3>
                <div class="form-row checkbox-group">
                    <label for="theme-toggle">ë¼ì´íŠ¸ ëª¨ë“œ í™œì„±í™”</label>
                     <label class="toggle-switch"><input type="checkbox" id="theme-toggle" onchange="toggleTheme(this.checked); playSound('toggle');"><span class="slider"></span></label>
                </div>
                <hr>
                <h3>ì†Œë¦¬ ì„¤ì •</h3>
                <div class="form-row checkbox-group">
                    <label for="sound-toggle">íš¨ê³¼ìŒ ì¼œê¸°</label>
                     <label class="toggle-switch"><input type="checkbox" id="sound-toggle" onchange="toggleMute(this.checked)"><span class="slider"></span></label>
                </div>
                <hr>
                <h3>ë°ì´í„° ë°±ì—…/ë³µêµ¬</h3>
                <div class="form-row" style="display:flex; gap: 10px;">
                    <button onclick="backupData(); playSound('save');" style="flex: 1; padding: 10px; border: none; border-radius: 4px; background-color: var(--color-primary); color: var(--color-bg); cursor: pointer; font-weight: bold;">ë°±ì—…</button>
                    <button onclick="document.getElementById('file-upload-input').click(); playSound('open');" style="flex: 1; padding: 10px; border: none; border-radius: 4px; background-color: var(--color-disabled); color: var(--color-text); cursor: pointer; font-weight: bold;">ë³µêµ¬</button>
                    <input type="file" id="file-upload-input" accept="application/json" onchange="restoreData(event)" style="display:none;">
                </div>
                <hr>
                <button onclick="resetAllData(); playSound('delete');" style="width: 100%; background-color: var(--color-error); color: #FFFFFF; padding: 10px 20px; border: none; border-radius: 20px; font-size: 1em; cursor: pointer;">ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™” (ì£¼ì˜)</button>
            </section>
        </div>
    </div>
</div>

<div id="work-record-modal" class="modal">
    <div class="modal-content">
        <h3 id="modal-date-title">ê·¼ë¬´ ê¸°ë¡ ì…ë ¥</h3><input type="hidden" id="modal-selected-date">
        <div class="form-row">
            <label>ê·¼ë¬´ í˜•íƒœ</label>
            <div class="radio-group" id="work-type-group">
                <input type="radio" id="type-ì£¼ê°„" name="work-type" value="ì£¼ê°„"><label for="type-ì£¼ê°„">ì£¼ê°„</label>
                <input type="radio" id="type-ì•¼ê°„" name="work-type" value="ì•¼ê°„"><label for="type-ì•¼ê°„">ì•¼ê°„</label>
                <input type="radio" id="type-ì•¼ê°„í‡´ê·¼(ì¹ ì„œ)" name="work-type" value="ì•¼ê°„í‡´ê·¼(ì¹ ì„œ)"><label for="type-ì•¼ê°„í‡´ê·¼(ì¹ ì„œ)">ì•¼ê°„í‡´ê·¼(ì¹ ì„œ)</label>
                <input type="radio" id="type-ì£¼íŠ¹" name="work-type" value="ì£¼ê°„íŠ¹ê·¼"><label for="type-ì£¼íŠ¹">ì£¼ê°„íŠ¹ê·¼</label>
                <input type="radio" id="type-ì•¼íŠ¹" name="work-type" value="ì•¼ê°„íŠ¹ê·¼"><label for="type-ì•¼íŠ¹">ì•¼ê°„íŠ¹ê·¼</label>
                <input type="radio" id="type-17ì‹œ" name="work-type" value="17ì‹œí‡´ê·¼"><label for="type-17ì‹œ">17ì‹œ í‡´ê·¼</label>
                <input type="radio" id="type-íœ´ë¬´" name="work-type" value="íœ´ë¬´"><label for="type-íœ´ë¬´">íœ´ë¬´</label>
                <input type="radio" id="type-íœ´ê°€" name="work-type" value="íœ´ê°€"><label for="type-íœ´ê°€">íœ´ê°€</label>
                <input type="radio" id="type-ë°˜ì°¨" name="work-type" value="ë°˜ì°¨"><label for="type-ë°˜ì°¨">ë°˜ì°¨</label>
                <input type="radio" id="type-ë¯¸ì„ íƒ" name="work-type" value="ë¯¸ì„ íƒ"><label for="type-ë¯¸ì„ íƒ">ë¯¸ì„ íƒ</label>
            </div>
        </div>
        <div class="form-row" id="overtime-input-section">
            <label>ì¶”ê°€ ì”ì—… (ê¸°ë³¸ ê·¼ë¬´ ì™¸)</label>
            <div class="overtime-input-row" style="font-weight: bold; color: var(--color-primary);"><div>ì¢…ë¥˜</div><div>ì‹œê°„(h)</div><div>ì‚­ì œ</div></div>
            <div id="modal-overtime-list"></div>
            <button onclick="addOvertimeRow(true); playSound('click');" style="background-color: var(--color-disabled); color: var(--color-text); padding: 5px 10px; border: none; border-radius: 4px; margin-top: 10px;">+ ì”ì—… ì¶”ê°€</button>
        </div>
        <div class="modal-actions">
            <button onclick="closeModal('work-record-modal'); playSound('click');" class="secondary">ë‹«ê¸°</button>
            <button onclick="deleteWorkRecord(); playSound('delete');" class="danger" id="delete-record-btn" style="display:none;">ì‚­ì œ</button>
            <button onclick="saveWorkRecord(); playSound('save');" class="primary">ì €ì¥/ìˆ˜ì •</button>
        </div>
    </div>
</div>

<div id="initial-setup-modal" class="modal"> <div class="modal-content">
        <h3>ì´ˆê¸° ì„¤ì •</h3><p>ì‚¬ìš©ì„ ìœ„í•´ ê¸°ë³¸ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
        <div class="form-row">
            <label for="init-class">ì†Œì† ë°˜ì„ ì„ íƒí•˜ì„¸ìš”.</label>
            <select id="init-class"><option value="A">Aë°˜</option><option value="B">Bë°˜</option><option value="C">Cë°˜</option><option value="D">Dë°˜</option></select>
            <small>* Aë°˜ ì•¼ê°„ ì‹œì‘ì¼ì€ 2025-01-05ë¡œ ê³ ì •ë©ë‹ˆë‹¤.</small>
        </div>
        <div class="modal-actions"><button onclick="completeInitialSetup(); playSound('save');" class="primary" style="width: 100%;">ì„¤ì • ì™„ë£Œ</button></div>
    </div>
</div>
<div id="confirm-modal" class="modal" style="z-index: 300;">
    <div class="modal-content">
        <h3 id="confirm-modal-title">í™•ì¸</h3>
        <p id="confirm-modal-text" style="line-height: 1.5; white-space: pre-wrap;"></p>
        <div class="modal-actions">
            <button id="confirm-modal-cancel" class="secondary">ì·¨ì†Œ</button>
            <button id="confirm-modal-ok" class="danger">í™•ì¸</button>
        </div>
    </div>
</div>

<div id="admin-notice-modal" class="modal" style="z-index: 400;">
    <div class="modal-content">
        <h3 style="color: var(--color-primary);">ğŸ“¢ ê³µì§€ì‚¬í•­</h3>
        <p id="admin-notice-text" style="line-height: 1.6; white-space: pre-wrap; margin-bottom: 20px;"></p>
        <div class="modal-actions">
            <button onclick="closeAdminNotice(true); playSound('click');" class="secondary" style="font-size: 0.9em;">ì¼ì£¼ì¼ê°„ ë³´ì§€ ì•Šê¸°</button>
            <button onclick="closeAdminNotice(false); playSound('click');" class="primary">ë‹«ê¸°</button>
        </div>
    </div>
</div>

<script>
    /* === [ê´€ë¦¬ì ì„¤ì • êµ¬ì—­] === */
    // ì•„ë˜ ë”°ì˜´í‘œ ì•ˆì— ë‚´ìš©ì„ ì‘ì„±í•˜ë©´ ì•± ì‹œì‘ ì‹œ ê³µì§€ íŒì—…ì´ ëœ¹ë‹ˆë‹¤.
    // ë‚´ìš©ì„ ë¹„ì›Œë‘ë©´("") íŒì—…ì´ ëœ¨ì§€ ì•ŠìŠµë‹ˆë‹¤.
    const ADMIN_NOTICE_CONTENT = "í†µê³„ë¶€ë¶„ ìˆ˜ì •ë¨.\nì•± ì‚¬ìš©ì‹œ ì¥ì• ì‹ ê³ /ë¬¸ì˜: 010-4104-2226"; 
    
    /* === (ì‹œì‘) ë©”ì¸ ì•± ìŠ¤í¬ë¦½íŠ¸ === */
    const CURRENT_APP_VERSION = "2.3.3"; // ì—°ë„ í‘œì‹œ ë²”ìœ„ ë¡œì§ ìˆ˜ì • (2025~ê³„ì†)
    const DEFAULT_OVERTIME_MAP = { 'ì£¼ê°„': 3.0, 'ì•¼ê°„': 4.5, 'ì•¼ê°„í‡´ê·¼(ì¹ ì„œ)': 2.5, 'ì£¼ê°„íŠ¹ê·¼': 0.5, 'ì•¼ê°„íŠ¹ê·¼': 7.0, '17ì‹œí‡´ê·¼': 0.5 };
    
    // ì›”ë³„ í†µìƒì„ê¸ˆ ê°€ì‚°ì•¡ (ìƒì—¬ 200ë§Œì› / 12ê°œì›”)
    const REGULAR_BONUS_MONTHLY = 2000000 / 12;

    const DEFAULT_HOLIDAYS_BASE = [
        { date: '2024-01-01', name: 'ì‹ ì •' }, { date: '2024-02-09', name: 'ì„¤ë‚ ' }, { date: '2024-02-10', name: 'ì„¤ë‚ ' }, { date: '2024-02-11', name: 'ì„¤ë‚ ' }, { date: '2024-02-12', name: 'ì„¤ë‚  ëŒ€ì²´ê³µíœ´ì¼' }, { date: '2024-03-01', name: 'ì‚¼ì¼ì ˆ' }, 
        { date: '2024-04-10', name: 'êµ­íšŒì˜ì›ì„ ê±°ì¼' }, { date: '2024-05-05', name: 'ì–´ë¦°ì´ë‚ ' }, { date: '2024-05-06', name: 'ì–´ë¦°ì´ë‚  ëŒ€ì²´ê³µíœ´ì¼' }, { date: '2024-05-15', name: 'ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ' }, 
        { date: '2024-06-06', name: 'í˜„ì¶©ì¼' }, { date: '2024-08-15', name: 'ê´‘ë³µì ˆ' }, { date: '2024-09-16', name: 'ì¶”ì„' }, { date: '2024-09-17', name: 'ì¶”ì„' }, { date: '2024-09-18', name: 'ì¶”ì„' },
        { date: '2024-10-03', name: 'ê°œì²œì ˆ' }, { date: '2024-10-09', name: 'í•œê¸€ë‚ ' }, { date: '2024-12-25', name: 'ì„±íƒ„ì ˆ' },
        { date: '2025-01-01', name: 'ì‹ ì •' }, { date: '2025-01-29', name: 'ì„¤ë‚ ' }, { date: '2025-01-30', name: 'ì„¤ë‚ ' }, { date: '2025-01-31', name: 'ì„¤ë‚ ' }, { date: '2025-03-01', name: 'ì‚¼ì¼ì ˆ' }, 
        { date: '2025-05-05', name: 'ì–´ë¦°ì´ë‚ ' }, { date: '2025-05-26', name: 'ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ' }, { date: '2025-06-06', name: 'í˜„ì¶©ì¼' }, { date: '2025-08-15', name: 'ê´‘ë³µì ˆ' }, 
        { date: '2025-10-03', name: 'ê°œì²œì ˆ' }, { date: '2025-10-06', name: 'ì¶”ì„' }, { date: '2025-10-07', name: 'ì¶”ì„' }, { date: '2025-10-08', name: 'ì¶”ì„' }, { date: '2025-10-09', name: 'í•œê¸€ë‚ ' }, 
        { date: '2025-12-25', name: 'ì„±íƒ„ì ˆ' }, { date: '2026-01-01', name: 'ì‹ ì •' }, { date: '2026-02-16', name: 'ì„¤ë‚ ' }, { date: '2026-02-17', name: 'ì„¤ë‚ ' }, { date: '2026-02-18', name: 'ì„¤ë‚ ' }, { date: '2026-05-05', name: 'ì–´ë¦°ì´ë‚ ' }, { date: '2026-05-24', name: 'ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ' }, { date: '2026-05-25', name: 'ëŒ€ì²´ê³µíœ´ì¼' }, { date: '2026-06-03', name: 'ì „êµ­ë™ì‹œì§€ë°©ì„ ê±°' }, { date: '2026-06-06', name: 'í˜„ì¶©ì¼' }, { date: '2026-08-15', name: 'ê´‘ë³µì ˆ' }, { date: '2026-08-17', name: 'ëŒ€ì²´ê³µíœ´ì¼' }, { date: '2026-09-24', name: 'ì¶”ì„' }, { date: '2026-09-25', name: 'ì¶”ì„' }, { date: '2026-09-26', name: 'ì¶”ì„' }, { date: '2026-10-03', name: 'ê°œì²œì ˆ' }, { date: '2026-10-05', name: 'ëŒ€ì²´ê³µíœ´ì¼' }, { date: '2026-10-09', name: 'í•œê¸€ë‚ ' }, { date: '2026-12-25', name: 'ì„±íƒ„ì ˆ' } 
    ];

    // í˜„ì¬ ì„ íƒëœ 1ì›” ë¶„í•  íƒ­ ('prev', 'curr', 'total')
    let currentJanTab = 'prev';

    let USER_DATA = {
        appVersion: CURRENT_APP_VERSION,
        account: Date.now().toString(),
        class: 'A',
        A_night_start: '2025-01-05',
        settings: { 
            basePays: {}, // 1ì›”: ì‹ ë…„ë„(19ì¼)
            prevYearBasePays: {}, // 1ì›”: ì „ë…„ë„(12ì¼)
            regularPayChecks: {}, // 1ì›”: ì‹ ë…„ë„ í†µìƒì„ê¸ˆ
            prevYearRegularPayChecks: {}, // 1ì›”: ì „ë…„ë„ í†µìƒì„ê¸ˆ (ì‹ ê·œ ì¶”ê°€)
            additionalItemsByPeriod: {}, // 1ì›”: ì‹ ë…„ë„ ìˆ˜ë‹¹
            prevYearAdditionalItemsByPeriod: {}, // 1ì›”: ì „ë…„ë„ ìˆ˜ë‹¹ (ì‹ ê·œ ì¶”ê°€)
            customHolidays: DEFAULT_HOLIDAYS_BASE,
            isSalaryDetailsCollapsed: false, 
            classChangeHistory: [], 
            isLightMode: false, 
            isMuted: false,
            overtimeList: [ { name: 'G1ì¡°ì¶œ', time: 1.0 }, { name: 'G2ì¡°ì¶œ', time: 1.0 }, { name: 'G2ì§€ì›', time: 0.5 }, { name: 'G3ì¡°ì¶œ', time: 1.0 }, { name: 'G5ì¡°ì¶œ', time: 1.0 }, { name: 'G5ì§€ì›', time: 0.5 }, { name: 'R&Dì¡°ì¶œ', time: 1.0 }, { name: 'R&Dì§€ì›', time: 0.5 }, { name: 'ë²„ìŠ¤ê²€ì°¨', time: 0.5 }] 
        },
        workRecords: {}
    };
    
    let audioCtx; 

    // --- Helper Functions ---
    const getPeriodKeyFromDate = date => { let y = date.getFullYear(), m = date.getMonth(); if (date.getDate() < 20) { m--; if (m < 0) { m = 11; y--; } } return `${y}-${String(m + 1).padStart(2, '0')}`; };
    const getCurrentActivePeriodKey = () => { const el = document.querySelector('.calendar-month.active'); if (!el) return getPeriodKeyFromDate(new Date()); const [, y, m] = el.id.split('-'); return getPeriodKeyFromDate(new Date(Number(y), Number(m), 1)); };
    const getSalaryPeriodByPeriodKey = key => { if (!key) return null; const [y, m] = key.split('-').map(Number); const sd = new Date(y, m - 1, 20); const ed = new Date(y, m, 19); ed.setHours(23, 59, 59, 999); return { startDate: sd, endDate: ed }; };
    const getPreviousPeriodKey = key => { if (!key) return null; let [y, m] = key.split('-').map(Number); m--; if (m === 0) { m = 12; y--; } return `${y}-${String(m).padStart(2, '0')}`; };
    const formatDate = date => `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
    const getHolidayName = date => { const dateStr = formatDate(date); const holiday = USER_DATA.settings.customHolidays.find(h => h.date === dateStr); return holiday ? holiday.name : null; };

    // --- Data Management ---
    const saveData = () => { USER_DATA.appVersion = CURRENT_APP_VERSION; USER_DATA.settings.classChangeHistory.sort((a, b) => new Date(a.changeDate) - new Date(b.changeDate)); localStorage.setItem('smartSalaryApp_user_data', JSON.stringify(USER_DATA)); };
    const loadData = () => {
        const data = localStorage.getItem('smartSalaryApp_user_data');
        if (!data) { applyTheme(false); document.getElementById('initial-setup-modal').style.display = 'flex'; return; }
        let loadedData;
        try { loadedData = JSON.parse(data); } catch (e) { document.getElementById('initial-setup-modal').style.display = 'flex'; return; }
        
        loadedData.A_night_start = '2025-01-05';
        if (!loadedData.settings) loadedData.settings = {};
        if (!loadedData.settings.prevYearBasePays) loadedData.settings.prevYearBasePays = {}; 
        if (!loadedData.settings.prevYearRegularPayChecks) loadedData.settings.prevYearRegularPayChecks = {}; 
        if (!loadedData.settings.prevYearAdditionalItemsByPeriod) loadedData.settings.prevYearAdditionalItemsByPeriod = {};

        const existingCustomHolidays = loadedData.settings?.customHolidays || [];
        const allHolidays = new Map(DEFAULT_HOLIDAYS_BASE.map(h => [h.date, h]));
        existingCustomHolidays.forEach(h => allHolidays.set(h.date, h));
        loadedData.settings.customHolidays = Array.from(allHolidays.values());
        if (loadedData.settings.isMuted === undefined) loadedData.settings.isMuted = false;
        USER_DATA = { ...USER_DATA, ...loadedData };
        
        applyTheme(USER_DATA.settings.isLightMode);
        document.getElementById('setting-account').value = USER_DATA.account;
        document.getElementById('setting-class').value = USER_DATA.class;
        document.getElementById('theme-toggle').checked = USER_DATA.settings.isLightMode;
        document.getElementById('sound-toggle').checked = !USER_DATA.settings.isMuted;

        renderCustomHolidays(); renderOvertimeSettings(); renderClassChangeHistory();
        if (USER_DATA.settings.isSalaryDetailsCollapsed) {
            document.getElementById('salary-input-section').classList.add('collapsed');
            document.getElementById('salary-details-container').classList.add('collapsed');
            document.getElementById('toggle-salary-details').textContent = 'â–²';
        }
        generateCalendar(true);
    };
    const completeInitialSetup = () => { const initClass = document.getElementById('init-class').value; USER_DATA.class = initClass; saveData(); document.getElementById('setting-class').value = initClass; document.getElementById('initial-setup-modal').style.display = 'none'; generateCalendar(true); };

    // --- Work Type Calculation ---
    const getClassForDate = date => { const dateStr = formatDate(date); let cls = USER_DATA.class; for (let i = USER_DATA.settings.classChangeHistory.length - 1; i >= 0; i--) { const r = USER_DATA.settings.classChangeHistory[i]; if (dateStr >= r.changeDate) { cls = r.newClass; break; } } return cls; };
    const getCalculatedWorkType = (date, cls, start) => { const s = new Date(start); if (isNaN(s)) return { type: 'ë¯¸ì„ íƒ' }; const diff = Math.floor((new Date(date.getFullYear(), date.getMonth(), date.getDate()) - s) / 864e5); const w = (Math.floor((diff + 1) / 7) % 3 + 3) % 3; let type = 'ì£¼ê°„'; if ((cls === 'A' && w === 0) || (cls === 'B' && w === 1) || (cls === 'C' && w === 2)) type = 'ì•¼ê°„'; return { type }; };
    const isHoliday = date => USER_DATA.settings.customHolidays.some(h => h.date === formatDate(date));

    // --- Salary Calculation Logic (ë¶„í•  í†µê³„ + ì—­ì‚° + ë°˜ë³„ ì‹œìˆ˜ ì ìš©) ---
    // [ìˆ˜ì •ë¨] ìˆ˜ë‹¹ê³¼ ê³µì œë¥¼ ë¶„ë¦¬í•˜ì—¬ ê³„ì‚°í•˜ëŠ” ë¡œì§ ì ìš©
    const calculatePeriodStats = (periodKey) => {
        const stats = { 
            totalSalary: 0, 
            basePay: 0, 
            totalOvertimePay: 0, // ì”ì—…/íŠ¹ê·¼/ì•¼ê°„ ìˆ˜ë‹¹ í•©ê³„
            totalAllowances: 0,  // ì¶”ê°€ ìˆ˜ë‹¹ í•©ê³„ (+)
            totalDeductions: 0,  // ê³µì œ í•©ê³„ (-)
            
            finalHourlyWage: 0,
            nightDays: 0, specialDays: 0, vacationDays: 0, weekdayOT: 0, specialOT: 0, 
            nightAmount: 0, specialAmount: 0, weekdayOTAmount: 0, specialOTAmount: 0,
            
            // ë‚´ë¶€ ê³„ì‚°ìš©
            prevPart: { nightDays: 0, specialDays: 0, vacationDays: 0, weekdayOT: 0, specialOT: 0, nightAmount: 0, specialAmount: 0, weekdayOTAmount: 0, specialOTAmount: 0, hourlyWage: 0, additionalAmount: 0 },
            currPart: { nightDays: 0, specialDays: 0, vacationDays: 0, weekdayOT: 0, specialOT: 0, nightAmount: 0, specialAmount: 0, weekdayOTAmount: 0, specialOTAmount: 0, hourlyWage: 0, additionalAmount: 0 }
        };

        const period = getSalaryPeriodByPeriodKey(periodKey);
        if (!period) return stats;

        const isJanuary = periodKey.endsWith('-12');
        
        let basePayCurr = Number(USER_DATA.settings.basePays[periodKey]) || 0; 
        let basePayPrev = isJanuary ? (Number(USER_DATA.settings.prevYearBasePays[periodKey]) || 0) : basePayCurr;

        const isRegularPayCheckedCurr = USER_DATA.settings.regularPayChecks[periodKey] || false;
        const isRegularPayCheckedPrev = isJanuary ? (USER_DATA.settings.prevYearRegularPayChecks[periodKey] || false) : isRegularPayCheckedCurr;
        
        const currentClass = getClassForDate(period.startDate);
        const standardMonthlyHours = (currentClass === 'D') ? 209 : 226; 

        if (isJanuary) {
            let fullMonthBasePrev = basePayPrev * (31 / 12);
            if (isRegularPayCheckedPrev) fullMonthBasePrev += REGULAR_BONUS_MONTHLY;
            stats.prevPart.hourlyWage = fullMonthBasePrev > 0 ? fullMonthBasePrev / standardMonthlyHours : 0;

            let fullMonthBaseCurr = basePayCurr * (31 / 19);
            if (isRegularPayCheckedCurr) fullMonthBaseCurr += REGULAR_BONUS_MONTHLY;
            stats.currPart.hourlyWage = fullMonthBaseCurr > 0 ? fullMonthBaseCurr / standardMonthlyHours : 0;

            stats.basePay = basePayPrev + basePayCurr;
        } else {
            let fullMonthBase = basePayCurr;
            if (isRegularPayCheckedCurr) fullMonthBase += REGULAR_BONUS_MONTHLY;
            stats.currPart.hourlyWage = fullMonthBase > 0 ? fullMonthBase / standardMonthlyHours : 0;
            stats.basePay = basePayCurr;
        }

        let tempDate = new Date(period.startDate);
        while (tempDate <= period.endDate) {
            const dateStr = formatDate(tempDate);
            const workRecord = USER_DATA.workRecords[dateStr];
            const isPrevYearDate = isJanuary && (tempDate.getMonth() === 11);
            const targetPart = isPrevYearDate ? stats.prevPart : stats.currPart;
            const appliedHourlyWage = targetPart.hourlyWage;

            if (workRecord && workRecord.type !== 'ë¯¸ì„ íƒ') {
                if (workRecord.type.includes('ì•¼ê°„')) targetPart.nightDays++;
                if (workRecord.type.includes('íŠ¹ê·¼')) targetPart.specialDays++;
                if (workRecord.type === 'íœ´ê°€') targetPart.vacationDays++;
                else if (workRecord.type === 'ë°˜ì°¨') targetPart.vacationDays += 0.5;

                let totalOvertime = 0;
                totalOvertime += DEFAULT_OVERTIME_MAP[workRecord.type] || 0; 
                if (workRecord.overtimes) totalOvertime += workRecord.overtimes.reduce((sum, item) => sum + (Number(item.time) || 0), 0);

                if (appliedHourlyWage > 0) {
                    const isSpecialDay = workRecord.type.includes('íŠ¹ê·¼') || tempDate.getDay() === 0;
                    if (totalOvertime > 0) {
                        if (isSpecialDay) {
                            targetPart.specialOT += totalOvertime;
                            targetPart.specialOTAmount += (totalOvertime * appliedHourlyWage * 2.0); 
                        } else {
                            targetPart.weekdayOT += totalOvertime;
                            targetPart.weekdayOTAmount += (totalOvertime * appliedHourlyWage * 1.5); 
                        }
                    }
                    if (workRecord.type.includes('íŠ¹ê·¼')) targetPart.specialAmount += (1 * appliedHourlyWage * 1.5 * 8); 
                    if (workRecord.type.includes('ì•¼ê°„')) targetPart.nightAmount += (1 * appliedHourlyWage * 0.5 * 8); 
                }
            }
            tempDate.setDate(tempDate.getDate() + 1);
        }

        // --- ì¶”ê°€ ìˆ˜ë‹¹ ë° ê³µì œ ë¶„ë¦¬ í•©ì‚° ---
        const processAdditionalItems = (items) => {
            items.forEach(item => {
                if (item.amount >= 0) stats.totalAllowances += item.amount;
                else stats.totalDeductions += item.amount; // ìŒìˆ˜ ê°’ ê·¸ëŒ€ë¡œ ë”í•¨
            });
            return items.reduce((sum, item) => sum + item.amount, 0);
        };

        const additionalItemsCurr = USER_DATA.settings.additionalItemsByPeriod[periodKey] || [];
        const additionalItemsPrev = isJanuary ? (USER_DATA.settings.prevYearAdditionalItemsByPeriod[periodKey] || []) : [];
        
        stats.currPart.additionalAmount = processAdditionalItems(additionalItemsCurr);
        if (isJanuary) stats.prevPart.additionalAmount = processAdditionalItems(additionalItemsPrev);

        // ì „ì²´ ìˆ˜ë‹¹ í•©ê³„ ê³„ì‚° (ê¸°ë³¸ê¸‰ ì œì™¸í•œ ëª¨ë“  ìˆ˜ë‹¹)
        stats.totalOvertimePay = stats.prevPart.weekdayOTAmount + stats.currPart.weekdayOTAmount
                            + stats.prevPart.specialOTAmount + stats.currPart.specialOTAmount
                            + stats.prevPart.specialAmount + stats.currPart.specialAmount
                            + stats.prevPart.nightAmount + stats.currPart.nightAmount;

        stats.totalSalary = stats.basePay 
                            + stats.totalOvertimePay
                            + stats.prevPart.additionalAmount + stats.currPart.additionalAmount; // ì—¬ê¸°ì—” ê³µì œ(ìŒìˆ˜)ë„ í¬í•¨ë¨
                            
        if (isJanuary) {
            stats.nightDays = stats.prevPart.nightDays + stats.currPart.nightDays;
            stats.specialDays = stats.prevPart.specialDays + stats.currPart.specialDays;
            stats.vacationDays = stats.prevPart.vacationDays + stats.currPart.vacationDays;
        } else {
            Object.assign(stats, stats.currPart);
            stats.finalHourlyWage = stats.currPart.hourlyWage;
        }

        return stats;
    };

    const updateSalary = () => {
        const currentKey = getCurrentActivePeriodKey();
        if (!currentKey) return;
        const stats = calculatePeriodStats(currentKey);
        
        // ì „ì²´ ì´ ê¸‰ì—¬ (ìƒë‹¨ í° ê¸€ì”¨)
        document.getElementById('total-expected-salary').textContent = Math.round(stats.totalSalary).toLocaleString() + ' ì›';
        
        // 1ì›”ì¸ ê²½ìš° íƒ­ ìƒíƒœì— ë”°ë¼ í‘œì‹œí•  í†µê³„ ë° ì‹œê¸‰ ê²°ì •
        const isJanuary = currentKey.endsWith('-12');
        let displayStats = stats;
        let displayHourlyWageText = Math.round(stats.finalHourlyWage).toLocaleString() + 'ì›';
        
        if (isJanuary) {
            const wagePrev = Math.round(stats.prevPart.hourlyWage);
            const wageCurr = Math.round(stats.currPart.hourlyWage);

            if (currentJanTab === 'prev') {
                displayStats = stats.prevPart;
                displayHourlyWageText = wagePrev.toLocaleString() + 'ì›';
                document.getElementById('stats-period-indicator').textContent = '12.20 ~ 12.31 í†µê³„';
            } else if (currentJanTab === 'curr') {
                displayStats = stats.currPart;
                displayHourlyWageText = wageCurr.toLocaleString() + 'ì›';
                document.getElementById('stats-period-indicator').textContent = '01.01 ~ 01.19 í†µê³„';
            } else if (currentJanTab === 'total') {
                // í†µí•© íƒ­ ë¡œì§ ì¶”ê°€: ë‘ ë¶€ë¶„ì˜ í†µê³„ë¥¼ í•©ì‚°
                displayStats = {
                    weekdayOT: stats.prevPart.weekdayOT + stats.currPart.weekdayOT,
                    weekdayOTAmount: stats.prevPart.weekdayOTAmount + stats.currPart.weekdayOTAmount,
                    specialOT: stats.prevPart.specialOT + stats.currPart.specialOT,
                    specialOTAmount: stats.prevPart.specialOTAmount + stats.currPart.specialOTAmount,
                    specialDays: stats.prevPart.specialDays + stats.currPart.specialDays,
                    specialAmount: stats.prevPart.specialAmount + stats.currPart.specialAmount,
                    nightDays: stats.prevPart.nightDays + stats.currPart.nightDays,
                    nightAmount: stats.prevPart.nightAmount + stats.currPart.nightAmount
                };
                displayHourlyWageText = 'êµ¬ê°„ë³„ ìƒì´ (í†µí•©ë³´ê¸°)';
                document.getElementById('stats-period-indicator').textContent = '12.20 ~ 01.19 ì „ì²´ í†µê³„';
            }
            document.getElementById('stats-period-indicator').style.display = 'block';
        } else {
            document.getElementById('stats-period-indicator').style.display = 'none';
        }
        
        document.getElementById('current-salary-options').textContent = `ì ìš©ì‹œê¸‰: ${displayHourlyWageText}`;

        // í†µê³„ ë°•ìŠ¤ ì—…ë°ì´íŠ¸
        ['weekday-ot-time', 'special-ot-time', 'special-day-count', 'night-day-count'].forEach(key => {
            let count = 0, amount = 0;
            if(key.includes('-ot-time')) { 
                const type = key.split('-')[0];
                count = (displayStats[type + 'OT'] || 0).toFixed(1) + 'h';
                amount = displayStats[type + 'OTAmount'] || 0;
            } else {
                const type = key.split('-')[0];
                const statsKey = type === 'special' ? 'specialDays' : 'nightDays';
                const amountKey = type === 'special' ? 'specialAmount' : 'nightAmount';
                count = (displayStats[statsKey] || 0) + 'ì¼';
                amount = displayStats[amountKey] || 0;
            }
            document.getElementById(`stat-${key}-count`).textContent = count;
            document.getElementById(`stat-${key}-amount`).textContent = Math.round(amount).toLocaleString() + ' ì›';
        });
    };

    // --- 1ì›” íƒ­ ì „í™˜ ë¡œì§ ---
    const switchJanTab = (tab) => {
        currentJanTab = tab;
        loadPeriodSettingsToUI(); // UI ë‹¤ì‹œ ê·¸ë¦¬ê¸°
        playSound('click');
    };

    // --- UI Rendering ---
    // [ìˆ˜ì •ë¨] ë‹¬ë ¥ ìƒì„± ë²”ìœ„ ë¡œì§ ë³€ê²½ (2025ë…„ë¶€í„° ì‹œì‘ + ê³¼ê±° ë°ì´í„° ìë™ í¬í•¨ + ë¯¸ë˜ ìë™ í™•ì¥)
    const generateCalendar = (scrollToToday = false) => {
        const calendarView = document.getElementById('calendar-view');
        calendarView.innerHTML = '';
        const today = new Date();
        const currentYear = today.getFullYear();

        // 1. ì‹œì‘ ì—°ë„ ê³„ì‚° (ê¸°ë³¸ 2025ë…„, ë‹¨ ë°ì´í„°ê°€ ë” ê³¼ê±°ì— ìˆìœ¼ë©´ ê·¸ ì—°ë„ë¶€í„°)
        let startYear = 2025;
        const recordYears = Object.keys(USER_DATA.workRecords).map(d => parseInt(d.split('-')[0]));
        const payYears = Object.keys(USER_DATA.settings.basePays).map(k => parseInt(k.split('-')[0]));
        const allYears = [...recordYears, ...payYears];
        if (allYears.length > 0) {
            const minDataYear = Math.min(...allYears);
            if (minDataYear < startYear) startYear = minDataYear;
        }

        // 2. ì¢…ë£Œ ì—°ë„ ê³„ì‚° (í˜„ì¬ ì—°ë„ + 1ë…„) -> ì‹œê°„ì´ ì§€ë‚˜ë©´ ìë™ìœ¼ë¡œ ëŠ˜ì–´ë‚¨
        const endYear = currentYear + 1;

        let lastScrollMonthId = '';

        for (let y = startYear; y <= endYear; y++) {
            for (let m = 0; m < 12; m++) {
                const monthId = `month-${y}-${m}`;
                const monthElement = document.createElement('div');
                monthElement.className = 'calendar-month';
                monthElement.id = monthId;
                const grid = document.createElement('div');
                grid.className = 'calendar-grid';
                monthElement.innerHTML = `<div class="month-header">${y}ë…„ ${m + 1}ì›”</div><div class="weekdays"><span class="sunday">ì¼</span><span>ì›”</span><span>í™”</span><span>ìˆ˜</span><span>ëª©</span><span>ê¸ˆ</span><span class="saturday">í† </span></div>`;
                monthElement.appendChild(grid);
                const firstDay = new Date(y, m, 1);
                const daysInMonth = new Date(y, m + 1, 0).getDate();
                for (let i = 0; i < firstDay.getDay(); i++) grid.insertAdjacentHTML('beforeend', '<div class="day-cell disabled"></div>');
                for (let day = 1; day <= daysInMonth; day++) {
                    const date = new Date(y, m, day);
                    const dateStr = formatDate(date);
                    const dayCell = document.createElement('div');
                    dayCell.className = 'day-cell';
                    dayCell.setAttribute('data-date', dateStr);
                    if (formatDate(today) === dateStr) { dayCell.classList.add('today'); lastScrollMonthId = monthId; }
                    dayCell.onclick = () => { openWorkRecordModal(dateStr); playSound('open'); };
                    grid.appendChild(dayCell);
                    updateDayCell(dateStr, dayCell);
                }
                calendarView.appendChild(monthElement);
            }
        }
        calendarView.removeEventListener('scroll', updateActiveMonth);
        calendarView.addEventListener('scroll', updateActiveMonth);

        if (scrollToToday && lastScrollMonthId) { scrollToTodayMonth(lastScrollMonthId, true); } else { updateActiveMonth(); }
    };

    const updateDayCell = (dateStr, cell) => {
        const dayCell = cell || document.querySelector(`.day-cell[data-date="${dateStr}"]`);
        if (!dayCell) return;
        const date = new Date(dateStr);
        const day = date.getDate();
        const workRecord = USER_DATA.workRecords[dateStr];
        const activeClass = getClassForDate(date);
        const calculated = getCalculatedWorkType(date, activeClass, USER_DATA.A_night_start);
        
        const workType = workRecord ? workRecord.type : '';
        let dayStatusText = workType === 'ë¯¸ì„ íƒ' ? '' : workType;
        dayCell.classList.toggle('night-shift-background', calculated.type.includes('ì•¼ê°„'));
        const isHoli = isHoliday(date) || date.getDay() === 0;
        dayCell.classList.toggle('holiday', isHoli);
        if (isHoli && dayStatusText === '') { const holidayName = getHolidayName(date); if (holidayName) { dayStatusText = holidayName; } }
        let totalOvertime = 0;
        if (workType !== 'ë¯¸ì„ íƒ' && workType !== 'íœ´ë¬´' && workType !== 'íœ´ê°€' && workType !== 'ë°˜ì°¨') { totalOvertime += DEFAULT_OVERTIME_MAP[workType] || 0; }
        if (workRecord?.overtimes) { totalOvertime += workRecord.overtimes.reduce((sum, item) => sum + (Number(item.time) || 0), 0); }
        dayCell.innerHTML = `<div class="day-number">${day}</div><div class="day-status" style="color:${calculated.type.includes('ì•¼ê°„') ? 'var(--color-secondary)' : 'var(--color-primary)'};">${dayStatusText}</div><div class="day-overtime">${totalOvertime > 0 ? totalOvertime.toFixed(1) + 'h' : ''}</div>`;
    };
    let scrollTimeout;
    const updateActiveMonth = () => {
        clearTimeout(scrollTimeout);
        scrollTimeout = setTimeout(() => {
            const calendarViewRect = document.getElementById('calendar-view').getBoundingClientRect();
            const viewportCenter = calendarViewRect.top + calendarViewRect.height / 2;
            const months = document.querySelectorAll('.calendar-month');
            let closestMonth = null; let minDistance = Infinity;
            months.forEach(month => { const monthRect = month.getBoundingClientRect(); const monthCenter = monthRect.top + monthRect.height / 2; const distance = Math.abs(viewportCenter - monthCenter); if (distance < minDistance) { minDistance = distance; closestMonth = month; } });
            if (closestMonth && !closestMonth.classList.contains('active')) { months.forEach(m => m.classList.remove('active')); closestMonth.classList.add('active'); loadPeriodSettingsToUI(); }
        }, 100);
    };

    // --- Dynamic UI Input Loading (1ì›” ë¶„í•  íƒ­ ì ìš©) ---
    const loadPeriodSettingsToUI = () => {
        const currentKey = getCurrentActivePeriodKey();
        if (!currentKey) return;
        const period = getSalaryPeriodByPeriodKey(currentKey);
        if(period) document.getElementById('salary-period-info').textContent = `ì´ ì˜ˆìƒ ì›”ê¸‰ (${formatDate(period.startDate)} ~ ${formatDate(period.endDate)})`;
        
        const container = document.getElementById('base-pay-container');
        const tabsContainer = document.getElementById('january-split-tabs');
        
        const isJanuary = currentKey.endsWith('-12');
        
        // 1ì›”ì¸ ê²½ìš° íƒ­ UI í™œì„±í™” (3ë²ˆì§¸ íƒ­ 'í†µí•©(ì „ì²´)' ì¶”ê°€)
        if (isJanuary) {
            tabsContainer.style.display = 'flex';
            tabsContainer.className = 'sub-tab-container';
            tabsContainer.innerHTML = `
                <button class="sub-tab-button ${currentJanTab === 'prev' ? 'active' : ''}" onclick="switchJanTab('prev')">ì „ë…„ë„ (12ì¼)</button>
                <button class="sub-tab-button ${currentJanTab === 'curr' ? 'active' : ''}" onclick="switchJanTab('curr')">ì‹ ë…„ë„ (19ì¼)</button>
                <button class="sub-tab-button ${currentJanTab === 'total' ? 'active' : ''}" onclick="switchJanTab('total')">ì „ì²´ (í†µí•©)</button>
            `;
            
            // í˜„ì¬ íƒ­ì— ë”°ë¥¸ ì…ë ¥ê°’ ë¡œë“œ
            if (currentJanTab === 'total') {
                // í†µí•© íƒ­: ì½ê¸° ì „ìš© ìš”ì•½ ë·°
                const prevVal = Number(USER_DATA.settings.prevYearBasePays[currentKey]) || 0;
                const currVal = Number(USER_DATA.settings.basePays[currentKey]) || 0;
                const totalVal = prevVal + currVal;
                
                document.getElementById('base-pay-label').textContent = 'ê¸°ë³¸ê¸‰ í•©ê³„ (ì „ë…„+ì‹ ë…„)';
                container.innerHTML = `
                    <div style="font-size: 0.95em; color: var(--color-text);">
                        <div style="display:flex; justify-content:space-between; margin-bottom:2px;"><span style="color:var(--color-text-secondary);">ì „ë…„ë„(12ì¼):</span> <span>${prevVal.toLocaleString()}ì›</span></div>
                        <div style="display:flex; justify-content:space-between; margin-bottom:5px; padding-bottom:5px; border-bottom:1px solid var(--color-border);"><span style="color:var(--color-text-secondary);">ì‹ ë…„ë„(19ì¼):</span> <span>${currVal.toLocaleString()}ì›</span></div>
                        <div style="display:flex; justify-content:space-between; font-weight:bold; color:var(--color-primary);"><span>í•©ê³„:</span> <span>${totalVal.toLocaleString()}ì›</span></div>
                    </div>
                `;
                // í†µìƒì„ê¸ˆ ì²´í¬ë°•ìŠ¤ & ì¶”ê°€ìˆ˜ë‹¹ ë¦¬ìŠ¤íŠ¸ ìˆ¨ê¸°ê¸°
                document.getElementById('regular-pay-group').style.display = 'none';
                document.getElementById('additional-items-wrapper').style.display = 'none';

            } else if (currentJanTab === 'prev') {
                document.getElementById('regular-pay-group').style.display = 'flex';
                document.getElementById('additional-items-wrapper').style.display = 'block';
                document.getElementById('additional-items-label-suffix').textContent = '(ì „ë…„ë„ êµ¬ê°„)';
                
                const prevVal = USER_DATA.settings.prevYearBasePays[currentKey] || '';
                const isRegPrev = USER_DATA.settings.prevYearRegularPayChecks[currentKey] || false;
                
                document.getElementById('base-pay-label').textContent = 'ì „ë…„ë„ ê¸°ë³¸ê¸‰ ì…ë ¥';
                container.innerHTML = `
                    <div style="display:flex; gap: 5px;">
                        <input type="number" inputmode="decimal" id="base-pay-prev" placeholder="ì „ë…„ë„ ê¸°ë³¸ê¸‰" value="${prevVal}" oninput="saveSplitBasePaySetting()" style="flex: 1;">
                        <button onclick="copyPreviousMonthBasePay(); playSound('click');" style="background-color: var(--color-secondary); color: var(--color-bg); padding: 5px; border: none; border-radius: 4px; font-size: 0.8em; width: 50px; cursor:pointer; line-height:1.2;">ì§€ë‚œë‹¬<br>ë³µì‚¬</button>
                    </div>
                `;
                document.getElementById('regular-pay-check').checked = isRegPrev;
                document.getElementById('regular-pay-check').onclick = () => { saveSplitRegularPayCheckSetting(); playSound('toggle'); };
                
                // ì „ë…„ë„ ì¶”ê°€ ìˆ˜ë‹¹ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
                renderAdditionalItems(currentKey, 'prev');

            } else { // curr
                document.getElementById('regular-pay-group').style.display = 'flex';
                document.getElementById('additional-items-wrapper').style.display = 'block';
                document.getElementById('additional-items-label-suffix').textContent = '(ì‹ ë…„ë„ êµ¬ê°„)';

                const currVal = USER_DATA.settings.basePays[currentKey] || '';
                const isRegCurr = USER_DATA.settings.regularPayChecks[currentKey] || false;
                
                document.getElementById('base-pay-label').textContent = 'ì‹ ë…„ë„ ê¸°ë³¸ê¸‰ ì…ë ¥';
                container.innerHTML = `
                    <div style="display:flex; gap: 5px;">
                        <input type="number" inputmode="decimal" id="base-pay-curr" placeholder="ì˜¬í•´ ê¸°ë³¸ê¸‰" value="${currVal}" oninput="saveSplitBasePaySetting()" style="flex: 1;">
                        <button onclick="copyPreviousMonthBasePay(); playSound('click');" style="background-color: var(--color-secondary); color: var(--color-bg); padding: 5px; border: none; border-radius: 4px; font-size: 0.8em; width: 50px; cursor:pointer; line-height:1.2;">ì „ë…„ë„<br>ë³µì‚¬</button>
                    </div>
                `;
                document.getElementById('regular-pay-check').checked = isRegCurr;
                document.getElementById('regular-pay-check').onclick = () => { saveSplitRegularPayCheckSetting(); playSound('toggle'); };
                
                // ì‹ ë…„ë„ ì¶”ê°€ ìˆ˜ë‹¹ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
                renderAdditionalItems(currentKey, 'curr');
            }

        } else {
            // í‰ë‹¬: íƒ­ ìˆ¨ê¹€ ë° ê¸°ë³¸ UI
            tabsContainer.style.display = 'none';
            document.getElementById('regular-pay-group').style.display = 'flex';
            document.getElementById('additional-items-wrapper').style.display = 'block';
            document.getElementById('additional-items-label-suffix').textContent = '';
            
            const val = USER_DATA.settings.basePays[currentKey] || '';
            const isReg = USER_DATA.settings.regularPayChecks[currentKey] || false;
            
            document.getElementById('base-pay-label').textContent = 'ê¸°ë³¸ê¸‰ ì…ë ¥';
            container.innerHTML = `
                <div style="display:flex; gap: 5px;">
                    <input type="number" inputmode="decimal" id="base-pay" placeholder="ê¸°ë³¸ê¸‰" value="${val}" oninput="saveBasePaySetting()" style="flex: 1;">
                    <button onclick="copyPreviousMonthBasePay(); playSound('click');" style="background-color: var(--color-secondary); color: var(--color-bg); padding: 5px 10px; border: none; border-radius: 4px; font-size: 0.8em; line-height: 1.2; text-align: center; width: 60px; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer;">ì´ì „ë‹¬<br>ê¸°ë³¸ê¸‰</button>
                </div>
            `;
            document.getElementById('regular-pay-check').checked = isReg;
            document.getElementById('regular-pay-check').onclick = () => { saveRegularPayCheckSetting(); playSound('toggle'); };
            
            renderAdditionalItems(currentKey, 'curr');
        }

        updateSalary();
    };

    // í‰ë‹¬ ì €ì¥
    const saveBasePaySetting = () => { const key = getCurrentActivePeriodKey(); if (key) { USER_DATA.settings.basePays[key] = Number(document.getElementById('base-pay').value) || 0; saveData(); updateSalary(); } };
    const saveRegularPayCheckSetting = () => { const key = getCurrentActivePeriodKey(); if (key) { USER_DATA.settings.regularPayChecks[key] = document.getElementById('regular-pay-check').checked; saveData(); updateSalary(); } };

    // 1ì›” ë¶„í•  ì €ì¥
    const saveSplitBasePaySetting = () => {
        const key = getCurrentActivePeriodKey();
        if (key) {
            if (currentJanTab === 'prev') {
                const val = Number(document.getElementById('base-pay-prev').value) || 0;
                USER_DATA.settings.prevYearBasePays[key] = val;
            } else if (currentJanTab === 'curr') {
                const val = Number(document.getElementById('base-pay-curr').value) || 0;
                USER_DATA.settings.basePays[key] = val;
            }
            saveData();
            updateSalary();
        }
    };
    
    const saveSplitRegularPayCheckSetting = () => {
        const key = getCurrentActivePeriodKey();
        if (key) {
            const isChecked = document.getElementById('regular-pay-check').checked;
            if (currentJanTab === 'prev') {
                USER_DATA.settings.prevYearRegularPayChecks[key] = isChecked;
            } else if (currentJanTab === 'curr') {
                USER_DATA.settings.regularPayChecks[key] = isChecked;
            }
            saveData();
            updateSalary();
        }
    };

    const saveSettings = () => { USER_DATA.class = document.getElementById('setting-class').value; saveData(); generateCalendar(); };
    const addOvertimeSettingItem = (name = '', time = 0.5) => { const container = document.getElementById('overtime-list-container'); const div = document.createElement('div'); let timeOptions = ''; for (let i = 0; i <= 10; i += 0.5) timeOptions += `<option value="${i}" ${i === time ? 'selected' : ''}>${i.toFixed(1)}h</option>`; div.innerHTML = `<input type="text" placeholder="ì”ì—… ì´ë¦„" value="${name}" oninput="saveOvertimeSettings()"><select onchange="saveOvertimeSettings()">${timeOptions}</select><button onclick="this.parentNode.remove(); saveOvertimeSettings(); playSound('delete');" style="background: none; border: none; color: var(--color-error); padding: 5px; font-size: 1.2em;">&times;</button>`; container.appendChild(div); };
    const saveOvertimeSettings = () => { const list = []; document.querySelectorAll('#overtime-list-container > div').forEach(div => { const name = div.querySelector('input[type="text"]').value; const time = Number(div.querySelector('select').value); if (name) list.push({ name, time }); }); USER_DATA.settings.overtimeList = list; saveData(); };

    // --- Work Record Modal & Others ---
    const switchTab = (tabName) => { document.querySelectorAll('.tab-content').forEach(c => c.style.display = 'none'); document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active')); document.getElementById(`tab-content-${tabName}`).style.display = 'block'; document.getElementById(`tab-${tabName}`).classList.add('active'); if (tabName === 'statistics') { populateStatsFilter(); renderStatistics(); } else if (tabName === 'calendar') { loadPeriodSettingsToUI(); } };
    const closeModal = (modalId) => document.getElementById(modalId).style.display = 'none';
    
    // showConfirm í•¨ìˆ˜ ìˆ˜ì •: onlyOk ë§¤ê°œë³€ìˆ˜ ì¶”ê°€ ë° ê¸°ëŠ¥ ê°œì„ 
    const showConfirm = (title, text, onOk, onlyOk = false) => {
        const modal = document.getElementById('confirm-modal');
        document.getElementById('confirm-modal-title').textContent = title;
        // íŒì—… ë©”ì‹œì§€ëŠ” ì¤„ë°”ê¿ˆì„ í—ˆìš© (white-space: pre-wrap; ìŠ¤íƒ€ì¼ë¡œ ì²˜ë¦¬)
        document.getElementById('confirm-modal-text').textContent = text; 

        const okBtn = document.getElementById('confirm-modal-ok');
        const cancelBtn = document.getElementById('confirm-modal-cancel');
        
        cancelBtn.style.display = onlyOk ? 'none' : 'inline-block';
        okBtn.textContent = onlyOk ? 'í™•ì¸' : 'í™•ì¸'; // í…ìŠ¤íŠ¸ë¥¼ 'í™•ì¸'ìœ¼ë¡œ í†µì¼

        const close = () => {
            modal.style.display = 'none';
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆê°€ ì¤‘ë³µí•´ì„œ ìŒ“ì´ëŠ” ê²ƒì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ì´ì „ì— í• ë‹¹ëœ ë¦¬ìŠ¤ë„ˆë¥¼ ì œê±° (í´ë¦°ì—…)
            okBtn.onclick = null;
            cancelBtn.onclick = null;
        };
        const okWithSoundListener = () => { onOk(); close(); playSound('save'); };
        const cancelWithSoundListener = () => { close(); playSound('click'); };

        // ìƒˆë¡œìš´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ í• ë‹¹ (í´ë¦°í•˜ê²Œ ì²˜ë¦¬)
        okBtn.onclick = okWithSoundListener;
        if (!onlyOk) {
            cancelBtn.onclick = cancelWithSoundListener;
        } else {
            // onlyOk ëª¨ë“œì¼ ë•Œ ì·¨ì†Œ ë²„íŠ¼ ì—­í• ì€ ë‹«ê¸°
            cancelBtn.onclick = cancelWithSoundListener;
        }
        
        modal.style.display = 'flex';
    };
    
    // [ìˆ˜ì •ë¨] ê´€ë¦¬ì ê³µì§€ íŒì—… ë¡œì§
    const checkAdminNotice = () => {
        if (!ADMIN_NOTICE_CONTENT) return; // ë‚´ìš©ì´ ì—†ìœ¼ë©´ ì¤‘ë‹¨

        const hideUntil = localStorage.getItem('smartSalaryApp_admin_notice_hide_until');
        if (hideUntil && new Date().getTime() < Number(hideUntil)) {
            return; // ìˆ¨ê¹€ ê¸°ê°„ì´ ì•„ì§ ì•ˆ ì§€ë‚¬ìœ¼ë©´ ì¤‘ë‹¨
        }

        document.getElementById('admin-notice-text').textContent = ADMIN_NOTICE_CONTENT;
        document.getElementById('admin-notice-modal').style.display = 'flex';
    };

    const closeAdminNotice = (hideForWeek) => {
        if (hideForWeek) {
            // 7ì¼ í›„ì˜ íƒ€ì„ìŠ¤íƒ¬í”„ ê³„ì‚°
            const nextWeek = new Date().getTime() + (7 * 24 * 60 * 60 * 1000);
            localStorage.setItem('smartSalaryApp_admin_notice_hide_until', nextWeek);
        }
        closeModal('admin-notice-modal');
    };
    
    // ------------------------------------

    const resetAllData = () => showConfirm('ë°ì´í„° ì´ˆê¸°í™”', 'ê²½ê³ : ëª¨ë“  ì €ì¥ëœ ë°ì´í„°ë¥¼ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œí•˜ê³  ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?', () => { localStorage.removeItem('smartSalaryApp_user_data'); window.location.reload(); }); 
    const backupData = () => { const dataStr = JSON.stringify(USER_DATA); const blob = new Blob([dataStr], { type: 'application/json' }); const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `smartSalaryApp_backup_${formatDate(new Date())}.json`; a.click(); URL.revokeObjectURL(a.href); };
    const restoreData = (event) => { const file = event.target.files[0]; if (!file) return; showConfirm('ë°ì´í„° ë³µêµ¬', 'í˜„ì¬ ë°ì´í„°ë¥¼ ë®ì–´ì“°ê³  ë³µêµ¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?', () => { const reader = new FileReader(); reader.onload = (e) => { try { const data = JSON.parse(e.target.result); if (!data.account) throw new Error("Invalid data"); localStorage.setItem('smartSalaryApp_user_data', JSON.stringify(data)); window.location.reload(); } catch (err) { alert('ë³µêµ¬ ì‹¤íŒ¨: ì˜ëª»ëœ íŒŒì¼ì…ë‹ˆë‹¤.'); } }; reader.readAsText(file); }); event.target.value = ''; };

    const toggleSalaryDetails = () => { const collapsed = document.getElementById('salary-input-section').classList.toggle('collapsed'); document.getElementById('salary-details-container').classList.toggle('collapsed'); document.getElementById('toggle-salary-details').textContent = collapsed ? 'â–²' : 'â–¼'; USER_DATA.settings.isSalaryDetailsCollapsed = collapsed; saveData(); };
    const copyPreviousMonthBasePay = () => { const prevKey = getPreviousPeriodKey(getCurrentActivePeriodKey()); const prevPay = USER_DATA.settings.basePays[prevKey] || 0; 
        // 1ì›”ì¼ ê²½ìš° ë³µì‚¬ ë¡œì§
        const currentKey = getCurrentActivePeriodKey();
        if (currentKey.endsWith('-12')) {
            if (currentJanTab === 'prev') {
                if (prevPay > 0) { document.getElementById('base-pay-prev').value = prevPay; saveSplitBasePaySetting(); }
            } else {
                 const prevJanPart = USER_DATA.settings.prevYearBasePays[currentKey] || 0;
                 if (prevJanPart > 0) { document.getElementById('base-pay-curr').value = prevJanPart; saveSplitBasePaySetting(); }
            }
        } else {
            if (prevPay > 0) { document.getElementById('base-pay').value = prevPay; saveBasePaySetting(); } 
        }
    };
    
    // [FIXED] 1ì›” ë¶„í• ì— ë”°ë¥¸ ì¶”ê°€ ìˆ˜ë‹¹ ë³µì‚¬ ë¡œì§ ê°œì„ 
    const copyPreviousMonthAdditionalItems = () => { 
        const currentKey = getCurrentActivePeriodKey(); if (!currentKey) return; 
        const prevKey = getPreviousPeriodKey(currentKey); if (!prevKey) return; 
        
        // ì–´ë””ì„œ ë³µì‚¬í•´ì˜¬ì§€, ì–´ë””ë¡œ ë³µì‚¬í• ì§€ ê²°ì •
        let sourceItems = [];
        let targetKey = currentKey;
        let isPrevTarget = false;

        // 1ì›” ë¶„í•  íƒ­ ë¡œì§ ì ìš©
        if (currentKey.endsWith('-12') && currentJanTab === 'prev') {
            // ì „ë…„ë„(12ì›”) ë°ì´í„° -> 1ì›”ì˜ 'ì „ë…„ë„ êµ¬ê°„'ìœ¼ë¡œ ë³µì‚¬
            sourceItems = USER_DATA.settings.additionalItemsByPeriod[prevKey];
            isPrevTarget = true;
        } else if (currentKey.endsWith('-12') && currentJanTab === 'curr') {
             // 1ì›”ì˜ 'ì „ë…„ë„ êµ¬ê°„' ë°ì´í„° -> 1ì›”ì˜ 'ì‹ ë…„ë„ êµ¬ê°„'ìœ¼ë¡œ ë³µì‚¬ (ì—°ì†ì„±)
            sourceItems = USER_DATA.settings.prevYearAdditionalItemsByPeriod[currentKey];
            if (!sourceItems || sourceItems.length === 0) {
                 // ì—†ë‹¤ë©´ ì‘ë…„ 12ì›”êº¼ë¼ë„
                 sourceItems = USER_DATA.settings.additionalItemsByPeriod[prevKey];
            }
        } else {
            // í‰ë‹¬: ì´ì „ë‹¬ -> ì´ë²ˆë‹¬
             sourceItems = USER_DATA.settings.additionalItemsByPeriod[prevKey];
        }

        if (sourceItems && sourceItems.length > 0) { 
            const newItems = JSON.parse(JSON.stringify(sourceItems));
            if (isPrevTarget) {
                 USER_DATA.settings.prevYearAdditionalItemsByPeriod[targetKey] = newItems;
            } else {
                 USER_DATA.settings.additionalItemsByPeriod[targetKey] = newItems;
            }
            saveData(); 
            // íƒ­ ìƒíƒœì— ë§ì¶° ë‹¤ì‹œ ë Œë”ë§
            renderAdditionalItems(targetKey, isPrevTarget ? 'prev' : 'curr'); 
            updateSalary(); 
        } else { 
            alert('ë³µì‚¬í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.'); 
        } 
    };

    const addAdditionalItem = (n = '', a = '') => { const c = document.getElementById('additional-items-list'); const d = document.createElement('div'); d.innerHTML = `<input type="text" placeholder="ìˆ˜ë‹¹ ì´ë¦„" value="${n}" oninput="saveAdditionalItems()"><input type="number" inputmode="decimal" placeholder="ê¸ˆì•¡" value="${a}" oninput="saveAdditionalItems()" style="flex: 1;"><button onclick="toggleSign(this.previousElementSibling); playSound('click');" style="background-color: var(--color-disabled); color: var(--color-bg); border: 1px solid var(--color-border); border-radius: 4px; font-weight: bold; width: 40px; height: 34px; margin-left: 5px; cursor: pointer; flex: 0 0 40px; padding: 0;">+/-</button><button onclick="this.parentNode.remove(); saveAdditionalItems(); playSound('delete');" style="background: none; border: none; color: var(--color-error); padding: 5px; font-size: 1.2em; flex: 0 0 30px;">&times;</button>`; c.appendChild(d); };
    
    // [FIXED] ë Œë”ë§ ì‹œ context (prev/curr) êµ¬ë¶„
    const renderAdditionalItems = (key, context = 'curr') => { 
        const c = document.getElementById('additional-items-list'); c.innerHTML = ''; 
        let items = [];
        if (key) {
            if (context === 'prev') {
                items = USER_DATA.settings.prevYearAdditionalItemsByPeriod[key] || [];
            } else {
                items = USER_DATA.settings.additionalItemsByPeriod[key] || [];
            }
        }
        items.forEach(i => addAdditionalItem(i.name, i.amount)); 
    };

    // [FIXED] ì €ì¥ ì‹œ í˜„ì¬ íƒ­ ìƒíƒœ í™•ì¸í•˜ì—¬ êµ¬ë¶„ ì €ì¥
    const saveAdditionalItems = () => { 
        const key = getCurrentActivePeriodKey(); if (!key) return; 
        const items = []; 
        document.querySelectorAll('#additional-items-list > div').forEach(d => { 
            const inputs = d.querySelectorAll('input'); 
            const n = inputs[0].value; 
            const a = Number(inputs[1].value); 
            if (n) items.push({ name: n, amount: a }); 
        }); 
        
        if (key.endsWith('-12') && currentJanTab === 'prev') {
            USER_DATA.settings.prevYearAdditionalItemsByPeriod[key] = items;
        } else {
            USER_DATA.settings.additionalItemsByPeriod[key] = items; 
        }
        saveData(); updateSalary(); 
    };
    const toggleSign = (inputElement) => { if (!inputElement || inputElement.value === '') return; inputElement.value = Number(inputElement.value) * -1; inputElement.dispatchEvent(new Event('input', { bubbles: true })); };

    const populateStatsFilter = () => { const yf = document.getElementById('stats-year-filter'); const years = new Set(); Object.keys(USER_DATA.settings.basePays).forEach(k => years.add(k.substring(0, 4))); Object.keys(USER_DATA.workRecords).forEach(d => years.add(d.substring(0, 4))); years.add(new Date().getFullYear().toString()); const sorted = Array.from(years).sort((a, b) => b - a); yf.innerHTML = '<option value="all">ì „ì²´ ë…„ë„</option>'; sorted.forEach(y => yf.innerHTML += `<option value="${y}">${y}ë…„</option>`); yf.value = new Date().getFullYear(); };
    
    // [ìˆ˜ì •ë¨] í†µê³„ ë³´ê¸° ëª¨ë“œ ë° ìƒë‹¨ ëŒ€ì‹œë³´ë“œ í•©ê³„ ê³„ì‚° ì ìš©
    const renderStatistics = () => { 
        const yVal = document.getElementById('stats-year-filter').value;
        const mVal = Number(document.getElementById('stats-month-filter').value);
        const viewMode = document.getElementById('stats-view-mode').value; // ë³´ê¸° ëª¨ë“œ ê°’ ê°€ì ¸ì˜¤ê¸°
        const tb = document.getElementById('stats-table-body'); 
        tb.innerHTML = ''; 
        let years = yVal === 'all' ? Array.from(document.getElementById('stats-year-filter').options).map(o => o.value).filter(v => v !== 'all') : [yVal]; 
        
        // ì „ì²´ í•©ê³„ ë³€ìˆ˜ ì´ˆê¸°í™”
        let totalNet = 0; // ì‹¤ìˆ˜ë ¹ì•¡ (ìµœì¢…)
        let totalGross = 0; // ì§€ê¸‰ ì´ì•¡ (ì„¸ì „)
        let totalDeduct = 0; // ê³µì œ ì´ì•¡ (ë§ˆì´ë„ˆìŠ¤)
        
        // í…Œì´ë¸” í—¤ë” ë³€ê²½
        const thead = document.querySelector('.stats-table thead tr');
        let headerLabel = 'ì‹¤ìˆ˜ë ¹ì•¡';
        if (viewMode === 'work') headerLabel = 'ê·¼ë¬´ í˜„í™©';
        else if (viewMode === 'deduction') headerLabel = 'ê³µì œ ì´ì•¡';

        if(thead) thead.innerHTML = `<th>ê¸°ê°„</th><th>${headerLabel}</th><th style="text-align:center;">ìƒì„¸</th>`;

        years.forEach(y => { 
            for (let displayMonth = (mVal || 1); displayMonth <= (mVal || 12); displayMonth++) { 
                let targetYear = Number(y);
                let targetKeyMonth = displayMonth - 1; 
                if (targetKeyMonth === 0) { targetKeyMonth = 12; targetYear = targetYear - 1; }
                
                const key = `${targetYear}-${String(targetKeyMonth).padStart(2, '0')}`;
                const s = calculatePeriodStats(key); 

                // ë°ì´í„°ê°€ ì¡´ì¬í•˜ëŠ” ë‹¬ë§Œ í‘œì‹œ
                if (s.totalSalary !== 0 || s.basePay !== 0) { 
                    // í•©ê³„ ëˆ„ì  (s.totalDeductionsëŠ” ìŒìˆ˜ ê°’ì´ë¯€ë¡œ ì ˆëŒ“ê°’ìœ¼ë¡œ ì²˜ë¦¬í•˜ì§€ ì•Šê³  ê·¸ëŒ€ë¡œ ë”í•˜ë©´ ì¤„ì–´ë“œë‹ˆ ì£¼ì˜)
                    // ì—¬ê¸°ì„œëŠ” 'ê³µì œ ì´ì•¡'ì„ ì–‘ìˆ˜ ê°œë…ìœ¼ë¡œ ë³´ì—¬ì¤„ì§€ ìŒìˆ˜ë¡œ ë³´ì—¬ì¤„ì§€ì— ë”°ë¼ ë‹¤ë¦„.
                    // í†µìƒì ìœ¼ë¡œ ê³µì œì•¡ì€ "ì–¼ë§ˆ ë—ë‹¤" í‘œí˜„í•˜ë¯€ë¡œ ë§ˆì´ë„ˆìŠ¤ ë¶€í˜¸ì™€ í•¨ê»˜ í•©ì‚°.
                    
                    totalNet += s.totalSalary;
                    
                    // ì§€ê¸‰ ì´ì•¡ = ê¸°ë³¸ê¸‰ + ì”ì—…ìˆ˜ë‹¹ + (ì–‘ìˆ˜ ì¶”ê°€ìˆ˜ë‹¹)
                    const monthGross = s.basePay + s.totalOvertimePay + s.totalAllowances;
                    totalGross += monthGross;
                    
                    totalDeduct += s.totalDeductions; // s.totalDeductionsëŠ” ì´ë¯¸ ìŒìˆ˜ê°’ì„
                    
                    const rowId = `stats-row-${key}`;
                    
                    // ìƒì„¸ ë‚´ì—­ êµ¬í•˜ê¸°
                    let items = [...(USER_DATA.settings.additionalItemsByPeriod[key] || [])];
                    if (key.endsWith('-12')) {
                        items = [...items, ...(USER_DATA.settings.prevYearAdditionalItemsByPeriod[key] || [])];
                    }
                    
                    let allowanceListHtml = '';
                    let deductionListHtml = '';

                    items.forEach(item => {
                        const amountStr = Math.round(item.amount).toLocaleString();
                        if(item.amount >= 0) {
                            allowanceListHtml += `<div class="detail-list-item"><span>${item.name}</span><span class="amount-plus">+${amountStr}</span></div>`;
                        } else {
                            deductionListHtml += `<div class="detail-list-item"><span>${item.name}</span><span class="amount-minus">${amountStr}</span></div>`;
                        }
                    });

                    if(!allowanceListHtml) allowanceListHtml = '<div class="detail-list-item" style="color:#aaa;">ì—†ìŒ</div>';
                    if(!deductionListHtml) deductionListHtml = '<div class="detail-list-item" style="color:#aaa;">ì—†ìŒ</div>';

                    // [ìˆ˜ì •ë¨] ë³´ê¸° ëª¨ë“œì— ë”°ë¼ í‘œì‹œí•  ê°’ ê²°ì •
                    let displayValue = '';
                    if (viewMode === 'salary') {
                        displayValue = `${Math.round(s.totalSalary).toLocaleString()} ì›`;
                    } else if (viewMode === 'work') {
                        // ëª¨ë°”ì¼ í™”ë©´ ê³µê°„ ê³ ë ¤í•˜ì—¬ ê°„ëµ í‘œì‹œ
                        displayValue = `<span style="font-size:0.85em; color:var(--color-text);">ì•¼ê°„:${s.nightDays} íŠ¹ê·¼:${s.specialDays} íœ´ê°€:${s.vacationDays}</span>`;
                    } else if (viewMode === 'deduction') {
                        displayValue = `<span style="color:var(--color-error); font-weight:bold;">${Math.round(s.totalDeductions).toLocaleString()} ì›</span>`;
                    }

                    // ë©”ì¸ í–‰
                    tb.innerHTML += `
                        <tr class="stats-row-main" onclick="toggleStatsDetail('${rowId}'); playSound('click');">
                            <td>${y}ë…„ ${displayMonth}ì›”</td>
                            <td style="font-weight:bold; color:var(--color-primary);">${displayValue}</td>
                            <td style="text-align:center; font-size:0.8em;">â–¼</td>
                        </tr>
                        <tr id="${rowId}" class="stats-detail-row">
                            <td colspan="3">
                                <div class="detail-content">
                                    <div class="detail-grid">
                                        <span class="detail-label">ê¸°ë³¸ê¸‰</span>
                                        <span class="detail-value">${Math.round(s.basePay).toLocaleString()}</span>
                                        
                                        <span class="detail-label">ì´ˆê³¼ê·¼ë¬´ìˆ˜ë‹¹</span>
                                        <span class="detail-value">${Math.round(s.totalOvertimePay).toLocaleString()}</span>
                                        
                                        <span class="detail-label">ì¶”ê°€ ìˆ˜ë‹¹ê³„</span>
                                        <span class="detail-value amount-plus">+${Math.round(s.totalAllowances).toLocaleString()}</span>
                                        
                                        <span class="detail-label">ê³µì œ í•©ê³„</span>
                                        <span class="detail-value amount-minus">${Math.round(s.totalDeductions).toLocaleString()}</span>
                                    </div>
                                    <div style="margin-top:5px; font-size:0.85em; color:var(--color-text-secondary); text-align:right;">
                                        (ì•¼ê°„:${s.nightDays}ì¼ / íŠ¹ê·¼:${s.specialDays}ì¼ / íœ´ê°€:${s.vacationDays}ì¼)
                                    </div>

                                    <div class="detail-section-title">ìˆ˜ë‹¹ ìƒì„¸</div>
                                    ${allowanceListHtml}

                                    <div class="detail-section-title">ê³µì œ ìƒì„¸</div>
                                    ${deductionListHtml}
                                </div>
                            </td>
                        </tr>
                    `;
                } 
            } 
        }); 
        
        // ìƒë‹¨ ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸
        document.getElementById('stats-dash-net').textContent = `${Math.round(totalNet).toLocaleString()} ì›`;
        document.getElementById('stats-dash-gross').textContent = `${Math.round(totalGross).toLocaleString()} ì›`;
        document.getElementById('stats-dash-deduct').textContent = `${Math.round(totalDeduct).toLocaleString()} ì›`;
    };

    // [ì¶”ê°€ë¨] ìƒì„¸ í–‰ í† ê¸€ í•¨ìˆ˜
    const toggleStatsDetail = (rowId) => {
        const row = document.getElementById(rowId);
        const allRows = document.querySelectorAll('.stats-detail-row');
        
        // ë‹¤ë¥¸ ì—´ë ¤ìˆëŠ” í–‰ë“¤ì€ ë‹«ê¸° (ì„ íƒì‚¬í•­)
        allRows.forEach(r => {
            if(r.id !== rowId) r.classList.remove('show');
        });

        if (row) {
            row.classList.toggle('show');
        }
    };

    const renderCustomHolidays = () => { document.getElementById('custom-holidays-list').innerHTML = ''; USER_DATA.settings.customHolidays.filter(h => !DEFAULT_HOLIDAYS_BASE.some(d => d.date === h.date)).forEach(h => addCustomHolidayInput(h.date, h.name)); };
    const addCustomHolidayInput = (d = '', n = '') => { const c = document.getElementById('custom-holidays-list'); c.insertAdjacentHTML('beforeend', `<div style="display: flex; gap: 10px; margin-bottom: 5px;"><input type="date" value="${d}" onchange="saveCustomHolidays()"><input type="text" placeholder="ê³µíœ´ì¼ ì´ë¦„" value="${n}" oninput="saveCustomHolidays()"><button onclick="this.parentNode.remove(); saveCustomHolidays(); playSound('delete');" style="background:none;border:none;color:var(--color-error);font-size:1.2em;">&times;</button></div>`); };
    const saveCustomHolidays = () => { const h = [...DEFAULT_HOLIDAYS_BASE]; const addedHolidays = new Set(DEFAULT_HOLIDAYS_BASE.map(d => d.date)); document.querySelectorAll('#custom-holidays-list > div').forEach(d => { const date = d.querySelector('input[type="date"]').value; const name = d.querySelector('input[type="text"]').value || 'ì§€ì • ê³µíœ´ì¼'; if (date && !addedHolidays.has(date)) { h.push({ date, name }); } }); USER_DATA.settings.customHolidays = h; saveData(); generateCalendar(); };
    const renderOvertimeSettings = () => { document.getElementById('overtime-list-container').innerHTML = ''; USER_DATA.settings.overtimeList.forEach(i => addOvertimeSettingItem(i.name, i.time)); };
    const renderClassChangeHistory = () => { document.getElementById('class-change-history-list').innerHTML = ''; USER_DATA.settings.classChangeHistory.forEach(r => addClassChangeRecordInput(r.changeDate, r.newClass)); };
    const addClassChangeRecordInput = (d = '', c = USER_DATA.class) => { const cont = document.getElementById('class-change-history-list'); const opts = ['A', 'B', 'C', 'D'].map(v => `<option value="${v}" ${v === c ? 'selected' : ''}>${v}ë°˜</option>`).join(''); cont.insertAdjacentHTML('beforeend', `<div class="change-record-row"><input type="date" value="${d}" onchange="saveClassChangeHistory()"><select onchange="saveClassChangeHistory()">${opts}</select><button onclick="this.parentNode.remove(); saveClassChangeHistory(); playSound('delete');" style="background:none;border:none;color:var(--color-error);font-size:1.2em;">&times;</button></div>`); };
    const saveClassChangeHistory = () => { const h = []; document.querySelectorAll('#class-change-history-list > div').forEach(d => { const date = d.querySelector('input[type="date"]').value; const newClass = d.querySelector('select').value; if (date) h.push({ changeDate: date, newClass: newClass }); }); USER_DATA.settings.classChangeHistory = h; saveData(); generateCalendar(); };
    const toggleTheme = (isLight) => { USER_DATA.settings.isLightMode = isLight; saveData(); applyTheme(isLight); };
    const applyTheme = (isLight) => { document.documentElement.classList.toggle('light-mode', isLight); };
    
    const openWorkRecordModal = (dateStr) => {
        document.getElementById('modal-date-title').textContent = `${dateStr} ê·¼ë¬´ ê¸°ë¡`;
        document.getElementById('modal-selected-date').value = dateStr;
        document.querySelectorAll('input[name="work-type"]').forEach(i => i.checked = false);
        document.getElementById('modal-overtime-list').innerHTML = '';
        const workRecord = USER_DATA.workRecords[dateStr];
        if (workRecord) {
            const typeInput = document.getElementById(`type-${workRecord.type}`);
            if (typeInput) typeInput.checked = true;
            if (workRecord.overtimes) workRecord.overtimes.forEach(ot => addOvertimeRow(false, ot.name, ot.time));
            document.getElementById('delete-record-btn').style.display = 'inline-block';
        } else {
            document.getElementById('type-ë¯¸ì„ íƒ').checked = true;
            document.getElementById('delete-record-btn').style.display = 'none';
        }
        document.getElementById('work-record-modal').style.display = 'flex';
    };
    const saveWorkRecord = () => {
        const dateStr = document.getElementById('modal-selected-date').value;
        const type = document.querySelector('input[name="work-type"]:checked')?.value;
        if (!type) return;
        const overtimes = [];
        document.querySelectorAll('#modal-overtime-list .overtime-input-row').forEach(row => {
            const name = row.querySelector('select').value;
            const time = Number(row.querySelector('input[type="number"]').value);
            if (name && time > 0) overtimes.push({ name, time });
        });
        USER_DATA.workRecords[dateStr] = { date: dateStr, type, overtimes };
        saveData(); updateDayCell(dateStr); updateSalary(); closeModal('work-record-modal');
    };
    const deleteWorkRecord = () => { const dateStr = document.getElementById('modal-selected-date').value; showConfirm(`${dateStr} ê¸°ë¡ ì‚­ì œ`, 'ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?', () => { delete USER_DATA.workRecords[dateStr]; saveData(); updateDayCell(dateStr); updateSalary(); closeModal('work-record-modal'); }); };
    const addOvertimeRow = (isNew, name = '', time = '') => { const container = document.getElementById('modal-overtime-list'); const row = document.createElement('div'); row.className = 'overtime-input-row'; const options = USER_DATA.settings.overtimeList.map(item => `<option value="${item.name}" ${item.name === name ? 'selected' : ''}>${item.name}</option>`).join(''); row.innerHTML = `<select><option value="">--- ì„ íƒ ---</option>${options}</select><input type="number" step="0.5" placeholder="ì‹œê°„" value="${time}" readonly><button onclick="this.parentNode.remove(); playSound('delete');" style="background:none; border:none; color:var(--color-error); font-size:1.2em; padding:0; cursor:pointer;">&times;</button>`; row.querySelector('select').addEventListener('change', function() { const selected = USER_DATA.settings.overtimeList.find(i => i.name === this.value); this.nextElementSibling.value = selected ? selected.time : ''; }); container.appendChild(row); };

    const scrollToTodayMonth = (id = null, isInitialLoad = false) => { const today = new Date(); const monthId = id || `month-${today.getFullYear()}-${today.getMonth()}`; const el = document.getElementById(monthId); if (el) { el.scrollIntoView({ behavior: 'auto', block: 'start' }); if (isInitialLoad) { clearTimeout(scrollTimeout); document.querySelectorAll('.calendar-month').forEach(m => m.classList.remove('active')); el.classList.add('active'); loadPeriodSettingsToUI(); } else { setTimeout(() => updateActiveMonth(), 50); } } };
    
    // [FIXED] ì•ˆë“œë¡œì´ë“œ Webview ì¶©ëŒ ë°©ì§€: AudioContext ì˜ˆì™¸ ì²˜ë¦¬ ê°•í™”
    const playSound = (type = 'click') => { 
        if (USER_DATA.settings.isMuted) return; 
        try { 
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (!AudioContext) return; 
            
            if (!audioCtx || audioCtx.state === 'closed') { 
                audioCtx = new AudioContext(); 
            } 
            // ì•ˆë“œë¡œì´ë“œ ìë™ì¬ìƒ ì •ì±… ëŒ€ì‘: suspended ìƒíƒœë©´ resume ì‹œë„ (ì‹¤íŒ¨ ì‹œ ë¬´ì‹œ)
            if (audioCtx.state === 'suspended') { 
                audioCtx.resume().catch(e => console.warn("Audio resume failed:", e));
            } 
            
            const oscillator = audioCtx.createOscillator(); 
            const gainNode = audioCtx.createGain(); 
            oscillator.connect(gainNode); 
            gainNode.connect(audioCtx.destination); 
            
            const now = audioCtx.currentTime;
            
            gainNode.gain.setValueAtTime(0, now); 
            gainNode.gain.linearRampToValueAtTime(0.3, now + 0.01); 
            
            switch (type) { 
                case 'toggle': oscillator.type = 'sine'; oscillator.frequency.setValueAtTime(600, now); break; 
                case 'save': oscillator.type = 'sine'; oscillator.frequency.setValueAtTime(800, now); break; 
                case 'delete': oscillator.type = 'sawtooth'; oscillator.frequency.setValueAtTime(300, now); break; 
                case 'open': oscillator.type = 'triangle'; oscillator.frequency.setValueAtTime(700, now); break; 
                default: oscillator.type = 'triangle'; oscillator.frequency.setValueAtTime(500, now); 
            } 
            
            oscillator.start(now); 
            gainNode.gain.exponentialRampToValueAtTime(0.0001, now + 0.05); 
            oscillator.stop(now + 0.05); 
        } catch (e) { 
            console.warn("Audio API Error (Ignored to prevent crash):", e); 
        } 
    };
    
    const toggleMute = (isSoundOn) => { USER_DATA.settings.isMuted = !isSoundOn; saveData(); if (isSoundOn) { playSound('toggle'); } };

    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('tab-calendar').addEventListener('click', () => { switchTab('calendar'); playSound('open'); });
        document.getElementById('tab-statistics').addEventListener('click', () => { switchTab('statistics'); playSound('open'); });
        document.getElementById('tab-settings').addEventListener('click', () => { switchTab('settings'); playSound('open'); });
        document.getElementById('today-button').addEventListener('click', () => { scrollToTodayMonth(); playSound('click'); });
        document.getElementById('work-type-group').addEventListener('change', () => document.getElementById('modal-overtime-list').innerHTML = ''); 
        loadData();
        checkAdminNotice(); // ì•± ì‹œì‘ ì‹œ ê´€ë¦¬ì ê³µì§€ í™•ì¸
    });
</script>
</body>
</html>
