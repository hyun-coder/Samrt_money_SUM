<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ìŠ¤ë§ˆíŠ¸ ì›”ê¸‰ ê³„ì‚° (ìµœì¢… ìˆ˜ì •)</title>
    <style>
        /* === 1. ë‹¤í¬ ëª¨ë“œ ë° ê¸°ë³¸ ìŠ¤íƒ€ì¼ === */
        :root {
            --color-bg-dark: #121212;
            --color-surface-dark: #1E1E1E;
            --color-text-light: #E0E0E0;
            --color-primary: #00BFFF; /* ë°ì€ ì²­ë¡ìƒ‰ (í¬ì¸íŠ¸) */
            --color-secondary: #FF6F00; /* ì£¼í™©ìƒ‰ (ê²½ê³ /ê°•ì¡°) */
            --color-error: #CF6679;
            --color-highlight: rgba(0, 191, 255, 0.15);
            --color-disabled: #383838;
            --shadow-elevation: 0 4px 8px rgba(0, 0, 0, 0.5);
            --mobile-padding: 16px;
        }

        body {
            background-color: var(--color-bg-dark);
            color: var(--color-text-light);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* === 2. ë ˆì´ì•„ì›ƒ ë° íƒ­ === */
        .app-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .header {
            background-color: var(--color-surface-dark);
            padding: 12px var(--mobile-padding);
            box-shadow: var(--shadow-elevation);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            font-size: 1.4em;
            margin: 0;
            text-align: center;
        }

        .tab-bar {
            display: flex;
            justify-content: space-around;
            background-color: var(--color-surface-dark);
            border-bottom: 1px solid var(--color-disabled);
        }

        .tab-button {
            flex: 1;
            padding: 12px 0;
            text-align: center;
            font-size: 1em;
            cursor: pointer;
            border: none;
            background: none;
            color: var(--color-text-light);
            opacity: 0.6;
            transition: opacity 0.3s, color 0.3s, border-bottom 0.3s;
        }

        .tab-button.active {
            color: var(--color-primary);
            opacity: 1;
            border-bottom: 3px solid var(--color-primary);
        }

        .content-area {
            flex-grow: 1;
            overflow-y: auto;
            position: relative; /* ìì‹ ìš”ì†Œì˜ ì ˆëŒ€ ìœ„ì¹˜ ê¸°ì¤€ */
        }

        /* === 3. ê¸‰ì—¬ ë° ì„¤ì • ì„¹ì…˜ (ìƒë‹¨ ê³ ì •) */
        #salary-input-section {
            background-color: var(--color-surface-dark);
            padding: 10px var(--mobile-padding);
            margin-bottom: 10px;
            border-radius: 8px;
            margin: 10px var(--mobile-padding);
            position: relative; /* í† ê¸€ ë²„íŠ¼ ê¸°ì¤€ */
        }

        .salary-summary h2 {
            font-size: 1.6em;
            color: var(--color-primary);
            margin: 0 0 5px 0;
        }
        
        .salary-summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .input-group, .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .input-group label {
            flex: 2;
            font-size: 0.9em;
        }

        .input-group input, .input-group select {
            flex: 3;
            padding: 8px;
            border: 1px solid var(--color-disabled);
            border-radius: 4px;
            background-color: var(--color-bg-dark);
            color: var(--color-text-light);
            font-size: 1em;
        }
        
        .checkbox-group label {
            flex: 3;
            font-size: 0.9em;
        }
        
        #additional-items-list div {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
        }
        
        #additional-items-list input {
            flex: 1;
        }
        
        /* í† ê¸€ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        #toggle-salary-details {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: var(--color-primary);
            font-size: 1.5em;
            cursor: pointer;
            padding: 5px;
            transition: transform 0.3s;
            line-height: 1;
        }
        
        .collapsed #toggle-salary-details {
            transform: rotate(180deg);
        }
        
        #salary-details-container.collapsed {
            display: none;
        }

        /* === 4. ë‹¬ë ¥ ì„¹ì…˜ === */
        #calendar-view {
            overflow-y: scroll;
            height: calc(100vh - 200px); /* í—¤ë” ë° ê¸‰ì—¬ ì„¹ì…˜ì„ ì œì™¸í•œ ë†’ì´ */
            scroll-snap-type: y mandatory;
        }

        .calendar-month {
            scroll-snap-align: center;
            background-color: var(--color-surface-dark);
            margin: 10px var(--mobile-padding);
            border-radius: 8px;
            padding: 10px;
            opacity: 0.3; /* ë¹„í™œì„±í™”ëœ ë‹¬ì€ íë¦¬ê²Œ */
            transition: opacity 0.3s, transform 0.3s;
        }

        .calendar-month.active {
            opacity: 1; /* í™œì„±í™”ëœ ë‹¬ì€ ì„ ëª…í•˜ê²Œ */
        }

        .month-header {
            text-align: center;
            font-size: 1.5em;
            margin-bottom: 10px;
            color: var(--color-primary);
        }

        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            font-size: 0.8em;
            margin-bottom: 5px;
        }

        .weekdays span {
            color: var(--color-text-light); /* ê¸°ë³¸ ë°ì€ìƒ‰ */
        }
        .weekdays .sunday {
            color: var(--color-error); /* ì¼ìš”ì¼ ë¶‰ì€ìƒ‰ */
        }
        .weekdays .saturday {
            color: #4c91b1; /* í† ìš”ì¼ íŒŒë€ìƒ‰ ê³„ì—´ */
        }


        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }

        .day-cell {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 5px 0;
            border-radius: 6px;
            font-size: 1em;
            min-height: 50px;
            cursor: pointer;
            position: relative;
            background-color: var(--color-bg-dark);
            transition: background-color 0.2s;
        }

        .day-cell:not(.disabled):active {
            background-color: var(--color-highlight);
        }

        .day-number {
            font-weight: bold;
            margin-bottom: 2px;
            font-size: 1em;
        }

        .day-status {
            font-size: 0.7em;
            font-weight: 500;
            color: var(--color-primary);
            margin-bottom: 1px;
            line-height: 1; 
        }
        
        .day-overtime {
            font-size: 0.7em;
            color: var(--color-secondary);
            min-height: 0.8em; 
            line-height: 1; 
        }

        .holiday .day-number {
            color: var(--color-error); /* ê³µíœ´ì¼ì€ ë¶‰ì€ìƒ‰ */
        }

        .disabled {
            color: var(--color-disabled);
            background-color: var(--color-surface-dark);
            cursor: default;
        }

        .today {
            border: 2px solid var(--color-secondary);
        }

        /* === 5. ëª¨ë‹¬ (ì…ë ¥/ì„¤ì • íŒì—…) === */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 200;
        }

        .modal-content {
            background-color: var(--color-surface-dark);
            padding: var(--mobile-padding);
            border-radius: 12px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-elevation);
        }

        .modal-content h3 {
            margin-top: 0;
            border-bottom: 1px solid var(--color-disabled);
            padding-bottom: 10px;
            color: var(--color-primary);
        }

        .form-row {
            margin-bottom: 15px;
        }

        .form-row label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .radio-group input[type="radio"] {
            display: none;
        }

        .radio-group label {
            background-color: var(--color-bg-dark);
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
            font-weight: normal;
        }

        .radio-group input[type="radio"]:checked + label {
            background-color: var(--color-primary);
            color: var(--color-bg-dark);
            font-weight: bold;
        }

        /* ì”ì—… ì…ë ¥ ìŠ¤íƒ€ì¼ */
        .overtime-input-row {
            display: grid;
            grid-template-columns: 2fr 1fr 0.5fr;
            gap: 10px;
            align-items: center;
            margin-top: 5px;
        }
        
        .overtime-input-row select, .overtime-input-row input {
            padding: 8px;
            border: 1px solid var(--color-disabled);
            border-radius: 4px;
            background-color: var(--color-bg-dark);
            color: var(--color-text-light);
            font-size: 0.9em;
        }

        .modal-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .modal-actions button {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            font-size: 1em;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .modal-actions button.primary {
            background-color: var(--color-primary);
            color: var(--color-bg-dark);
        }

        .modal-actions button.secondary {
            background-color: var(--color-disabled);
            color: var(--color-text-light);
        }
        
        .modal-actions button.danger {
            background-color: var(--color-error);
            color: var(--color-text-light);
        }

        /* ê¸°íƒ€ ìœ í‹¸ë¦¬í‹° */
        .float-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--color-secondary);
            color: var(--color-bg-dark);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-elevation);
            z-index: 150;
        }
        
        /* í†µê³„ ì‹œíŠ¸ ìŠ¤íƒ€ì¼ */
        #statistics-view {
            padding: var(--mobile-padding);
        }
        
        .stats-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .stats-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .stats-table th, .stats-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid var(--color-disabled);
            font-size: 0.9em;
        }
        
        .stats-table th {
            color: var(--color-primary);
            font-weight: bold;
        }
        
        .stats-summary-row {
            background-color: var(--color-bg-dark);
        }
        
        /* ì´ˆê¸° ì„¤ì • ëª¨ë‹¬ */
        #initial-setup-modal .modal-content {
            width: 80%;
        }
        
        #initial-setup-modal input {
            width: 100%;
            box-sizing: border-box;
        }

        /* ì”ì—… ì¢…ë¥˜ ê´€ë¦¬ */
        #overtime-list-container div {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
        }
        #overtime-list-container input {
            flex: 1;
        }

    </style>
</head>
<body>

    <div class="app-container">
        
        <header class="header">
            <h1 id="app-title">ìŠ¤ë§ˆíŠ¸ ì›”ê¸‰ ê³„ì‚°</h1>
            <button id="today-button" class="float-button" title="ì˜¤ëŠ˜ ë‚ ì§œë¡œ ì´ë™" style="bottom: auto; top: 10px; right: 10px; width: 40px; height: 40px; font-size: 1.2em;">ğŸ“…</button>
        </header>
        
        <div class="tab-bar">
            <button class="tab-button active" id="tab-calendar">ë‹¬ë ¥/ì…ë ¥</button>
            <button class="tab-button" id="tab-statistics">í†µê³„</button>
            <button class="tab-button" id="tab-settings">ì„¤ì •</button>
        </div>
        
        <div class="content-area">

            <div id="tab-content-calendar" class="tab-content">
                
                <section id="salary-input-section">
                    <div class="salary-summary-header">
                        <div>
                            <small id="salary-period-info">ì´ ì˜ˆìƒ ì›”ê¸‰ (20ì¼ ~ ìµì›” 19ì¼)</small>
                            <h2 id="total-expected-salary">0 ì›</h2>
                        </div>
                        <button id="toggle-salary-details" onclick="toggleSalaryDetails()">â–¼</button>
                    </div>

                    <div id="salary-details-container">
                        <div id="current-salary-options" style="font-size:0.8em; color: var(--color-primary);"></div>
                        
                        <div id="calculated-stats" style="margin-top: 5px; margin-bottom: 15px; padding: 10px; border: 1px solid var(--color-disabled); border-radius: 4px; background-color: var(--color-bg-dark);">
                            <div class="stats-row" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                <span style="flex: 2; color: var(--color-text-light);">í‰ì¼ì”ì—…ì‹œê°„:</span>
                                <span id="stat-weekday-ot-time-count" style="flex: 1; text-align: right; font-weight: bold; margin-right: 10px;">0.0h</span>
                                <span id="stat-weekday-ot-time-amount" style="flex: 2; text-align: right; color: var(--color-primary);">0 ì›</span>
                            </div>
                            <div class="stats-row" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                <span style="flex: 2; color: var(--color-text-light);">íŠ¹ê·¼ì”ì—…ì‹œê°„:</span>
                                <span id="stat-special-ot-time-count" style="flex: 1; text-align: right; font-weight: bold; margin-right: 10px;">0.0h</span>
                                <span id="stat-special-ot-time-amount" style="flex: 2; text-align: right; color: var(--color-primary);">0 ì›</span>
                            </div>
                            <div class="stats-row" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                <span style="flex: 2; color: var(--color-text-light);">íŠ¹ê·¼ì¼ìˆ˜:</span>
                                <span id="stat-special-day-count-count" style="flex: 1; text-align: right; font-weight: bold; margin-right: 10px;">0ì¼</span>
                                <span id="stat-special-day-count-amount" style="flex: 2; text-align: right; color: var(--color-primary);">0 ì›</span>
                            </div>
                            <div class="stats-row" style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="flex: 2; color: var(--color-text-light);">ì•¼ê°„ì¼ìˆ˜:</span>
                                <span id="stat-night-day-count-count" style="flex: 1; text-align: right; font-weight: bold; margin-right: 10px;">0ì¼</span>
                                <span id="stat-night-day-count-amount" style="flex: 2; text-align: right; color: var(--color-primary);">0 ì›</span>
                            </div>
                        </div>

                        <div class="input-group" style="margin-top: 10px;">
                            <label for="base-pay">ê¸°ë³¸ê¸‰ ì…ë ¥</label>
                            <div style="display:flex; gap: 5px; flex: 3;">
                                <input type="number" id="base-pay" placeholder="ê¸°ë³¸ê¸‰" oninput="saveBasePaySetting()" style="flex: 1;">
                                <button onclick="copyPreviousMonthBasePay()" style="background-color: var(--color-secondary); color: var(--color-bg-dark); padding: 5px 10px; border: none; border-radius: 4px; font-size: 0.8em; line-height: 1.2; text-align: center; width: 60px; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer;">ì´ì „ë‹¬<br>ê¸°ë³¸ê¸‰</button>
                            </div>
                        </div>
                        <div class="checkbox-group">
                            <label for="regular-pay-check">í†µìƒì„ê¸ˆ í¬í•¨ (ì”ì—… ì‹œê¸‰ ê³„ì‚°ì— ë°˜ì˜)</label>
                            <input type="checkbox" id="regular-pay-check" onchange="saveSettings(); updateSalary();">
                        </div>
                        
                        <hr style="border-color: var(--color-disabled); margin: 10px 0;">
                        
                        <label style="font-size: 0.9em;">ì¶”ê°€ ìˆ˜ë‹¹ ëª©ë¡ (ìƒì—¬, ì§ì±… ìˆ˜ë‹¹ ë“±):</label>
                        <div id="additional-items-list">
                            </div>
                        <button onclick="addAdditionalItem()" style="background-color: var(--color-disabled); color: var(--color-text-light); padding: 5px 10px; border: none; border-radius: 4px; margin-top: 5px;">+ ì¶”ê°€ í•­ëª©</button>
                    </div>

                </section>

                <div id="calendar-view">
                    </div>
            </div>

            <div id="tab-content-statistics" class="tab-content" style="display:none;">
                <section id="statistics-view">
                    <h3>ì›”ë³„ ê·¼ë¬´ í†µê³„</h3>
                    <div class="stats-filter">
                        <select id="stats-year-filter" onchange="renderStatistics()"></select>
                        <select id="stats-month-filter" onchange="renderStatistics()">
                            <option value="">ì „ì²´ ì›”</option>
                            </select>
                    </div>

                    <table class="stats-table">
                        <thead>
                            <tr>
                                <th>ê¸°ê°„</th>
                                <th>ì´ì•¡</th>
                                <th>ì£¼ê°„</th>
                                <th>ì•¼ê°„</th>
                                <th>íŠ¹ê·¼</th>
                                <th>íœ´ê°€</th> <th>ì´ ì”ì—…</th>
                            </tr>
                        </thead>
                        <tbody id="stats-table-body">
                            </tbody>
                    </table>
                </section>
            </div>

            <div id="tab-content-settings" class="tab-content" style="display:none;">
                <section style="padding: var(--mobile-padding);">
                    <h3>ì‚¬ìš©ì ë° ë°˜ ì„¤ì •</h3>
                    <div class="form-row">
                        <label for="setting-account">ë‚´ ê³„ì • ì •ë³´ (ê¸°ê¸°ë‹¹ ê³ ìœ )</label>
                        <input type="text" id="setting-account" disabled>
                    </div>
                    <div class="form-row">
                        <label for="setting-class">ì†Œì† ë°˜</label>
                        <select id="setting-class" onchange="saveSettings();">
                            <option value="A">Aë°˜</option>
                            <option value="B">Bë°˜</option>
                            <option value="C">Cë°˜</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <label for="setting-a-night">Aë°˜ ì•¼ê°„ ì‹œì‘ì¼ (ê¸°ì¤€ì¼)</label>
                        <input type="date" id="setting-a-night" onchange="saveSettings(); generateCalendar();">
                        <small style="color: var(--color-disabled);">* ì´ ë‚ ì§œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë°˜ë³„ ì•¼ê°„ ë¡œí…Œì´ì…˜ì´ ê³„ì‚°ë©ë‹ˆë‹¤.</small>
                    </div>
                    
                    <hr style="border-color: var(--color-disabled); margin: 20px 0;">
                    
                    <h3>ì”ì—… ì¢…ë¥˜ ê´€ë¦¬</h3>
                    <div class="form-row">
                        <label style="font-size: 0.9em;">ì”ì—… ì´ë¦„ê³¼ ê¸°ë³¸ ì‹œê°„(h)ì„ ì„¤ì •í•©ë‹ˆë‹¤.</label>
                        <div id="overtime-list-container">
                        </div>
                        <button onclick="addOvertimeSettingItem()" style="background-color: var(--color-disabled); color: var(--color-text-light); padding: 5px 10px; border: none; border-radius: 4px; margin-top: 5px;">+ ì”ì—… ì¢…ë¥˜ ì¶”ê°€</button>
                    </div>

                    <hr style="border-color: var(--color-disabled); margin: 20px 0;">

                    <h3>ê¸°ë…ì¼ ë° íŠ¹ì´ ì‚¬í•­</h3>
                    <div id="custom-holidays-list">
                        </div>
                    <button onclick="addCustomHolidayInput()" style="background-color: var(--color-disabled); color: var(--color-text-light); padding: 5px 10px; border: none; border-radius: 4px; margin-top: 5px;">+ ê¸°ë…ì¼ ì¶”ê°€</button>
                    
                    <hr style="border-color: var(--color-disabled); margin: 20px 0;">

                    <button onclick="resetAllData()" class="modal-actions danger" style="width: 100%;">ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™” (ì£¼ì˜)</button>

                </section>
            </div>

        </div>

    </div>

    <div id="work-record-modal" class="modal">
        <div class="modal-content">
            <h3 id="modal-date-title">ê·¼ë¬´ ê¸°ë¡ ì…ë ¥</h3>
            <input type="hidden" id="modal-selected-date">

            <div class="form-row">
                <label>ê·¼ë¬´ í˜•íƒœ</label>
                <div class="radio-group" id="work-type-group">
                    <input type="radio" id="type-ì£¼ê°„" name="work-type" value="ì£¼ê°„"><label for="type-ì£¼ê°„">ì£¼ê°„</label>
                    <input type="radio" id="type-ì•¼ê°„" name="work-type" value="ì•¼ê°„"><label for="type-ì•¼ê°„">ì•¼ê°„</label>
                    <input type="radio" id="type-ì£¼íŠ¹" name="work-type" value="ì£¼ê°„íŠ¹ê·¼"><label for="type-ì£¼íŠ¹">ì£¼ê°„íŠ¹ê·¼</label>
                    <input type="radio" id="type-ì•¼íŠ¹" name="work-type" value="ì•¼ê°„íŠ¹ê·¼"><label for="type-ì•¼íŠ¹">ì•¼ê°„íŠ¹ê·¼</label>
                    <input type="radio" id="type-17ì‹œ" name="work-type" value="17ì‹œí‡´ê·¼"><label for="type-17ì‹œ">17ì‹œ í‡´ê·¼</label>
                    <input type="radio" id="type-íœ´ë¬´" name="work-type" value="íœ´ë¬´"><label for="type-íœ´ë¬´">íœ´ë¬´</label>
                    <input type="radio" id="type-íœ´ê°€" name="work-type" value="íœ´ê°€"><label for="type-íœ´ê°€">íœ´ê°€</label>
                    <input type="radio" id="type-ë°˜ì°¨" name="work-type" value="ë°˜ì°¨"><label for="type-ë°˜ì°¨">ë°˜ì°¨ (0.5ì¼)</label>
                    <input type="radio" id="type-ë¯¸ì„ íƒ" name="work-type" value="ë¯¸ì„ íƒ"><label for="type-ë¯¸ì„ íƒ">ë¯¸ì„ íƒ (ê³„ì‚° ì œì™¸)</label>
                </div>
            </div>

            <div class="form-row" id="overtime-input-section">
                <label>ì¶”ê°€ ê·¼ë¬´ (ì¡°ì¶œ/ì§€ì›)</label>
                <div class="overtime-input-row" style="font-weight: bold; color: var(--color-primary);">
                    <div>ì¢…ë¥˜</div>
                    <div>ì‹œê°„ (h)</div>
                    <div>ì‚­ì œ</div>
                </div>
                <div id="modal-overtime-list">
                    </div>
                <button onclick="addOvertimeRow(true)" style="background-color: var(--color-disabled); color: var(--color-text-light); padding: 5px 10px; border: none; border-radius: 4px; margin-top: 10px;">+ ì”ì—… ì¶”ê°€</button>
            </div>

            <div class="modal-actions">
                <button onclick="closeModal('work-record-modal')" class="secondary">ë‹«ê¸°</button>
                <button onclick="deleteWorkRecord()" class="danger" id="delete-record-btn" style="display:none;">ì‚­ì œ</button>
                <button onclick="saveWorkRecord()" class="primary">ì €ì¥/ìˆ˜ì •</button>
            </div>
        </div>
    </div>
    
    <div id="initial-setup-modal" class="modal" style="display:none;">
        <div class="modal-content">
            <h3>ìŠ¤ë§ˆíŠ¸ ì›”ê¸‰ ê³„ì‚° ì´ˆê¸° ì„¤ì •</h3>
            <p>ì•±ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ê¸°ë³¸ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. ë°ì´í„°ëŠ” í˜„ì¬ ê¸°ê¸°ì— ì•ˆì „í•˜ê²Œ ì €ì¥ë©ë‹ˆë‹¤.</p>
            <div class="form-row">
                <label for="init-class">ì†Œì† ë°˜ì„ ì„ íƒí•˜ì„¸ìš”.</label>
                <select id="init-class">
                    <option value="A">Aë°˜</option>
                    <option value="B">Bë°˜</option>
                    <option value="C">Cë°˜</option>
                </select>
            </div>
            <div class="form-row">
                <label for="init-a-night">Aë°˜ ì•¼ê°„ ë¡œí…Œì´ì…˜ ì‹œì‘ì¼ (YYYY-MM-DD)</label>
                <input type="date" id="init-a-night" value="2025-10-05">
                <small style="color: var(--color-disabled);">* ì˜ˆì‹œ: 2025ë…„ 10ì›” 5ì¼ (Bë°˜ ì•¼ê°„ ì‹œì‘ 2025/10/12 ê¸°ì¤€)</small>
            </div>
            <div class="modal-actions">
                <button onclick="completeInitialSetup()" class="primary" style="width: 100%;">ì„¤ì • ì™„ë£Œ ë° ì‹œì‘</button>
            </div>
        </div>
    </div>


    <script>
        // =======================================================================
        // === JavaScript Core Logic ===
        // =======================================================================

        // 1. ë°ì´í„° ì €ì¥ ë° ì´ˆê¸°í™”
        let USER_DATA = {
            account: Date.now().toString(), // ê¸°ê¸°ë‹¹ ê³ ìœ  ID
            class: 'A',
            A_night_start: '2025-10-05', // ì´ˆê¸°ê°’: 2025/10/12 Bë°˜ ì•¼ê°„ ì‹œì‘ì´ ë˜ë„ë¡ Aë°˜ ì‹œì‘ì¼ ì„¤ì •
            settings: {
                basePays: {}, // ë³€ê²½: ê¸°ê°„ë³„ ê¸°ë³¸ê¸‰ì„ ì €ì¥í•˜ëŠ” ê°ì²´
                isRegularPay: false,
                additionalItems: [],
                customHolidays: [],
                isSalaryDetailsCollapsed: false, 
                // ì”ì—… ì¢…ë¥˜ ê¸°ë³¸ê°’
                overtimeList: [
                    { name: 'G1ì¡°ì¶œ', time: 1.0 }, { name: 'G2ì¡°ì¶œ', time: 1.0 },
                    { name: 'G2ì§€ì›', time: 0.5 }, { name: 'G3ì¡°ì¶œ', time: 1.0 },
                    { name: 'G5ì¡°ì¶œ', time: 1.0 }, { name: 'G5ì§€ì›', time: 0.5 },
                    { name: 'R&Dì¡°ì¶œ', time: 1.0 }, { name: 'R&Dì§€ì›', time: 0.5 },
                    { name: 'ë²„ìŠ¤ê²€ì°¨', time: 0.5 }
                ]
            },
            workRecords: {} 
        };
        
        // --- ê¸‰ì—¬ ê¸°ê°„ ê´€ë ¨ í—¬í¼ í•¨ìˆ˜ ì¶”ê°€ ---
        // ê¸‰ì—¬ ê¸°ê°„ì˜ ì‹œì‘ ì›”ì„ ê¸°ì¤€ìœ¼ë¡œ YYYY-MM í‚¤ë¥¼ ë°˜í™˜ (20ì¼ ê¸°ì¤€)
        function getPeriodKeyFromDate(date) {
            let year = date.getFullYear();
            let month = date.getMonth(); // 0-11
            
            // 19ì¼ ì´ì „ì´ë©´ ì´ì „ ë‹¬ì„ ê¸°ì¤€ìœ¼ë¡œ
            if (date.getDate() < 20) {
                month--;
                if (month < 0) {
                    month = 11;
                    year--;
                }
            }
            // ê¸‰ì—¬ ê¸°ê°„ì€ 20ì¼ì´ í¬í•¨ëœ ì›”ì„ ê¸°ì¤€ìœ¼ë¡œ í•¨
            return `${year}-${String(month + 1).padStart(2, '0')}`;
        }
        
        // í˜„ì¬ í™œì„±í™”ëœ ë‹¬ë ¥ ë·°ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê¸‰ì—¬ ê¸°ê°„ í‚¤ë¥¼ ë°˜í™˜
        function getCurrentActivePeriodKey() {
            const activeMonthElement = document.querySelector('.calendar-month.active');
            if (!activeMonthElement) return null;

            const idParts = activeMonthElement.id.split('-');
            const activeYear = Number(idParts[1]);
            const activeMonth = Number(idParts[2]);
            
            // í™œì„±í™”ëœ ë‹¬ë ¥ì˜ 20ì¼ì„ ê¸°ì¤€ìœ¼ë¡œ Period Key ê³„ì‚° (20ì¼ì´ ê¸‰ì—¬ ì‹œì‘ì¼)
            const dateOn20th = new Date(activeYear, activeMonth, 20); 
            return getPeriodKeyFromDate(dateOn20th);
        }

        // í˜„ì¬ í‚¤ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì´ì „ ê¸°ê°„ í‚¤ë¥¼ ë°˜í™˜
        function getPreviousPeriodKey(currentKey) {
            if (!currentKey) return null;
            const [year, month] = currentKey.split('-').map(Number);
            
            let prevYear = year;
            let prevMonth = month - 1;
            
            if (prevMonth === 0) {
                prevMonth = 12;
                prevYear--;
            }
            return `${prevYear}-${String(prevMonth).padStart(2, '0')}`;
        }
        // ------------------------------------

        function loadData() {
            const data = localStorage.getItem('smartSalaryApp_user_data');
            if (data) {
                const loadedData = JSON.parse(data);
                
                // ê¸°ì¡´ basePay ë‹¨ì¼ ê°’ -> basePays ê°ì²´ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ (ê¸°ì¡´ ì‚¬ìš©ì ëŒ€ì‘)
                if (loadedData.settings && loadedData.settings.basePay !== undefined) {
                    const today = new Date();
                    const currentKey = getPeriodKeyFromDate(today); 
                    loadedData.settings.basePays = { [currentKey]: loadedData.settings.basePay };
                    delete loadedData.settings.basePay; 
                }

                // basePaysê°€ ì—†ëŠ” ê²½ìš° ì´ˆê¸°í™”
                if (!loadedData.settings.basePays) {
                    loadedData.settings.basePays = {};
                }

                USER_DATA = loadedData;
                
                if (USER_DATA.settings.isSalaryDetailsCollapsed === undefined) {
                    USER_DATA.settings.isSalaryDetailsCollapsed = false;
                }
                // overtimeListê°€ ì—†ì„ ê²½ìš° ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”
                if (!USER_DATA.settings.overtimeList) {
                    USER_DATA.settings.overtimeList = [
                        { name: 'G1ì¡°ì¶œ', time: 1.0 }, { name: 'G2ì¡°ì¶œ', time: 1.0 },
                        { name: 'G2ì§€ì›', time: 0.5 }, { name: 'G3ì¡°ì¶œ', time: 1.0 },
                        { name: 'G5ì¡°ì¶œ', time: 1.0 }, { name: 'G5ì§€ì›', time: 0.5 },
                        { name: 'R&Dì¡°ì¶œ', time: 1.0 }, { name: 'R&Dì§€ì›', time: 0.5 },
                        { name: 'ë²„ìŠ¤ê²€ì°¨', time: 0.5 }
                    ];
                }

                // HTML ìš”ì†Œì— ë¡œë“œëœ ì„¤ì • ê°’ ë°˜ì˜
                // document.getElementById('base-pay').value ëŠ” updateSalary() ì—ì„œ ì²˜ë¦¬
                document.getElementById('regular-pay-check').checked = USER_DATA.settings.isRegularPay;
                document.getElementById('setting-account').value = USER_DATA.account;
                document.getElementById('setting-class').value = USER_DATA.class;
                document.getElementById('setting-a-night').value = USER_DATA.A_night_start;
                
                renderAdditionalItems();
                renderCustomHolidays();
                renderOvertimeSettings(); // ì”ì—… ì¢…ë¥˜ ì„¤ì • ë Œë”ë§ ì¶”ê°€
                
                // ì˜ˆìƒ ê¸ˆì•¡ ì„¹ì…˜ ìƒíƒœ ì ìš©
                if (USER_DATA.settings.isSalaryDetailsCollapsed) {
                    document.getElementById('salary-input-section').classList.add('collapsed');
                    document.getElementById('salary-details-container').classList.add('collapsed');
                    document.getElementById('toggle-salary-details').textContent = 'â–²';
                }

                // ì´ˆê¸° ì„¤ì • ì™„ë£Œ ì—¬ë¶€ í™•ì¸
                if (USER_DATA.account && USER_DATA.class && USER_DATA.A_night_start) {
                    document.getElementById('initial-setup-modal').style.display = 'none';
                    generateCalendar(true); // â­ 3. ì´ˆê¸° ë¡œë“œ ì‹œ ì˜¤ëŠ˜ ë‚ ì§œë¡œ ì´ë™
                    updateSalary();
                } else {
                    document.getElementById('initial-setup-modal').style.display = 'flex';
                }

            } else {
                USER_DATA.settings.basePays = {}; // ì´ˆê¸°í™”
                document.getElementById('initial-setup-modal').style.display = 'flex';
            }
        }

        // ê¸°ë³¸ê¸‰ ì €ì¥ í•¨ìˆ˜ (oninput ì´ë²¤íŠ¸ì—ì„œ í˜¸ì¶œ)
        function saveBasePaySetting() {
            const currentKey = getCurrentActivePeriodKey();
            const basePayInput = document.getElementById('base-pay');
            if (currentKey) {
                USER_DATA.settings.basePays[currentKey] = Number(basePayInput.value) || 0;
                saveData();
                updateSalary();
            }
        }

        // ê¸°ë³¸ ì„¤ì • ì €ì¥ í•¨ìˆ˜ (ê¸°ë³¸ê¸‰ ì œì™¸)
        function saveSettings() {
            // basePayëŠ” saveBasePaySetting()ì—ì„œ ì²˜ë¦¬

            USER_DATA.settings.isRegularPay = document.getElementById('regular-pay-check').checked;
            
            USER_DATA.class = document.getElementById('setting-class').value;
            USER_DATA.A_night_start = document.getElementById('setting-a-night').value;

            saveData();
            updateSalary();
            generateCalendar(false);
        }

        function saveData() {
            localStorage.setItem('smartSalaryApp_user_data', JSON.stringify(USER_DATA));
        }
        
        // ì´ˆê¸° ì„¤ì • ì™„ë£Œ
        function completeInitialSetup() {
            const initClass = document.getElementById('init-class').value;
            const initANightInput = document.getElementById('init-a-night');
            const initANight = initANightInput.value;
            
            if (!initANight) {
                alert("Aë°˜ ì•¼ê°„ ì‹œì‘ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                initANightInput.focus();
                return;
            }

            USER_DATA.class = initClass;
            USER_DATA.A_night_start = initANight;
            USER_DATA.account = USER_DATA.account || Date.now().toString(); 

            document.getElementById('setting-account').value = USER_DATA.account;
            document.getElementById('setting-class').value = initClass;
            document.getElementById('setting-a-night').value = initANight;

            saveData();

            document.getElementById('initial-setup-modal').style.display = 'none';
            
            generateCalendar(true); // â­ 3. ì´ˆê¸° ì„¤ì • ì™„ë£Œ ì‹œ ì˜¤ëŠ˜ ë‚ ì§œë¡œ ì´ë™
            updateSalary();
            switchTab('calendar'); 
        }

        function resetAllData() {
            if(confirm("ëª¨ë“  ì €ì¥ëœ ë°ì´í„°(ê·¼ë¬´ ê¸°ë¡, ì„¤ì •)ë¥¼ ì •ë§ë¡œ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")) {
                localStorage.removeItem('smartSalaryApp_user_data');
                location.reload(); 
            }
        }
        
        // ì˜ˆìƒ ê¸ˆì•¡ ì„¹ì…˜ í† ê¸€
        function toggleSalaryDetails() {
            const section = document.getElementById('salary-input-section');
            const details = document.getElementById('salary-details-container');
            const button = document.getElementById('toggle-salary-details');
            
            const isCollapsed = !details.classList.contains('collapsed');
            if (isCollapsed) {
                section.classList.add('collapsed');
                details.classList.add('collapsed');
                button.textContent = 'â–²';
                USER_DATA.settings.isSalaryDetailsCollapsed = true;
            } else {
                section.classList.remove('collapsed');
                details.classList.remove('collapsed');
                button.textContent = 'â–¼';
                USER_DATA.settings.isSalaryDetailsCollapsed = false;
            }
            saveData();
        }

        // 2. ê³µíœ´ì¼ ì²˜ë¦¬ (ê¸°ì¡´ ì½”ë“œ ìœ ì§€)
        const FIXED_HOLIDAYS = {
            '01-01': 'ì‹ ì •',
            '03-01': 'ì‚¼ì¼ì ˆ',
            '05-05': 'ì–´ë¦°ì´ë‚ ',
            '06-06': 'í˜„ì¶©ì¼',
            '08-15': 'ê´‘ë³µì ˆ',
            '10-03': 'ê°œì²œì ˆ',
            '10-09': 'í•œê¸€ë‚ ',
            '12-25': 'ì„±íƒ„ì ˆ'
        };

        function getLunarHolidays(year) {
            const lunarData = {
                2025: ['01-29', '01-30', '01-31', '04-04', '10-06', '10-07', '10-08'],
                2026: ['02-16', '02-17', '02-18', '05-24', '09-25', '09-26', '09-27'], 
            };
            return lunarData[year] || [];
        }

        function isHoliday(dateStr) {
            const date = new Date(dateStr);
            const monthDay = dateStr.substring(5);
            const year = date.getFullYear();

            if (FIXED_HOLIDAYS[monthDay] || USER_DATA.settings.customHolidays.includes(dateStr)) {
                return true;
            }

            if (getLunarHolidays(year).includes(monthDay)) {
                return true;
            }
            
            if (date.getDay() === 0) {
                return true;
            }

            return false;
        }

        // 3. ë°˜ ë¡œí…Œì´ì…˜ ê³„ì‚° (ê¸°ì¡´ ì½”ë“œ ìœ ì§€)
        function getClassWorkType(dateStr) {
            const date = new Date(dateStr);
            const A_start_date = new Date(USER_DATA.A_night_start);
            if (isNaN(A_start_date.getTime())) return 'ì£¼ê°„';

            const diffTime = date.getTime() - A_start_date.getTime();
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            const cycleDays = 21;
            let dayInCycle = diffDays % cycleDays;
            if (dayInCycle < 0) dayInCycle += cycleDays;
            dayInCycle++;

            const targetClass = USER_DATA.class;
            let workType = 'ì£¼ê°„';

            if (dayInCycle >= 1 && dayInCycle <= 7) {
                if (targetClass === 'A') workType = 'ì•¼ê°„';
            } else if (dayInCycle >= 8 && dayInCycle <= 14) {
                if (targetClass === 'B') workType = 'ì•¼ê°„';
            } else if (dayInCycle >= 15 && dayInCycle <= 21) {
                if (targetClass === 'C') workType = 'ì•¼ê°„';
            }

            return workType;
        }

        // 4. ë‹¬ë ¥ ìƒì„± ë° ë Œë”ë§
        function generateCalendar(scrollToToday = false) { 
            const startYear = 2025;
            const endYear = startYear + 10;
            const calendarView = document.getElementById('calendar-view');
            calendarView.innerHTML = '';

            const today = new Date();
            const todayStr = today.toISOString().substring(0, 10);
            const todayCalId = `cal-${today.getFullYear()}-${today.getMonth()}`;

            for (let year = startYear; year < endYear; year++) {
                for (let month = 0; month < 12; month++) {
                    const monthDate = new Date(year, month, 1);
                    const monthName = monthDate.toLocaleDateString('ko-KR', { month: 'long', year: 'numeric' });

                    const monthDiv = document.createElement('div');
                    monthDiv.className = 'calendar-month';
                    monthDiv.id = `cal-${year}-${month}`;

                    // â­ 2. ìš”ì¼ ìŠ¤íƒ€ì¼ ì ìš©
                    const weekdaysHTML = `
                        <div class="weekdays">
                            <span class="sunday">ì¼</span><span>ì›”</span><span>í™”</span><span>ìˆ˜</span><span>ëª©</span><span>ê¸ˆ</span><span class="saturday">í† </span>
                        </div>
                    `;

                    monthDiv.innerHTML = `<div class="month-header">${monthName}</div>
                                          ${weekdaysHTML}
                                          <div class="calendar-grid"></div>`;

                    const grid = monthDiv.querySelector('div.calendar-grid');
                    const firstDay = new Date(year, month, 1).getDay();

                    for (let i = 0; i < firstDay; i++) {
                        grid.innerHTML += '<div></div>';
                    }

                    const lastDate = new Date(year, month + 1, 0).getDate();
                    for (let date = 1; date <= lastDate; date++) {
                        const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
                        const isToday = dateStr === todayStr;

                        const cell = document.createElement('div');
                        cell.className = 'day-cell';
                        cell.innerHTML = `<span class="day-number">${date}</span><span class="day-status"></span><span class="day-overtime"></span>`;
                        cell.dataset.date = dateStr;

                        if (isHoliday(dateStr)) {
                            cell.classList.add('holiday');
                        }
                        if (isToday) {
                            cell.classList.add('today');
                        }

                        // ê¸‰ì—¬ ì‚°ì • ê¸°ê°„ í™œì„±í™” (20ì¼ ~ ìµì›” 19ì¼)
                        let isSalaryPeriod = false;
                        const currentDay = new Date(dateStr);
                        
                        // í˜„ì¬ ë‚ ì§œê°€ ì†í•œ ê¸‰ì—¬ ê¸°ê°„ì˜ ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ ê³„ì‚°
                        const periodKey = getPeriodKeyFromDate(currentDay);
                        const [periodYear, periodMonth] = periodKey.split('-').map(Number);
                        const periodStart = new Date(periodYear, periodMonth - 1, 20);
                        const periodEnd = new Date(periodYear, periodMonth, 19);
                        periodEnd.setHours(23, 59, 59, 999);


                        if (currentDay >= periodStart && currentDay <= periodEnd) {
                            isSalaryPeriod = true;
                        }

                        if (isSalaryPeriod) {
                            cell.onclick = () => openWorkRecordModal(dateStr);
                        } else {
                            cell.classList.add('disabled');
                        }

                        const record = USER_DATA.workRecords[dateStr];
                        let displayStatus = '';
                        let displayOvertime = '';

                        if (record && record.type !== 'ë¯¸ì„ íƒ') {
                            switch(record.type) {
                                case 'ì£¼ê°„': displayStatus = 'ì£¼'; break;
                                case 'ì•¼ê°„': displayStatus = 'ì•¼'; break;
                                case 'ì£¼ê°„íŠ¹ê·¼': displayStatus = 'ì£¼íŠ¹'; break;
                                case 'ì•¼ê°„íŠ¹ê·¼': displayStatus = 'ì•¼íŠ¹'; break;
                                case '17ì‹œí‡´ê·¼': displayStatus = '17ì‹œ'; break;
                                case 'íœ´ë¬´': displayStatus = 'íœ´ë¬´'; break;
                                case 'íœ´ê°€': displayStatus = 'íœ´ê°€'; break;
                                case 'ë°˜ì°¨': displayStatus = 'ë°˜ì°¨'; break;
                                default: displayStatus = 'ê¸°ë¡';
                            }

                            if(record.totalOvertime && record.totalOvertime > 0) {
                                displayOvertime = `${record.totalOvertime.toFixed(1)}h`;
                            } else {
                                displayOvertime = '&nbsp;';
                            }
                        } else {
                            displayOvertime = '&nbsp;';
                        }

                        cell.querySelector('.day-status').textContent = displayStatus;
                        cell.querySelector('.day-overtime').innerHTML = displayOvertime;

                        grid.appendChild(cell);
                    }

                    calendarView.appendChild(monthDiv);
                }
            }

            const todayCal = document.getElementById(todayCalId);
            if (todayCal) {
                document.querySelectorAll('.calendar-month').forEach(el => el.classList.remove('active'));
                todayCal.classList.add('active');

                // â­ 3. ì´ˆê¸° ë¡œë“œ ì‹œ ì˜¤ëŠ˜ ë‚ ì§œë¡œ ìŠ¤í¬ë¡¤ ì´ë™
                if (scrollToToday) {
                    setTimeout(() => {
                        todayCal.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 100);
                }
            }
            
            calendarView.onscroll = updateActiveMonth;
            updateActiveMonth(); // ë‹¬ë ¥ ìƒì„± í›„ ê¸‰ì—¬ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•´ í˜¸ì¶œ
        }

        function updateActiveMonth() {
            const calendarView = document.getElementById('calendar-view');
            const months = calendarView.querySelectorAll('.calendar-month');
            const center = calendarView.scrollTop + (calendarView.clientHeight / 2);

            months.forEach(month => {
                const monthCenterY = month.offsetTop + month.offsetHeight / 2;
                if (Math.abs(monthCenterY - center) < month.offsetHeight / 2) {
                    month.classList.add('active');
                } else {
                    month.classList.remove('active');
                }
            });

            updateSalary();
        }

        document.getElementById('today-button').addEventListener('click', () => {
            const today = new Date();
            const todayCalId = `cal-${today.getFullYear()}-${today.getMonth()}`;
            const todayCal = document.getElementById(todayCalId);
            if (todayCal) {
                setTimeout(() => {
                    todayCal.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 10);
            }
        });

        // 5. ê·¼ë¬´ ê¸°ë¡ ëª¨ë‹¬
        function openWorkRecordModal(dateStr) {
            const modal = document.getElementById('work-record-modal');
            const title = document.getElementById('modal-date-title');
            const dateInput = document.getElementById('modal-selected-date');
            const deleteBtn = document.getElementById('delete-record-btn');
            const record = USER_DATA.workRecords[dateStr];

            title.textContent = `${dateStr} ê·¼ë¬´ ê¸°ë¡`;
            dateInput.value = dateStr;
            deleteBtn.style.display = record ? 'inline-block' : 'none';

            const workType = record ? record.type : 'ë¯¸ì„ íƒ';
            const typeId = `type-${workType.replace(/ì£¼ê°„íŠ¹ê·¼/, 'ì£¼íŠ¹').replace(/ì•¼ê°„íŠ¹ê·¼/, 'ì•¼íŠ¹').replace(/17ì‹œí‡´ê·¼/, '17ì‹œ')}`;
            const radio = document.getElementById(typeId);
            if (radio) radio.checked = true;

            const overtimeListDiv = document.getElementById('modal-overtime-list');
            overtimeListDiv.innerHTML = '';
            if (record && record.overtimeList && record.overtimeList.length > 0) {
                record.overtimeList.forEach(item => {
                    addOvertimeRow(true, item.name, item.time);
                });
            } else {
                addOvertimeRow(false);
            }

            modal.style.display = 'flex';
        }

        function closeModal(id) {
            document.getElementById(id).style.display = 'none';
        }

        function addOvertimeRow(canDelete, selectedName = '', selectedTime = 0) {
            const listDiv = document.getElementById('modal-overtime-list');
            const row = document.createElement('div');
            row.className = 'overtime-input-row';

            let options = USER_DATA.settings.overtimeList.map(item =>
                `<option value="${item.name}" data-time="${item.time}" ${item.name === selectedName ? 'selected' : ''}>${item.name} (${item.time}h)</option>`
            ).join('');

            let inputValue = selectedTime > 0 ? selectedTime.toFixed(1) : '';
            if (!inputValue && selectedName) {
                const defaultItem = USER_DATA.settings.overtimeList.find(item => item.name === selectedName);
                if (defaultItem) inputValue = defaultItem.time.toFixed(1);
            }

            row.innerHTML = `
                <select onchange="updateOvertimeTime(this)">
                    <option value="">ì”ì—… ì¢…ë¥˜ ì„ íƒ</option>
                    ${options}
                </select>
                <input type="number" step="0.5" value="${inputValue}" class="overtime-time-input" placeholder="ì‹œê°„">
                <button type="button" onclick="this.parentNode.remove()" style="background: none; border: none; color: var(--color-error); font-size: 1.2em; ${canDelete ? '' : 'display:none;'}">ğŸ—‘ï¸</button>
            `;
            listDiv.appendChild(row);
        }

        function updateOvertimeTime(selectElement) {
            const selectedOption = selectElement.options[selectElement.selectedIndex];
            const timeInput = selectElement.parentNode.querySelector('.overtime-time-input');
            const defaultTime = selectedOption.dataset.time;
            if (defaultTime) {
                timeInput.value = Number(defaultTime).toFixed(1);
            } else {
                timeInput.value = '';
            }
        }

        function saveWorkRecord() {
            const dateStr = document.getElementById('modal-selected-date').value;
            const workTypeElement = document.querySelector('input[name="work-type"]:checked');
            const workType = workTypeElement ? workTypeElement.value : 'ë¯¸ì„ íƒ';

            let totalOvertime = 0;
            const overtimeList = [];

            document.querySelectorAll('#modal-overtime-list .overtime-input-row').forEach(row => {
                const select = row.querySelector('select');
                const timeInput = row.querySelector('.overtime-time-input');
                const name = select.value;
                const time = Number(timeInput.value);

                if (name && time > 0) {
                    overtimeList.push({ name, time });
                    totalOvertime += time;
                }
            });

            let automaticOvertime = 0;
            switch (workType) {
                case 'ì£¼ê°„': automaticOvertime = 3.0; break;
                case 'ì•¼ê°„': automaticOvertime = 4.5; break;
                case 'ì£¼ê°„íŠ¹ê·¼': automaticOvertime = 0.5; break;
                case 'ì•¼ê°„íŠ¹ê·¼': automaticOvertime = 7.0; break;
                case '17ì‹œí‡´ê·¼': automaticOvertime = 0.5; break;
            }

            const finalTotalOvertime = totalOvertime + automaticOvertime;

            const newRecord = {
                type: workType,
                overtimeList: overtimeList,
                totalOvertime: finalTotalOvertime 
            };

            USER_DATA.workRecords[dateStr] = newRecord;
            saveData();
            closeModal('work-record-modal');
            generateCalendar(false);
            updateSalary();
        }

        function deleteWorkRecord() {
            if (confirm("í•´ë‹¹ ë‚ ì§œì˜ ê·¼ë¬´ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                const dateStr = document.getElementById('modal-selected-date').value;
                delete USER_DATA.workRecords[dateStr];
                saveData();
                closeModal('work-record-modal');
                generateCalendar(false);
                updateSalary();
            }
        }

        // 6. ê¸‰ì—¬ ê³„ì‚° ë¡œì§
        // ê¸°ë³¸ê¸‰ì„ ì¸ìˆ˜ë¡œ ë°›ë„ë¡ ìˆ˜ì •
        function calculateHourlyRate(basePay, isRegularPay) {
            let rateBasis = basePay;
            if (isRegularPay) {
                // ê°€ì •: í†µìƒ ì„ê¸ˆì— í¬í•¨ë˜ëŠ” ìˆ˜ë‹¹ (ì˜ˆì‹œë¡œ 200ë§Œì›)
                // TODO: ì´ ê°’ì„ ì„¤ì •ì—ì„œ ë°›ì„ ìˆ˜ ìˆë„ë¡ í™•ì¥ ê°€ëŠ¥
                rateBasis += 2000000; 
            }
            return rateBasis / 226;
        }

        function calculateDailyPay(dateStr, workRecord, settings, currentBasePay) { // ê¸°ë³¸ê¸‰ì„ ì¸ìˆ˜ë¡œ ë°›ìŒ
            if (!workRecord || workRecord.type === 'ë¯¸ì„ íƒ') return 0;

            const hourlyRate = calculateHourlyRate(currentBasePay, settings.isRegularPay); // period-specific basePay ì‚¬ìš©
            let totalDailyAllowance = 0;
            let totalOvertimeHours = workRecord.totalOvertime || 0;

            // --- 1. ê¸°ë³¸ ê·¼ë¬´ì— ëŒ€í•œ ê°€ì‚° ìˆ˜ë‹¹ (ì”ì—… ì œì™¸) ---
            switch (workRecord.type) {
                case 'ì•¼ê°„':
                    totalDailyAllowance += (hourlyRate * 0.5) * 8;
                    break;
                case 'ì£¼ê°„íŠ¹ê·¼':
                    totalDailyAllowance += (hourlyRate * 1.5) * 8;
                    break;
                case 'ì•¼ê°„íŠ¹ê·¼':
                    totalDailyAllowance += (hourlyRate * 2.0) * 8;
                    break;
                case 'ì£¼ê°„':
                case '17ì‹œí‡´ê·¼':
                case 'íœ´ê°€':
                case 'ë°˜ì°¨':
                case 'íœ´ë¬´':
                    break;
            }

            // --- 2. ì”ì—…/ì¶”ê°€ ê·¼ë¬´ ìˆ˜ë‹¹ ê³„ì‚° (ê°€ì‚°ìœ¨ ì ìš©) ---
            if (totalOvertimeHours > 0) {
                let overtimeAllowance = 0;
                let overtimeRateMultiplier = 0;

                if (workRecord.type.includes('íŠ¹ê·¼')) {
                    overtimeRateMultiplier = 2.0;
                } else {
                    overtimeRateMultiplier = 1.5;
                }

                overtimeAllowance = totalOvertimeHours * hourlyRate * overtimeRateMultiplier;
                totalDailyAllowance += overtimeAllowance;
            }

            return totalDailyAllowance;
        }

        function getSalaryPeriod(activeYear, activeMonth) {
            const startDay = 20;
            const endDay = 19;

            let startMonth = activeMonth;
            let startYear = activeYear;
            let endMonth = activeMonth + 1;
            let endYear = activeYear;

            if (endMonth > 11) {
                endMonth = 0;
                endYear++;
            }

            const startDate = new Date(startYear, startMonth, startDay);
            const endDate = new Date(endYear, endMonth, endDay);
            endDate.setHours(23, 59, 59, 999);

            return { startDate, endDate };
        }

        function updateSalary() {
            const activeMonthElement = document.querySelector('.calendar-month.active');
            if (!activeMonthElement) {
                document.getElementById('total-expected-salary').textContent = "0 ì›";
                document.getElementById('current-salary-options').textContent = 'ë‹¬ë ¥ í™œì„±í™”ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...';
                return;
            }

            const idParts = activeMonthElement.id.split('-');
            const activeYear = Number(idParts[1]);
            const activeMonth = Number(idParts[2]);

            const { startDate, endDate } = getSalaryPeriod(activeYear, activeMonth);
            const currentPeriodKey = getCurrentActivePeriodKey(); // í˜„ì¬ í™œì„±í™”ëœ ê¸°ê°„ í‚¤

            // 1. ê¸°ê°„ë³„ ê¸°ë³¸ê¸‰ ë¡œë“œ ë° UI ë°˜ì˜
            const settings = USER_DATA.settings;
            const currentBasePay = settings.basePays[currentPeriodKey] || 0;
            const basePayInput = document.getElementById('base-pay');
            basePayInput.value = currentBasePay > 0 ? currentBasePay : '';


            const startMonth = startDate.getMonth() + 1;
            const endMonth = endDate.getMonth() + 1;
            document.getElementById('salary-period-info').textContent = `ì´ ì˜ˆìƒ ì›”ê¸‰ (${startDate.getFullYear()}/${startMonth}ì›” 20ì¼ ~ ${endDate.getFullYear()}/${endMonth}ì›” 19ì¼)`;

            let totalExpectedSalary = 0; // 6. ê¸°ë³¸ê¸‰ì€ ì¡°ê±´ë¶€ í•©ì‚°ì„ ìœ„í•´ 0ìœ¼ë¡œ ì‹œì‘
            let hasWorkRecordInPeriod = false; // 6. ê¸°ê°„ ë‚´ ê·¼ë¬´ ê¸°ë¡ ì—¬ë¶€ í™•ì¸

            let weekdayOtTime = 0;
            let specialDayCount = 0; 
            let specialOtTime = 0;
            let nightDayCount = 0;
            
            let weekdayOtAmount = 0;
            let specialOtAmount = 0;
            let specialDayAmount = 0; 
            let nightDayAmount = 0;
            
            const hourlyRate = calculateHourlyRate(currentBasePay, settings.isRegularPay); // period-specific basePay ì‚¬ìš©

            for (const dateStr in USER_DATA.workRecords) {
                const date = new Date(dateStr);
                const record = USER_DATA.workRecords[dateStr];

                if (date >= startDate && date <= endDate) {
                    if (record && record.type !== 'ë¯¸ì„ íƒ') {
                        hasWorkRecordInPeriod = true;
                    }

                    const dailyAllowance = calculateDailyPay(dateStr, record, settings, currentBasePay); // period-specific basePay ì „ë‹¬
                    totalExpectedSalary += dailyAllowance;

                    let totalOvertimeHours = record.totalOvertime || 0;

                    // í†µê³„ ê³„ì‚°
                    if (record.type === 'ì•¼ê°„' || record.type === 'ì•¼ê°„íŠ¹ê·¼') {
                        nightDayCount++;
                        nightDayAmount += (hourlyRate * 0.5) * 8; 
                    }

                    if (record.type === 'ì£¼ê°„íŠ¹ê·¼' || record.type === 'ì•¼ê°„íŠ¹ê·¼') {
                        specialDayCount++;
                        specialDayAmount += (hourlyRate * 1.5) * 8; 
                    }
                    
                    if (totalOvertimeHours > 0) {
                        if (record.type.includes('íŠ¹ê·¼')) {
                            let overtimeRateMultiplier = 2.0;
                            specialOtTime += totalOvertimeHours; 
                            specialOtAmount += totalOvertimeHours * hourlyRate * overtimeRateMultiplier;
                        } else if (record.type === 'ì£¼ê°„' || record.type === '17ì‹œí‡´ê·¼' || record.type === 'ì•¼ê°„') {
                            let overtimeRateMultiplier = 1.5;
                            weekdayOtTime += totalOvertimeHours;
                            weekdayOtAmount += totalOvertimeHours * hourlyRate * overtimeRateMultiplier;
                        }
                    }
                }
            }

            // â­ 6. ê¸°ê°„ ë‚´ì— ê·¼ë¬´ ê¸°ë¡ì´ í•˜ë‚˜ë¼ë„ ìˆê³ , ê¸°ë³¸ê¸‰ì´ 0ë³´ë‹¤ í´ ê²½ìš°ì—ë§Œ ê¸°ë³¸ê¸‰ê³¼ ì¶”ê°€ ìˆ˜ë‹¹ í•©ì‚°
            if (hasWorkRecordInPeriod) {
                totalExpectedSalary += currentBasePay; // currentBasePay ì‚¬ìš©
                totalExpectedSalary += settings.additionalItems.reduce((sum, item) => sum + item.amount, 0);
            }

            // â­ 1. ì´ ì˜ˆìƒ ê¸ˆì•¡ ì†Œìˆ˜ì  ë°˜ì˜¬ë¦¼ ë° í‘œì‹œ
            document.getElementById('total-expected-salary').textContent = Math.round(totalExpectedSalary).toLocaleString('ko-KR') + " ì›";

            // í†µê³„ í‘œì‹œ ì—…ë°ì´íŠ¸
            document.getElementById('stat-weekday-ot-time-count').textContent = `${weekdayOtTime.toFixed(1)}h`;
            document.getElementById('stat-weekday-ot-time-amount').textContent = `${Math.round(weekdayOtAmount).toLocaleString('ko-KR')} ì›`;

            document.getElementById('stat-special-ot-time-count').textContent = `${specialOtTime.toFixed(1)}h`;
            document.getElementById('stat-special-ot-time-amount').textContent = `${Math.round(specialOtAmount).toLocaleString('ko-KR')} ì›`;

            document.getElementById('stat-special-day-count-count').textContent = `${specialDayCount}ì¼`;
            document.getElementById('stat-special-day-count-amount').textContent = `${Math.round(specialDayAmount).toLocaleString('ko-KR')} ì›`;

            document.getElementById('stat-night-day-count-count').textContent = `${nightDayCount}ì¼`;
            document.getElementById('stat-night-day-count-amount').textContent = `${Math.round(nightDayAmount).toLocaleString('ko-KR')} ì›`;

            // ê¸°ë³¸ê¸‰ ë° í†µìƒì„ê¸ˆ ì •ë³´ë¥¼ ì—…ë°ì´íŠ¸
            document.getElementById('current-salary-options').innerHTML = `
                ì‹œê¸‰ ê³„ì‚° ê¸°ì¤€: <b>${settings.isRegularPay ? 'í†µìƒì„ê¸ˆ í¬í•¨' : 'ê¸°ë³¸ê¸‰ë§Œ'}</b> / ì˜ˆìƒ ì‹œê¸‰: <b>${Math.round(hourlyRate).toLocaleString('ko-KR', { maximumFractionDigits: 0 })} ì›</b>
            `;
        }

        // --- ìš”ì²­ëœ ì´ì „ë‹¬ ê¸°ë³¸ê¸‰ ë³µì‚¬ í•¨ìˆ˜ ---
        function copyPreviousMonthBasePay() {
            const currentKey = getCurrentActivePeriodKey();
            if (!currentKey) {
                alert("í™œì„±í™”ëœ ê¸‰ì—¬ ê¸°ê°„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }
            
            const prevKey = getPreviousPeriodKey(currentKey);
            const prevBasePay = USER_DATA.settings.basePays[prevKey] || 0;
            
            if (prevBasePay > 0) {
                USER_DATA.settings.basePays[currentKey] = prevBasePay;
                document.getElementById('base-pay').value = prevBasePay; // UI ì—…ë°ì´íŠ¸
                saveData(); // ë°ì´í„° ì €ì¥
                updateSalary(); // ê¸‰ì—¬ ì¬ê³„ì‚° ë° UI ì—…ë°ì´íŠ¸
                alert(`${prevKey.substring(0, 4)}ë…„ ${Number(prevKey.substring(5))}ì›”ë¶„ ê¸°ë³¸ê¸‰ (${prevBasePay.toLocaleString('ko-KR')}ì›)ì´ í˜„ì¬ ê¸°ê°„ì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            } else {
                alert("ì´ì „ë‹¬ì˜ ê¸°ë³¸ê¸‰ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.");
            }
        }
        // ------------------------------------

        // 7. ì”ì—… ì¢…ë¥˜ ì„¤ì • ê´€ë¦¬
        function renderOvertimeSettings() {
            const listDiv = document.getElementById('overtime-list-container');
            listDiv.innerHTML = '';

            USER_DATA.settings.overtimeList.forEach((item, index) => {
                const div = document.createElement('div');
                div.innerHTML = `
                    <input type="text" value="${item.name}" placeholder="ì”ì—… ì´ë¦„" oninput="updateOvertimeSettingName(${index}, this.value)">
                    <input type="number" step="0.5" value="${item.time}" placeholder="ì‹œê°„(h)" oninput="updateOvertimeSettingTime(${index}, this.value)">
                    <button onclick="removeOvertimeSettingItem(${index})" style="background: none; border: none; color: var(--color-error);">ğŸ—‘ï¸</button>
                `;
                listDiv.appendChild(div);
            });
        }

        function addOvertimeSettingItem() {
            USER_DATA.settings.overtimeList.push({ name: '', time: 0 });
            saveData();
            renderOvertimeSettings();
        }

        function updateOvertimeSettingName(index, name) {
            USER_DATA.settings.overtimeList[index].name = name;
            saveData();
        }

        function updateOvertimeSettingTime(index, time) {
            USER_DATA.settings.overtimeList[index].time = Number(time) || 0;
            saveData();
        }

        function removeOvertimeSettingItem(index) {
            USER_DATA.settings.overtimeList.splice(index, 1);
            saveData();
            renderOvertimeSettings();
        }

        // 8. ì¶”ê°€ í•­ëª© ê´€ë¦¬ (ê¸°ì¡´ ì½”ë“œ ìœ ì§€)
        function renderAdditionalItems() {
            const listDiv = document.getElementById('additional-items-list');
            listDiv.innerHTML = '';

            USER_DATA.settings.additionalItems.forEach((item, index) => {
                const div = document.createElement('div');
                div.innerHTML = `
                    <input type="text" value="${item.name}" placeholder="ìˆ˜ë‹¹ ì´ë¦„" oninput="updateAdditionalItemName(${index}, this.value)">
                    <input type="number" value="${item.amount}" placeholder="ê¸ˆì•¡" oninput="updateAdditionalItemAmount(${index}, this.value)">
                    <button onclick="removeAdditionalItem(${index})" style="background: none; border: none; color: var(--color-error);">ğŸ—‘ï¸</button>
                `;
                listDiv.appendChild(div);
            });
        }

        function addAdditionalItem() {
            USER_DATA.settings.additionalItems.push({ name: '', amount: 0 });
            saveData();
            renderAdditionalItems();
        }

        function updateAdditionalItemName(index, name) {
            USER_DATA.settings.additionalItems[index].name = name;
            saveData();
        }

        function updateAdditionalItemAmount(index, amount) {
            USER_DATA.settings.additionalItems[index].amount = Number(amount) || 0;
            saveData();
            updateSalary();
        }

        function removeAdditionalItem(index) {
            USER_DATA.settings.additionalItems.splice(index, 1);
            saveData();
            renderAdditionalItems();
            updateSalary();
        }

        // 9. ì‚¬ìš©ì ì •ì˜ ê³µíœ´ì¼ ê´€ë¦¬ (ê¸°ì¡´ ì½”ë“œ ìœ ì§€)
        function renderCustomHolidays() {
            const listDiv = document.getElementById('custom-holidays-list');
            listDiv.innerHTML = '';

            USER_DATA.settings.customHolidays.forEach((dateStr, index) => {
                const div = document.createElement('div');
                div.style.marginBottom = '8px';
                div.innerHTML = `
                    <input type="date" value="${dateStr}" onchange="updateCustomHoliday(${index}, this.value)">
                    <button onclick="removeCustomHoliday(${index})" style="background: none; border: none; color: var(--color-error);">ğŸ—‘ï¸</button>
                `;
                listDiv.appendChild(div);
            });
        }

        function addCustomHolidayInput() {
            const today = new Date().toISOString().substring(0, 10);
            USER_DATA.settings.customHolidays.push(today);
            saveData();
            renderCustomHolidays();
        }

        function updateCustomHoliday(index, dateStr) {
            USER_DATA.settings.customHolidays[index] = dateStr;
            saveData();
            generateCalendar(false);
        }

        function removeCustomHoliday(index) {
            USER_DATA.settings.customHolidays.splice(index, 1);
            saveData();
            renderCustomHolidays();
            generateCalendar(false);
        }

        // 10. í†µê³„ ë Œë”ë§ ë° í•„í„° (4, 5ë²ˆ ìš”ì²­ ë°˜ì˜)
        function renderStatistics() {
            const yearFilterEl = document.getElementById('stats-year-filter');
            const monthFilterEl = document.getElementById('stats-month-filter');
            const tableBody = document.getElementById('stats-table-body');
            tableBody.innerHTML = '';

            const statsByPeriod = {};
            const recordedPeriods = new Set(); // ê¸°ë¡ì´ ìˆëŠ” ê¸‰ì—¬ ê¸°ê°„ (YYYY-MM)

            // ì „ì²´ ê¸°ë¡ì„ ìˆœíšŒí•˜ë©° í†µê³„ ê³„ì‚° ë° ê¸°ë¡ëœ ê¸°ê°„ ìˆ˜ì§‘
            for (const dateStr in USER_DATA.workRecords) {
                const record = USER_DATA.workRecords[dateStr];
                if (record.type === 'ë¯¸ì„ íƒ') continue; 
                
                const date = new Date(dateStr);
                const periodKey = getPeriodKeyFromDate(date); // ê¸°ê°„ë³„ í‚¤ ì‚¬ìš©
                recordedPeriods.add(periodKey);

                if (!statsByPeriod[periodKey]) {
                    const periodBasePay = USER_DATA.settings.basePays[periodKey] || 0; // í•´ë‹¹ ê¸°ê°„ì˜ ê¸°ë³¸ê¸‰ ë¡œë“œ
                    // 6. ê¸°ë³¸ê¸‰ê³¼ ì¶”ê°€ ìˆ˜ë‹¹ì€ ê¸°ê°„ë‹¹ í•œ ë²ˆë§Œ í•©ì‚° (ì—¬ê¸°ì„œëŠ” 0ìœ¼ë¡œ ì‹œì‘)
                    statsByPeriod[periodKey] = {
                        'baseAndAdditional': periodBasePay + USER_DATA.settings.additionalItems.reduce((sum, item) => sum + item.amount, 0),
                        'dailyAllowance': 0,
                        'ì£¼ê°„': 0,
                        'ì•¼ê°„': 0,
                        'íŠ¹ê·¼': 0,
                        'íœ´ê°€': 0,
                        'ë°˜ì°¨': 0,
                        'ì´ ì”ì—…': 0,
                        'basePayForRate': periodBasePay // ì‹œê¸‰ ê³„ì‚°ì„ ìœ„í•œ ê¸°ë³¸ê¸‰ ì €ì¥
                    };
                }

                const stats = statsByPeriod[periodKey];
                
                // í•´ë‹¹ ê¸°ê°„ì˜ ê¸°ë³¸ê¸‰ì„ ì‚¬ìš©í•˜ì—¬ calculateDailyPay í˜¸ì¶œ
                const dailyAllowance = calculateDailyPay(dateStr, record, USER_DATA.settings, stats['basePayForRate']); 
                stats['dailyAllowance'] += dailyAllowance; // ìˆ˜ë‹¹ë§Œ í•©ì‚° (ê¸°ë³¸ê¸‰ ì œì™¸)

                switch (record.type) {
                    case 'ì£¼ê°„':
                    case '17ì‹œí‡´ê·¼':
                        stats['ì£¼ê°„']++;
                        break;
                    case 'ì•¼ê°„':
                        stats['ì•¼ê°„']++;
                        break;
                    case 'ì£¼ê°„íŠ¹ê·¼':
                    case 'ì•¼ê°„íŠ¹ê·¼':
                        stats['íŠ¹ê·¼']++;
                        break;
                    case 'íœ´ê°€':
                        stats['íœ´ê°€']++;
                        break;
                    case 'ë°˜ì°¨':
                        stats['ë°˜ì°¨'] += 0.5;
                        break;
                }
                stats['ì´ ì”ì—…'] += record.totalOvertime || 0;
            }

            // â­ 4. í†µê³„ í•„í„° ì—…ë°ì´íŠ¸: ê¸°ë¡ëœ ê¸°ê°„ë§Œ í‘œì‹œ
            const periodYears = Array.from(new Set(Array.from(recordedPeriods).map(p => p.split('-')[0]))).sort((a, b) => b - a);
            const periodMonths = Array.from(new Set(Array.from(recordedPeriods).map(p => p.split('-')[1]))).sort((a, b) => a - b);

            const selectedYear = yearFilterEl.value;
            const selectedMonth = monthFilterEl.value;

            // ì—°ë„ í•„í„° ì˜µì…˜ ì±„ìš°ê¸° (ê¸°ë¡ëœ ì—°ë„ + í˜„ì¬ ì—°ë„)
            const currentYear = new Date().getFullYear();
            let yearsToDisplay = new Set([...periodYears.map(String), String(currentYear)]);
            yearFilterEl.innerHTML = Array.from(yearsToDisplay).sort((a, b) => b - a).map(y => 
                `<option value="${y}" ${y == selectedYear ? 'selected' : ''}>${y}ë…„</option>`
            ).join('');


            // ì›” í•„í„° ì˜µì…˜ ì±„ìš°ê¸° (ì „ì²´ + ê¸°ë¡ëœ ì›”)
            monthFilterEl.innerHTML = `<option value="">ì „ì²´ ì›”</option>` + periodMonths.map(m => {
                const monthName = Number(m) + 'ì›”';
                // ì›” í•„í„° ê°’ì€ 0ë¶€í„° ì‹œì‘í•˜ëŠ” month index ëŒ€ì‹  1ë¶€í„° ì‹œì‘í•˜ëŠ” month numberë¥¼ ì‚¬ìš©
                return `<option value="${Number(m)}" ${m == selectedMonth ? 'selected' : ''}>${monthName}</option>`;
            }).join('');


            const yearFilter = yearFilterEl.value;
            const monthFilter = monthFilterEl.value;


            // í…Œì´ë¸” ë Œë”ë§
            const sortedKeys = Object.keys(statsByPeriod).sort((a, b) => b.localeCompare(a)); // ìµœì‹ ìˆœ
            
            let filteredPeriods = sortedKeys.filter(periodKey => {
                const [year, month] = periodKey.split('-');
                if (yearFilter && year != yearFilter) return false;
                // ì›” í•„í„°ê°€ "" (ì „ì²´ ì›”)ì´ ì•„ë‹ ë•Œë§Œ í•„í„°ë§
                if (monthFilter !== "" && Number(month) != Number(monthFilter)) return false; 
                return true;
            });


            filteredPeriods.forEach(periodKey => {
                const stats = statsByPeriod[periodKey];
                const [year, month] = periodKey.split('-');

                const row = tableBody.insertRow();
                row.classList.add('stats-summary-row');

                // ê¸°ë³¸ê¸‰ì´ 0ë³´ë‹¤ í° ê²½ìš°ì—ë§Œ baseAndAdditional í•©ì‚°
                const totalAmount = stats['dailyAllowance'] + (stats['basePayForRate'] > 0 ? stats['baseAndAdditional'] : 0); 

                row.insertCell().textContent = `${year}ë…„ ${Number(month)}ì›”ë¶„`;
                // â­ 1. ì´ì•¡ ì†Œìˆ˜ì  ë°˜ì˜¬ë¦¼
                row.insertCell().textContent = Math.round(totalAmount).toLocaleString('ko-KR') + "ì›"; 
                row.insertCell().textContent = stats['ì£¼ê°„'] + (stats['ì£¼ê°„'] > 0 ? 'ì¼' : '');
                row.insertCell().textContent = stats['ì•¼ê°„'] + (stats['ì•¼ê°„'] > 0 ? 'ì¼' : '');
                row.insertCell().textContent = stats['íŠ¹ê·¼'] + (stats['íŠ¹ê·¼'] > 0 ? 'ì¼' : '');
                // â­ 5. íœ´ê°€/ë°˜ì°¨ í•­ëª©ì„ 'íœ´ê°€'ë¡œ í†µì¼
                row.insertCell().textContent = (stats['íœ´ê°€'] + stats['ë°˜ì°¨']) + 'ì¼'; 
                row.insertCell().textContent = stats['ì´ ì”ì—…'].toFixed(1) + "h";
            });


            if (filteredPeriods.length === 0) {
                 const row = tableBody.insertRow();
                 row.insertCell().textContent = "ì„ íƒëœ ì¡°ê±´ì— ê¸°ë¡ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.";
                 row.cells[0].colSpan = 7;
            }
        }

        // 11. íƒ­ ì „í™˜
        document.getElementById('tab-calendar').addEventListener('click', () => switchTab('calendar'));
        document.getElementById('tab-statistics').addEventListener('click', () => { switchTab('statistics'); renderStatistics(); });
        document.getElementById('tab-settings').addEventListener('click', () => { switchTab('settings'); renderOvertimeSettings(); }); // ì”ì—…ì„¤ì • ë Œë”ë§ í˜¸ì¶œ ì¶”ê°€

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.tab-button').forEach(el => el.classList.remove('active'));

            document.getElementById(`tab-content-${tabName}`).style.display = 'block';
            document.getElementById(`tab-${tabName}`).classList.add('active');
            
            if (tabName === 'statistics') {
                renderStatistics();
            } else if (tabName === 'settings') {
                renderOvertimeSettings();
            }
            // íƒ­ ì „í™˜ ì‹œ calendar íƒ­ì´ë©´ ê¸‰ì—¬ë¥¼ ë‹¤ì‹œ ê³„ì‚°í•˜ê³  UI ì—…ë°ì´íŠ¸
            if (tabName === 'calendar') {
                 updateSalary(); 
            }
        }

        // 12. ì´ˆê¸° ë¡œë“œ
        document.addEventListener('DOMContentLoaded', loadData);

    </script>

</body>
</html>
